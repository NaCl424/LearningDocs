<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第 01 讲：设计一份吸引面试官的简历</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* 页边距 和 页面大小 */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* 引用 */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* 表格 */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* 表格 背景色 */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* 粗体 */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* 斜体 */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* 图片 */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* 当 “![shadow-随便写]()”写时，会有阴影 */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* 代码框 */
/* CodeMirror 3024 Day theme */

/* 代码段 背景 */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* 边框 */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>应用分发：如何制作安装包？</h1>
<p>在上一节课程中我们介绍了如何把 SQLite 引入到 CEF 工程中，以及如何在 CEF 工程中使用 JavaScript 完成数据的增、删、改、查工作。有了 SQLite 的支持，我们距离开发一个完整的桌面端应用就更近了一步。</p>
<p>现在我们的知识地图上还有一块很重要的部分没有填充完整，那就是如何为 CEF 工程制作安装包，有了安装包我们才可以更方便的向用户分发我们的产品。本节课程我就带领大家学习这部分知识。</p>
<h2>以 Release 模式编译工程</h2>
<p>在以前的章节中，我们都是以 Debug 模式编译、运行、调试我们的应用程序，Debug 模式编译出的二进制文件主要是为开发者调试程序提供帮助的，不适合分发给用户。分发给用户的文件应该是以 Release 模式编译得到的。</p>
<p>要想以 Release 模式编译我们的项目，则应该先以 Release 模式编译 CEF 工程得到 CEF 框架的 Release 模式的 dll 和二进制资源。简单起见，我们就直接以 Release 模式编译 CEF 工程下的 cefclient 示例项目即可。</p>
<p>编译完成后将在 E:\project\cef\build\tests\cefclient\Release 目录下得到 CEF 框架的 Release 模式的 dll 和二进制资源（你电脑上的 CEF 工程目录可能与我的目录不同），我们把这个目录下除 cefclient.exe、cefclient.exp 和 cefclient.lib 三个文件之外的所有文件都拷贝到我们的工程输出目录下（在我的电脑上这个目录为 E:\project\cef-in-action\x64\Release）。</p>
<p>准备好二进制资源和库之后，我们要配置工程的 Release 环境。在《环境搭建：如何以正确的姿势进入 CEF 开发世界》章节我们介绍了 CEF 开发环境的配置工作，那时是为 Debug（x64）环境做的配置，现在要为 Release（x64）环境做配置， 所以要做一些更改。</p>
<blockquote>
<p>本节和《环境搭建：如何以正确的姿势进入 CEF 开发世界》章节都未提及的配置项，则按照 Visual Studio 为 Release（x64）环境提供的默认配置项设置，不必更改。</p>
</blockquote>
<ul>
<li><code>C/C++ -> 优化 -> 优化</code>：最大优化(优选大小) (/O1)</li>
<li><code>C/C++ -> 优化 -> 内敛函数扩展</code>：任何适用项 (/Ob2)</li>
<li><code>C/C++ -> 预处理器定义 -> 预处理器定义</code>：</li>
</ul>
<pre><code>WIN32
_WINDOWS
NDEBUG
%(PreprocessorDefinitions)
__STDC_CONSTANT_MACROS
__STDC_FORMAT_MACROS
_WIN32
UNICODE
_UNICODE
WINVER=0x0601
_WIN32_WINNT=0x601
NOMINMAX
WIN32_LEAN_AND_MEAN
_HAS_EXCEPTIONS=0
PSAPI_VERSION=1
CEF_USE_SANDBOX
CEF_USE_ATL
_NDEBUG
CMAKE_INTDIR="Release"
</code></pre>
<ul>
<li><code>C/C++ -> 代码生成 -> 启用字符串池</code>：是 (/GF)</li>
<li><code>C/C++ -> 代码生成 -> 运行库</code>：多线程 (/MT)</li>
<li><code>C/C++ -> 代码生成 -> 启用函数级连接</code>：是 (/Gy)</li>
<li><code>连接器 -> 调试 -> 生成调试信息</code>：否</li>
<li><code>连接器 -> 系统 -> 启用大地址</code> ：是 (/LARGEADDRESSAWARE)</li>
</ul>
<p>配置好 Release 编译环境后，我们就可以用 Release 模式编译 ceftest 工程了，编译成功后你会发现 E:\project\cef-in-action\x64\Release 输出目录下的 ceftest.exe 比 Debug 模式输出的 ceftest.exe 要小的多，运行速度也明显快很多。这是因为 Visual Studio 在 Release 模式下对工程做了大量的优化导致的。</p>
<p>得到 Release 编译的可执行程序和二进制资源后，我们把这些文件拷贝到一个新的目录下，准备使用这些文件制作应用程序的安装包，该目录下的文件如下图所示：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/571a11e697974a749bba09216b27c3f4~tplv-k3u1fbpfcp-watermark.image?" alt="10c22d9166b1bf6a644a25c81d3c676.jpg"></p>
<p>此时这个目录下包含了我们能运行我们应用程序的所有文件，你可以通过双击ceftest.exe启动程序验证功能是否完整。但这些文件并不全都是运行应用程序必须的，接下来我们就介绍一下这些文件各自的功用。</p>
<h2>CEF 二进制文件的功用</h2>
<p>开发者把应用程序分发给用户的时候，有些CEF框架的二进制资源和动态链接库是必须要分发给用户的，缺少这些库你的程序将无法正常运行，有些二进制资源和动态链接库是可以不用分发给用户的，也就是说，如果你没有使用CEF框架的某些功能，那么你就可以不向最终用户提供与这些功能对应的二进制资源和动态链接库。</p>
<p>接下来我们就逐一介绍 CEF 的动态链接库和二进制资源的功用。</p>
<p><code>必须包括</code>在安装包中的动态链接库和二进制资源有如下。</p>
<ul>
<li>libcef.dll：CEF 核心库。</li>
<li>chrome_elf.dll：崩溃报告库。</li>
<li>icudtl.dat：Unicode 编码支持资源。</li>
<li>snapshot_blob.bin：V8 快照数据。</li>
<li>v8_context_snapshot.bin：V8 快照数据。</li>
<li>LICENSE.txt：这个文件是一定要分发给用户的，这是 CEF 版权要求的。你可以把 CEF 应用到你的闭源商业项目中，你也可以自由的修改 CEF 的源码，但你必须得携带 CEF 的 LICENSE 文件，要不然就是违法的。</li>
</ul>
<p><code>可选的</code>动态链接库和二进制资源有如下： </p>
<ul>
<li>Resources/locales/</li>
</ul>
<p>这个目录包含 CEF、Chromium 和 Blink 使用的本地化语言资源。开发者可以通过 CefSettings.locale 设置需要加载哪个国家的语言资源，开发者设置的哪个国家，则相应的 .pak 文件则应该被分发给用户，其他国家的语言资源文件不应该分发给用户，如果开发者没有设置，则默认使用 en-US。</p>
<ul>
<li>Resources/</li>
</ul>
<p>这个目录下除了 locales 子目录之外，还有 chrome_100_percent.pak、  chrome_200_percent.pak、resources.pak 等三个文件，这三个文件是 CEF、Chromium 和 Blink 使用的除语言资源外的其他资源。开发者都可以使用 CefSettings.pack_loading_disabled 直接禁用这些资源。如果不分发这些资源，可能导致某些 web 组件显示不正常。</p>
<ul>
<li>根目录下与 3D 渲染相关的动态链接库   </li>
</ul>
<p>d3dcompiler_47.dll、libEGL.dll 和 libGLESv2.dll，没有这三个库的话，HTML 内的 2D canvas、3D CSS 和 WebGL 的一些功能将不能正常使用。
另外，swiftshader 子目录下也有 libEGL.dll、libGLESv2.dll，这两个文件是在 GPU 被禁用时或者没有 GPU 设备时，CEF 为开发者提供的软 3D 渲染的库，如果没有这两个文件，WebGL 相关的 API 将无法在那些设备上使用。</p>
<p>知道这些二进制资源和动态链接库的功用之后，我们就可以按照我们的需要来进行安装包的制作工作了。</p>
<blockquote>
<p>以目前我选择的 CEF 版本来说，这些文件的总体积为 215M，经 7z 压缩工具压缩后的体积为 68.7M，比 Electron 的体积略大一些，为了保证所有 CEF 的功能都可用，一般情况下开发者不会裁剪 CEF 的动态链接库，仅仅会裁减掉不必要的语言资源。</p>
</blockquote>
<h2>使用 NSIS 制作安装包</h2>
<p>我们计划采用 NSIS（<a href="https://nsis.sourceforge.io/%EF%BC%89" target="_blank" rel="nofollow noopener noreferrer">https://nsis.sourceforge.io/）</a> 来制作安装包。NSIS 是一个非常强大的安装包制作工具，它的全名是：Nullsoft Scriptable Install System，开发者可以在 NSIS 环境下通过编写特定的脚本来生成应用程序的安装包。</p>
<blockquote>
<p>electron-builder 默认情况下也使用 NSIS 为 Windows 应用程序制作安装包。</p>
</blockquote>
<p>简单起见，我们直接使用 NIS Edit（<a href="http://hmne.sourceforge.net/%EF%BC%89" target="_blank" rel="nofollow noopener noreferrer">http://hmne.sourceforge.net/）</a> 这个可视化 NSIS 脚本制作工具来制作 NSIS 安装包，安装该工具后可以通过新建脚本向导来创建一个打包脚本，如下图所示：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bbcd4a578d5e49da9629a4c65692d585~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>接着脚本向导会要求开发者输入目标程序安装包的基础信息：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84d564496d4e4eb4b211866633ad4e31~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>再选择安装包应用程序图标、压缩算法及语言：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/71d176508d9c4b08bc06b0945d2c6cad~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>推荐使用 LZMA 压缩算法，该算法压缩比非常高，可以极大地减小你的安装包体积。接下来选择待打包的目标目录（这里忽略了几步无关紧要的配置）：</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/549ec259f5fb4d53b496dbd60d579213~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>在这个界面首先把示例中的两个文件删除，接着选择我们上文提到的 win-ia32-unpacked 目录，只选择一个目录路径即可，不必选择这个目录下的所有文件，打开如图所示界面（再次忽略了几步无关紧要的配置）：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a04f3933d65d4ff6a7438ed88db00344~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>在这个界面中程序输入框是安装完成后要启动的可执行程序的文件路径，其中 $INSTDIR 代表着用户选择的安装目录，ceftest.exe 是你应用程序的可执行程序文件名。</p>
<p>按要求一步步执行完脚本向导，最终生成一个 .nsi 格式的脚本，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/824737cf57d94c24a1ab7751fafe46a0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>上图中框选了两个按钮，点击左侧的按钮后，NIS Edit 会把脚本传递给 NSIS，由 NSIS 编译脚本并生成安装包；右侧的按钮非但可以生成安装包，还可以启动安装包，以供开发者测试自己的安装包是否正常。</p>
<p>生成的脚本里包含了众多的预定义宏、区段、方法和逻辑，我们简单介绍几个。</p>
<ul>
<li>Section "MainSection" SEC01：安装区段，在应用程序安装时执行，负责释放文件，写注册表等工作。</li>
<li>Section Uninstall ：卸载区段，在应用程序卸载时被执行，负责删除客户端电脑上的文件、删除注册表等工作。</li>
<li>Section -[SectionName]：隐藏区段（前面带-的都为隐藏区段），在应用程序安装时执行，负责创建桌面图标、注册卸载程序等工作。</li>
</ul>
<p>有了 nsi 脚本，NSIS 就可以按照脚本的逻辑生成安装包，NIS Edit 工具是通过命令行参数的形式把这个脚本传递给 NSIS 的，我们点击红框中左侧按钮生成应用程序的安装包。</p>
<p>安装包生成完成后 NIS Edit 会提示生成路径，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2cbcf62c6ec84511b9fc8f53d05cb65e~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>此时你可以双击安装包的可执行程序，观察应用程序是否可以正常安装，安装完成后是否可以自动运行。</p>
<blockquote>
<p>默认情况下应用程序将被安装到：C:\Program Files (x86)\My application目录下。</p>
<p>如果你还没有修改你的可执行程序的图标，那么它一定还是 Windows 应用程序的默认图标，你可以在 VisualStudio 使图标资源，来设置应用程序的默认图标，也可以使用 ResourceHacker（<a href="http://angusj.com/resourcehacker/%EF%BC%89" target="_blank" rel="nofollow noopener noreferrer">http://angusj.com/resourcehacker/）</a> 这类工具来修改你的应用程序的图标。如果你需要为你的应用程序设置签名，那么你可以考虑使用 signtool（<a href="https://docs.microsoft.com/en-us/windows/win32/seccrypto/signtool%EF%BC%89" target="_blank" rel="nofollow noopener noreferrer">https://docs.microsoft.com/en-us/windows/win32/seccrypto/signtool）</a> 这类工具完成这项工作。</p>
</blockquote>
<h2>总结</h2>
<p>通过本节课程我们讲解了如何使用 Release 模式编译我们的应用程序，如何使用 NSIS 打包工具为我们的应用程序制作安装包，顺带也介绍了 CEF 框架的二进制资源及动态链接库的功用，以及如何为应用程序的可执行文件设置图标和签名等知识。</p>
<p>这是我们最后一章介绍 CEF 框架的具体知识，希望你通过学习本系列课程已经掌握了使用 CEF 开发桌面应用的基础知识，实际上这仅仅是长征路的起点，如果你进入桌面应用开发这个领域，你会发现未来还有很多非常 Amazing 的事情在等着你去探索，下一章我就为你介绍一下这些事情。</p>
<h2>源码</h2>
<p>本节示例代码请通过如下地址自行下载（与上一节代码在同一个分支下）：</p>
<p><a href="https://gitee.com/horsejs_admin/cef-in-action/tree/Sqlite/" target="_blank" rel="nofollow noopener noreferrer">https://gitee.com/horsejs_admin/cef-in-action/tree/Sqlite/</a></p></div>
</body></html>