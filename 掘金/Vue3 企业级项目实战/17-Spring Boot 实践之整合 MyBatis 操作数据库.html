<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第 01 讲：设计一份吸引面试官的简历</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* 页边距 和 页面大小 */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* 引用 */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* 表格 */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* 表格 背景色 */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* 粗体 */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* 斜体 */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* 图片 */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* 当 “![shadow-随便写]()”写时，会有阴影 */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* 代码框 */
/* CodeMirror 3024 Day theme */

/* 代码段 背景 */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* 边框 */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>Spring Boot 实践之整合 MyBatis 操作数据库</h1>
<h2>MyBatis  简介</h2>
<p>MyBatis 的前身是 Apache 社区的一个开源项目 iBatis，于 2010 年更名为 MyBatis。</p>
<p>MyBatis 是支持定制化 SQL、存储过程以及高级映射的优秀的持久层框架，避免了几乎所有的 JDBC 代码和手动设置参数以及获取结果集，使得开发人员更加关注 SQL 本身和业务逻辑，不用再去花费时间关注整个复杂的 JDBC 操作过程。</p>
<p>以下为 MyBatis 的结构图：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e6fd850873b244c58cf411c368cf3468~tplv-k3u1fbpfcp-zoom-1.image" alt="MyBatis"></p>
<p>MyBatis 的优点如下：</p>
<ul>
<li>封装了 JDBC 大部分操作，减少开发人员工作量；</li>
<li>相比一些自动化的 ORM 框架，“半自动化”使得开发人员可以自由的编写 SQL 语句，灵活度更高；</li>
<li>Java 代码与 SQL 语句分离，降低维护难度；</li>
<li>自动映射结果集，减少重复的编码工作；</li>
<li>开源社区十分活跃，文档齐全，学习成本不高。</li>
</ul>
<p>鉴于 MyBatis 框架受众更广且后续实践课程的技术选型包含 MyBatis，因此会在本章节内容中介绍它，以及如何使用 Spring Boot 整合 MyBatis 框架对数据层进行功能开发。</p>
<pre><code class="hljs language-tip">本篇文章中所涉及的源码已经整理好并上传到百度云，地址和提取密码如下：
链接: https://pan.baidu.com/s/1UtmS8W7k6XxUT_P3pD57Rw 
提取码: qxp2
</code></pre>
<h2>mybatis-springboot-starter 介绍</h2>
<p>Spring Boot 框架的核心特性包括简化配置并快速开发，当开发者们需要整合某一个功能时，只需要引入其特定的场景启动器 ( starter ) 即可，比如 Web 模块整合、JDBC 模块整合、Thymeleaf 模块整合，开发者们在编码前只需要在 pom.xml 文件中引入对应的 starter 依赖即可。</p>
<p>Spring 官方并没有提供 MyBatis 的场景启动器，但是 MyBatis 官方却紧紧的抱住了 Spring 的大腿，MyBatis 团队提供了 MyBatis 整合 Spring Boot 项目时的场景启动器，也就是 <strong>mybatis-springboot-starter</strong>，大家通过命名方式也能够发现其中的区别，Spring 官方提供的启动器的命名方式都为 <strong>spring-boot-starter-</strong>*，与 MyBatis 官方提供的 starter 组件还是有一些差别的，接下来认识一下 <strong>mybatis-springboot-starter</strong> 场景启动器。</p>
<p>MyBatis 官网地址为 <a href="http://www.mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/index.html" target="_blank" rel="nofollow noopener noreferrer">http://www.mybatis.org</a>，感兴趣的读者可以去官网查看更多内容，在官网中对 <strong>mybatis-springboot-starter</strong>  的介绍如下所示：</p>
<pre><code>The MyBatis-Spring-Boot-Starter help you build quickly MyBatis applications on top of the Spring Boot. 
</code></pre>
<p>MyBatis-Spring-Boot-Starter 可以帮助开发者快速创建基于 Spring Boot 的 MyBatis 应用程序，那么使用 <strong>MyBatis-Spring-Boot-Starter</strong> 可以做什么呢？</p>
<ul>
<li>构建独立的 MyBatis 应用程序</li>
<li>零模板</li>
<li>更少的 XML 配置代码甚至无 XML 配置</li>
</ul>
<h2>MyBatis 自动配置详解</h2>
<p>在正式使用 MyBatis 开发功能之前，先来结合其自动配置源码了解一下 mybatis-spring-boot-starter 场景启动器做了哪些操作，知其然也要知其所以然。</p>
<p><strong>1.mybatis-spring-boot-starter 依赖：</strong></p>
<p>在 pom 文件中引入 spring-boot-starter-jdbc 依赖，如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a00de09d9a6f4ff38779f97b1563079b~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107142441792"></p>
<p>点击 mybatis-spring-boot-starter 并进入 mybatis-spring-boot-starter-2.1.3.pom 文件，源码如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d65af53538344f09a2566ac2e378995~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107142736233"></p>
<p>通过源码可以看到，该 pom 文件中引入了 MyBatis 相关依赖以及其自动配置依赖包，同时可以看到该 pom 文件中也包含 JDBC 场景启动器，如果开发者没有在主 pom 配置文件中引入的话，这里也会引入并使用默认的 HikariCP 数据源。</p>
<p><strong>2.mybatis-spring-boot-starter 自动配置类：</strong></p>
<p>通过 Maven Libraries 查找 MyBatis 的依赖文件可以得到其自动配置类，名称为 MybatisAutoConfiguration ，该自动配置类与官方的自动配置类不同，它并不是定义在 spring-boot-autoconfigure-2.3.7.RELEASE.jar 中的 org.springframework.boot.autoconfigure 包中，而是定义在 mybatis-spring-boot-autoconfigure-2.1.3.jar 中的 org.mybatis.spring.boot.autoconfigure 包中，目录结构如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/795fb599503a4455aeb6e3b76cdb497a~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107143055609"></p>
<p>跟入 MybatisAutoConfiguration  类，其源码及注释如下：</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration <span class="hljs-comment">// 配置类</span>
<span class="hljs-meta">@ConditionalOnClass({ SqlSessionFactory.class, SqlSessionFactoryBean.class })</span> <span class="hljs-comment">// 判断当前 classpath 下是否存在指定类，若存在则将当前的配置装载入 Spring 容器</span>
<span class="hljs-meta">@ConditionalOnSingleCandidate(DataSource.class)</span> <span class="hljs-comment">// 在当前 IOC 容器中存在 DataSource 数据源对象时</span>
<span class="hljs-meta">@EnableConfigurationProperties(MybatisProperties.class)</span> <span class="hljs-comment">// MyBatis 的配置项</span>
<span class="hljs-meta">@AutoConfigureAfter({ DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class })</span><span class="hljs-comment">// 自动配置时机</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MybatisAutoConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InitializingBean</span> </span>{
  
  <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(MybatisAutoConfiguration.class);

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> MybatisProperties properties;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Interceptor[] interceptors;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> TypeHandler[] typeHandlers;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> LanguageDriver[] languageDrivers;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> ResourceLoader resourceLoader;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> DatabaseIdProvider databaseIdProvider;

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> List&#x3C;ConfigurationCustomizer> configurationCustomizers;

  <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MybatisAutoConfiguration</span><span class="hljs-params">(MybatisProperties properties, ObjectProvider&#x3C;Interceptor[]> interceptorsProvider,
      ObjectProvider&#x3C;TypeHandler[]> typeHandlersProvider, ObjectProvider&#x3C;LanguageDriver[]> languageDriversProvider,
      ResourceLoader resourceLoader, ObjectProvider&#x3C;DatabaseIdProvider> databaseIdProvider,
      ObjectProvider&#x3C;List&#x3C;ConfigurationCustomizer>> configurationCustomizersProvider)</span> </span>{
    <span class="hljs-keyword">this</span>.properties = properties;
    <span class="hljs-keyword">this</span>.interceptors = interceptorsProvider.getIfAvailable();
    <span class="hljs-keyword">this</span>.typeHandlers = typeHandlersProvider.getIfAvailable();
    <span class="hljs-keyword">this</span>.languageDrivers = languageDriversProvider.getIfAvailable();
    <span class="hljs-keyword">this</span>.resourceLoader = resourceLoader;
    <span class="hljs-keyword">this</span>.databaseIdProvider = databaseIdProvider.getIfAvailable();
    <span class="hljs-keyword">this</span>.configurationCustomizers = configurationCustomizersProvider.getIfAvailable();
  }
    
  <span class="hljs-meta">@Bean</span> <span class="hljs-comment">// 注册 SqlSessionFactory 到 IOC 容器中</span>
  <span class="hljs-meta">@ConditionalOnMissingBean</span> <span class="hljs-comment">// 在当前 IOC 容器中不存在 SqlSessionFactory 类型的 bean 时注册</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionFactory <span class="hljs-title">sqlSessionFactory</span><span class="hljs-params">(DataSource dataSource)</span> <span class="hljs-keyword">throws</span> Exception </span>{
    SqlSessionFactoryBean factory = <span class="hljs-keyword">new</span> SqlSessionFactoryBean();
    factory.setDataSource(dataSource);
    factory.setVfs(SpringBootVFS.class);
    <span class="hljs-keyword">if</span> (StringUtils.hasText(<span class="hljs-keyword">this</span>.properties.getConfigLocation())) {
      factory.setConfigLocation(<span class="hljs-keyword">this</span>.resourceLoader.getResource(<span class="hljs-keyword">this</span>.properties.getConfigLocation()));
    }
    applyConfiguration(factory);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.properties.getConfigurationProperties() != <span class="hljs-keyword">null</span>) {
      factory.setConfigurationProperties(<span class="hljs-keyword">this</span>.properties.getConfigurationProperties());
    }
    <span class="hljs-keyword">if</span> (!ObjectUtils.isEmpty(<span class="hljs-keyword">this</span>.interceptors)) {
      factory.setPlugins(<span class="hljs-keyword">this</span>.interceptors);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.databaseIdProvider != <span class="hljs-keyword">null</span>) {
      factory.setDatabaseIdProvider(<span class="hljs-keyword">this</span>.databaseIdProvider);
    }
    <span class="hljs-keyword">if</span> (StringUtils.hasLength(<span class="hljs-keyword">this</span>.properties.getTypeAliasesPackage())) {
      factory.setTypeAliasesPackage(<span class="hljs-keyword">this</span>.properties.getTypeAliasesPackage());
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.properties.getTypeAliasesSuperType() != <span class="hljs-keyword">null</span>) {
      factory.setTypeAliasesSuperType(<span class="hljs-keyword">this</span>.properties.getTypeAliasesSuperType());
    }
    <span class="hljs-keyword">if</span> (StringUtils.hasLength(<span class="hljs-keyword">this</span>.properties.getTypeHandlersPackage())) {
      factory.setTypeHandlersPackage(<span class="hljs-keyword">this</span>.properties.getTypeHandlersPackage());
    }
    <span class="hljs-keyword">if</span> (!ObjectUtils.isEmpty(<span class="hljs-keyword">this</span>.typeHandlers)) {
      factory.setTypeHandlers(<span class="hljs-keyword">this</span>.typeHandlers);
    }
    <span class="hljs-keyword">if</span> (!ObjectUtils.isEmpty(<span class="hljs-keyword">this</span>.properties.resolveMapperLocations())) {
      factory.setMapperLocations(<span class="hljs-keyword">this</span>.properties.resolveMapperLocations());
    }
    Set&#x3C;String> factoryPropertyNames = Stream
        .of(<span class="hljs-keyword">new</span> BeanWrapperImpl(SqlSessionFactoryBean.class).getPropertyDescriptors()).map(PropertyDescriptor::getName)
        .collect(Collectors.toSet());
    Class&#x3C;? extends LanguageDriver> defaultLanguageDriver = <span class="hljs-keyword">this</span>.properties.getDefaultScriptingLanguageDriver();
    <span class="hljs-keyword">if</span> (factoryPropertyNames.contains(<span class="hljs-string">"scriptingLanguageDrivers"</span>) &#x26;&#x26; !ObjectUtils.isEmpty(<span class="hljs-keyword">this</span>.languageDrivers)) {
      <span class="hljs-comment">// Need to mybatis-spring 2.0.2+</span>
      factory.setScriptingLanguageDrivers(<span class="hljs-keyword">this</span>.languageDrivers);
      <span class="hljs-keyword">if</span> (defaultLanguageDriver == <span class="hljs-keyword">null</span> &#x26;&#x26; <span class="hljs-keyword">this</span>.languageDrivers.length == <span class="hljs-number">1</span>) {
        defaultLanguageDriver = <span class="hljs-keyword">this</span>.languageDrivers[<span class="hljs-number">0</span>].getClass();
      }
    }
    <span class="hljs-keyword">if</span> (factoryPropertyNames.contains(<span class="hljs-string">"defaultScriptingLanguageDriver"</span>)) {
      <span class="hljs-comment">// Need to mybatis-spring 2.0.2+</span>
      factory.setDefaultScriptingLanguageDriver(defaultLanguageDriver);
    }

    <span class="hljs-keyword">return</span> factory.getObject();
  }

  <span class="hljs-meta">@Bean</span> <span class="hljs-comment">// 注册 SqlSessionTemplate 到 IOC 容器中</span>
  <span class="hljs-meta">@ConditionalOnMissingBean</span> <span class="hljs-comment">// 在当前 IOC 容器中不存在 SqlSessionTemplate 类型的 bean 时注册</span>
  <span class="hljs-function"><span class="hljs-keyword">public</span> SqlSessionTemplate <span class="hljs-title">sqlSessionTemplate</span><span class="hljs-params">(SqlSessionFactory sqlSessionFactory)</span> </span>{
    ExecutorType executorType = <span class="hljs-keyword">this</span>.properties.getExecutorType();
    <span class="hljs-keyword">if</span> (executorType != <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionTemplate(sqlSessionFactory, executorType);
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SqlSessionTemplate(sqlSessionFactory);
    }
  }
 
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AutoConfiguredMapperScannerRegistrar</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">BeanFactoryAware</span>, <span class="hljs-title">ImportBeanDefinitionRegistrar</span> </span>{

    <span class="hljs-keyword">private</span> BeanFactory beanFactory;

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>{

      <span class="hljs-keyword">if</span> (!AutoConfigurationPackages.has(<span class="hljs-keyword">this</span>.beanFactory)) {
        logger.debug(<span class="hljs-string">"Could not determine auto-configuration package, automatic mapper scanning disabled."</span>);
        <span class="hljs-keyword">return</span>;
      }

      logger.debug(<span class="hljs-string">"Searching for mappers annotated with @Mapper"</span>);

      List&#x3C;String> packages = AutoConfigurationPackages.get(<span class="hljs-keyword">this</span>.beanFactory);
      <span class="hljs-keyword">if</span> (logger.isDebugEnabled()) {
        packages.forEach(pkg -> logger.debug(<span class="hljs-string">"Using auto-configuration base package '{}'"</span>, pkg));
      }

      BeanDefinitionBuilder builder = BeanDefinitionBuilder.genericBeanDefinition(MapperScannerConfigurer.class);
      builder.addPropertyValue(<span class="hljs-string">"processPropertyPlaceHolders"</span>, <span class="hljs-keyword">true</span>);
      builder.addPropertyValue(<span class="hljs-string">"annotationClass"</span>, Mapper.class);
      builder.addPropertyValue(<span class="hljs-string">"basePackage"</span>, StringUtils.collectionToCommaDelimitedString(packages));
      BeanWrapper beanWrapper = <span class="hljs-keyword">new</span> BeanWrapperImpl(MapperScannerConfigurer.class);
      Stream.of(beanWrapper.getPropertyDescriptors())
          <span class="hljs-comment">// Need to mybatis-spring 2.0.2+</span>
          .filter(x -> x.getName().equals(<span class="hljs-string">"lazyInitialization"</span>)).findAny()
          .ifPresent(x -> builder.addPropertyValue(<span class="hljs-string">"lazyInitialization"</span>, <span class="hljs-string">"${mybatis.lazy-initialization:false}"</span>));
      registry.registerBeanDefinition(MapperScannerConfigurer.class.getName(), builder.getBeanDefinition());
    }

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBeanFactory</span><span class="hljs-params">(BeanFactory beanFactory)</span> </span>{
      <span class="hljs-keyword">this</span>.beanFactory = beanFactory;
    }

  }

  <span class="hljs-meta">@org</span>.springframework.context.annotation.Configuration <span class="hljs-comment">// 配置类</span>
  <span class="hljs-meta">@Import(AutoConfiguredMapperScannerRegistrar.class)</span> <span class="hljs-comment">// 引入 AutoConfiguredMapperScannerRegistrar 类</span>
  <span class="hljs-meta">@ConditionalOnMissingBean({ MapperFactoryBean.class, MapperScannerConfigurer.class })</span> <span class="hljs-comment">// 在当前 IOC 容器中不存在 MapperFactoryBean 和 MapperScannerConfigurer 类型的 bean 时注册</span>
  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MapperScannerRegistrarNotFoundConfiguration</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">InitializingBean</span> </span>{

    <span class="hljs-meta">@Override</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">afterPropertiesSet</span><span class="hljs-params">()</span> </span>{
      logger.debug(
          <span class="hljs-string">"Not found configuration for registering mapper bean using @MapperScan, MapperFactoryBean and MapperScannerConfigurer."</span>);
    }

  }
}
</code></pre>
<p><strong>DataSourceAutoConfiguration 类的注解释义如下：</strong></p>
<ul>
<li>
<p>@Configuration(proxyBeanMethods = false)</p>
<p>指定该类为配置类。</p>
</li>
<li>
<p>@ConditionalOnClass({{ SqlSessionFactory.class, SqlSessionFactoryBean.class })</p>
<p>判断当前 classpath 下是否存在指定类：SqlSessionFactory 类和 SqlSessionFactoryBean 类，存在则生效。</p>
</li>
<li>
<p>@ConditionalOnSingleCandidate(DataSource.class)</p>
<p>判断 IOC 容器中是否存在类型为 DataSource 的 bean，存在则生效。</p>
</li>
<li>
<p>@AutoConfigureAfter({ DataSourceAutoConfiguration.class, MybatisLanguageDriverAutoConfiguration.class })</p>
<p>自动配置的时机。</p>
</li>
</ul>
<p>结合该自动配置类的源码及源码注释可得知，Mybatis 自动配置类的自动配置触发机制为：当前项目的类路径中存在 SqlSessionFactory 类和 SqlSessionFactoryBean 类且 IOC 容器中存在 DataSource 类型的 bean，因为当前项目引入了 spring-boot-starter-jdbc 和 mybatis-spring-boot-starter 两个场景启动器，启动器中包含了相关依赖，且引入 spring-boot-starter-jdbc 后数据源已自动配置，该知识点前文已经讲解，因此 IOC 容器中存在 DataSource 类型的 bean，即 MyBatis 自动配置类会生效。</p>
<p><strong>3.DataSourceAutoConfiguration 自动配置类的作用</strong></p>
<p>以上是 MyBatis 自动配置流程生效的解释，接下来是另外一个问题，MyBatis 自动配置步骤做了哪些事情？</p>
<p>通过前文的条件注解分析可知，当自动配置流程开始且条件满足后，自动配置类 DataSourceAutoConfiguration 进行自动配置时会判断当前 IOC 容器中是否存在 SqlSessionFactory 和 SqlSessionTemplate 类型的 bean，如果存在则不做操作，如果不存在则初始化 SqlSessionFactory 类和 SqlSessionTemplate 类并注册到 IOC 容器中，MyBatis 框架对于数据库的访问和相关操作都是基于这两个对象展开。</p>
<p>除此之外，DataSourceAutoConfiguration 自动配置类还有一个静态内部类 MapperScannerRegistrarNotFoundConfiguration 类，当项目中不存在 @MapperScan 注解时生效，它是用于扫描项目中标注了 @Mapper 注解的接口，将这些接口与 xxxMapper.xml 文件一一映射后注入到 IOC 容器中以供业务代码调用来操作数据库，查看 @Mapper 注解的源码可知，它的定义中并没有 @Component 注解，因此 Spring 框架本身并不支持 @Mapper 注解的扫描，所以需要由 MyBatis 框架来完成这个操作，这一步的操作就由 MapperScannerRegistrarNotFoundConfiguration 类引入的 AutoConfiguredMapperScannerRegistrar 类来完成。当项目中存在 @MapperScan 注解时，Mapper 文件的扫描和配置工作就由 MapperScannerRegistrar 类来完成，感兴趣的读者可以自行查看这部分源码，这里就不再展开叙述。</p>
<p>在未使用 Spring Boot 框架配置 MyBatis 组件时，需要在 Spring 配置文件中增加 MyBatis 相关配置才能够正常的使用 MyBatis 框架，配置文件如下：</p>
<pre><code class="hljs language-xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"dataSource"</span>
      <span class="hljs-attr">class</span>=<span class="hljs-string">"org.springframework.jdbc.datasource.DriverManagerDataSource"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"driverClassName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"com.mysql.jdbc.Driver"</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"url"</span>
            <span class="hljs-attr">value</span>=<span class="hljs-string">"jdbc:mysql://localhost:3306/db"</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"username"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"root"</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"123456"</span>/></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">bean</span>></span>

<span class="hljs-comment">&#x3C;!-- 配置mybatis的sqlSessionFactory --></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"sqlSessionFactory"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.SqlSessionFactoryBean"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"dataSource"</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">"dataSource"</span>/></span>
  <span class="hljs-comment">&#x3C;!-- 自动扫描mappers.xml文件 --></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"mapperLocations"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:com/**/mappers/*.xml"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">property</span>></span>
  <span class="hljs-comment">&#x3C;!-- mybatis配置文件 --></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"configLocation"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"classpath:mybatis-config.xml"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">property</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">bean</span>></span>

<span class="hljs-comment">&#x3C;!-- DAO接口所在包名，Spring会自动查找其下的类 --></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"basePackage"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"com.core.dao"</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"sqlSessionFactoryBeanName"</span> <span class="hljs-attr">value</span>=<span class="hljs-string">"sqlSessionFactory"</span>></span><span class="hljs-tag">&#x3C;/<span class="hljs-name">property</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">bean</span>></span>
</code></pre>
<p>其实，以上源码分析中，DataSourceAutoConfiguration 自动配置类所做的就是之前开发者们需要手动完成的 MyBatis 配置文件中的内容，只是在 Spring Boot 项目中，这个步骤由 Spring Boot 框架接管了。与 Spring 项目中需要手动配置 MyBatis 相比，Spring Boot 自动配置了使用 MyBatis 框架时所需的相关组件，这个过程对于开发者来说是无感知的，虽然源码看起来比较吃力，但是实际使用的时候其实并不会有这种感觉，书中介绍这部分源码只是为了大家能够更好的理解 Spring Boot 项目中对于 MyBatis 框架的自动配置，知晓其原理。</p>
<p>实际开发过程中，开发者们只需引入 starter 依赖即可零配置使用 MyBatis 框架进行编码，这也是 Spring Boot 框架“约定优于配置”特性的体现，如果开发者不进行自定义的配置，就可以把相关的配置过程交给 Spring Boot 框架，如果有自定义的需求，那么开发者也可以自己去配置 MyBatis 框架相关的组件，有了自定义的配置，MyBatis 自动配置流程的部分步骤就不会执行。</p>
<p>总结下来可以发现，mybatis-spring-boot-starter 场景启动器首先在项目中引入了 MyBatis 的相关依赖，而其中的自动配置类会向 Spring 的 IOC 容器中注册 SqlSessionFactory 和 SqlSessionTemplate 两个 MyBatis 开发中必不可缺的对象，并扫描 Mapper 组件注册到 IOC 容器中。</p>
<p>读者朋友们可以参考本节内容进行源码探索，学习 MyBatis 的自动配置原理。</p>
<h2>Spring Boot 整合 MyBatis 过程</h2>
<p>源码分析之后，接下来将结合实际的代码案例讲解一下 Spring Boot 框架整合 MyBatis 操作数据库的流程。</p>
<h4>添加依赖</h4>
<p>想要把 MyBatis 框架整合到 Spring Boot 项目中，首先需要将其依赖配置增加到 pom.xml 文件中，本书代码案例中选择的 mybatis-springboot-starter 版本为 2.1.3，需要 Spring Boot 版本达到 2.0 或者以上版本，同时需要将数据源依赖和 JDBC 依赖也添加到配置文件中，pom.xml 配置文件如下：</p>
<pre><code class="hljs language-xml"><span class="hljs-meta">&#x3C;?xml version="1.0" encoding="UTF-8"?></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0"</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">modelVersion</span>></span>4.0.0<span class="hljs-tag">&#x3C;/<span class="hljs-name">modelVersion</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">parent</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.springframework.boot<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>spring-boot-starter-parent<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">version</span>></span>2.3.7.RELEASE<span class="hljs-tag">&#x3C;/<span class="hljs-name">version</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">relativePath</span>/></span> <span class="hljs-comment">&#x3C;!-- lookup parent from repository --></span>
	<span class="hljs-tag">&#x3C;/<span class="hljs-name">parent</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>ltd.newbee.mall<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>newbee-mall<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">version</span>></span>0.0.1-SNAPSHOT<span class="hljs-tag">&#x3C;/<span class="hljs-name">version</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">name</span>></span>newbee-mall<span class="hljs-tag">&#x3C;/<span class="hljs-name">name</span>></span>
	<span class="hljs-tag">&#x3C;<span class="hljs-name">description</span>></span>mysql-demo<span class="hljs-tag">&#x3C;/<span class="hljs-name">description</span>></span>

	<span class="hljs-tag">&#x3C;<span class="hljs-name">properties</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">project.build.sourceEncoding</span>></span>UTF-8<span class="hljs-tag">&#x3C;/<span class="hljs-name">project.build.sourceEncoding</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">project.reporting.outputEncoding</span>></span>UTF-8<span class="hljs-tag">&#x3C;/<span class="hljs-name">project.reporting.outputEncoding</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">java.version</span>></span>1.8<span class="hljs-tag">&#x3C;/<span class="hljs-name">java.version</span>></span>
	<span class="hljs-tag">&#x3C;/<span class="hljs-name">properties</span>></span>

	<span class="hljs-tag">&#x3C;<span class="hljs-name">dependencies</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">dependency</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.springframework.boot<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>spring-boot-starter-web<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">dependency</span>></span>

		<span class="hljs-tag">&#x3C;<span class="hljs-name">dependency</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.springframework.boot<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>spring-boot-starter-jdbc<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">dependency</span>></span>

		<span class="hljs-tag">&#x3C;<span class="hljs-name">dependency</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>mysql<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>mysql-connector-java<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">scope</span>></span>runtime<span class="hljs-tag">&#x3C;/<span class="hljs-name">scope</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">dependency</span>></span>

		<span class="hljs-comment">&#x3C;!-- 引入 MyBatis 场景启动器，包含其自动配置类及 MyBatis 3 相关依赖 --></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">dependency</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.mybatis.spring.boot<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>mybatis-spring-boot-starter<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">version</span>></span>2.1.3<span class="hljs-tag">&#x3C;/<span class="hljs-name">version</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">dependency</span>></span>

		<span class="hljs-tag">&#x3C;<span class="hljs-name">dependency</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.springframework.boot<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>spring-boot-starter-test<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">scope</span>></span>test<span class="hljs-tag">&#x3C;/<span class="hljs-name">scope</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">exclusions</span>></span>
				<span class="hljs-tag">&#x3C;<span class="hljs-name">exclusion</span>></span>
					<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.junit.vintage<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
					<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>junit-vintage-engine<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
				<span class="hljs-tag">&#x3C;/<span class="hljs-name">exclusion</span>></span>
			<span class="hljs-tag">&#x3C;/<span class="hljs-name">exclusions</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">dependency</span>></span>
	<span class="hljs-tag">&#x3C;/<span class="hljs-name">dependencies</span>></span>

	<span class="hljs-tag">&#x3C;<span class="hljs-name">build</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">plugins</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">plugin</span>></span>
				<span class="hljs-tag">&#x3C;<span class="hljs-name">groupId</span>></span>org.springframework.boot<span class="hljs-tag">&#x3C;/<span class="hljs-name">groupId</span>></span>
				<span class="hljs-tag">&#x3C;<span class="hljs-name">artifactId</span>></span>spring-boot-maven-plugin<span class="hljs-tag">&#x3C;/<span class="hljs-name">artifactId</span>></span>
			<span class="hljs-tag">&#x3C;/<span class="hljs-name">plugin</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">plugins</span>></span>
	<span class="hljs-tag">&#x3C;/<span class="hljs-name">build</span>></span>

	<span class="hljs-tag">&#x3C;<span class="hljs-name">repositories</span>></span>
		<span class="hljs-tag">&#x3C;<span class="hljs-name">repository</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">id</span>></span>alimaven<span class="hljs-tag">&#x3C;/<span class="hljs-name">id</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">name</span>></span>aliyun maven<span class="hljs-tag">&#x3C;/<span class="hljs-name">name</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">url</span>></span>http://maven.aliyun.com/nexus/content/repositories/central/<span class="hljs-tag">&#x3C;/<span class="hljs-name">url</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">releases</span>></span>
				<span class="hljs-tag">&#x3C;<span class="hljs-name">enabled</span>></span>true<span class="hljs-tag">&#x3C;/<span class="hljs-name">enabled</span>></span>
			<span class="hljs-tag">&#x3C;/<span class="hljs-name">releases</span>></span>
			<span class="hljs-tag">&#x3C;<span class="hljs-name">snapshots</span>></span>
				<span class="hljs-tag">&#x3C;<span class="hljs-name">enabled</span>></span>false<span class="hljs-tag">&#x3C;/<span class="hljs-name">enabled</span>></span>
			<span class="hljs-tag">&#x3C;/<span class="hljs-name">snapshots</span>></span>
		<span class="hljs-tag">&#x3C;/<span class="hljs-name">repository</span>></span>
	<span class="hljs-tag">&#x3C;/<span class="hljs-name">repositories</span>></span>

<span class="hljs-tag">&#x3C;/<span class="hljs-name">project</span>></span>
</code></pre>
<p>这样，MyBatis 的场景启动器和相关依赖就整合进项目中了。</p>
<h4>application.properties 配置</h4>
<p>Spring Boot 整合 MyBatis 时几个比较需要注意的配置参数：</p>
<ul>
<li>
<p><strong>mybatis.config-location</strong></p>
<p>配置 mybatis-config.xml 路径，mybatis-config.xml 中配置 MyBatis 基础属性，如果项目中配置了 mybatis-config.xml 文件需要设置该参数</p>
</li>
<li>
<p><strong>mybatis.mapper-locations</strong></p>
<p>配置 Mapper 文件对应的 XML 文件路径</p>
</li>
<li>
<p><strong>mybatis.type-aliases-package</strong></p>
<p>配置项目中实体类包路径</p>
</li>
</ul>
<pre><code class="hljs language-xml">mybatis.config-location=classpath:mybatis-config.xml
mybatis.mapper-locations=classpath:mapper/*Dao.xml
mybatis.type-aliases-package=ltd.newbee.mall.entity
</code></pre>
<p>开发时只配置 mapper-locations 即可，最终的 application.properties 文件如下：</p>
<pre><code class="hljs language-properties"><span class="hljs-meta">spring.datasource.name</span>=<span class="hljs-string">newbee-mall-datasource</span>
<span class="hljs-meta">spring.datasource.driverClassName</span>=<span class="hljs-string">com.mysql.cj.jdbc.Driver</span>
<span class="hljs-meta">spring.datasource.url</span>=<span class="hljs-string">jdbc:mysql://localhost:3306/test_db?useUnicode=true&#x26;serverTimezone=Asia/Shanghai&#x26;characterEncoding=utf8&#x26;autoReconnect=true&#x26;useSSL=false&#x26;allowMultiQueries=true&#x26;useAffectedRows=true</span>
<span class="hljs-meta">spring.datasource.username</span>=<span class="hljs-string">root</span>
<span class="hljs-meta">spring.datasource.password</span>=<span class="hljs-string">123456</span>

<span class="hljs-meta">mybatis.mapper-locations</span>=<span class="hljs-string">classpath:mapper/*Mapper.xml</span>
</code></pre>
<blockquote>
<p>各位开发者可以根据自己数据库的配置修改帐号和密码。</p>
</blockquote>
<h4>启动类增加 Mapper 扫描</h4>
<p>在启动类中添加对 Mapper 包扫描 @MapperScan，Spring Boot 启动的时候会自动加载包路径下的 Mapper 接口：</p>
<pre><code class="hljs language-java"><span class="hljs-meta">@SpringBootApplication</span>
<span class="hljs-meta">@MapperScan("ltd.newbee.mall.dao")</span> <span class="hljs-comment">//添加 @Mapper 注解</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NewbeeMallApplication</span> </span>{
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
        SpringApplication.run(Application.class, args);
    }
}
</code></pre>
<p>当然也可以直接在每个 Mapper 接口上面添加 @Mapper 注解，但是如果 Mapper 接口数量较多，在每个 Mapper  接口上加注解是比较繁琐的，建议使用扫描注解。</p>
<h2>Spring Boot 整合 MyBatis 进行数据库的增删改查</h2>
<p>在开发项目之前需要在 MySQL 中先创建数据库和表作为项目演示使用，SQL 语句如下：</p>
<pre><code class="hljs language-sql"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `tb_user`;

<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `tb_user` (
  `id` <span class="hljs-type">INT</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">'主键'</span>,
  `name` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'登录名'</span>,
  `password` <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">''</span> COMMENT <span class="hljs-string">'密码'</span>,
  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)
) ENGINE<span class="hljs-operator">=</span>INNODB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">1</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;

<span class="hljs-comment">/*Data for the table `jdbc_test` */</span>

<span class="hljs-keyword">insert</span>  <span class="hljs-keyword">into</span> `tb_user`(`id`,`name`,`password`) <span class="hljs-keyword">values</span> (<span class="hljs-number">1</span>,<span class="hljs-string">'Spring Boot'</span>,<span class="hljs-string">'123456'</span>),(<span class="hljs-number">2</span>,<span class="hljs-string">'MyBatis'</span>,<span class="hljs-string">'123456'</span>),(<span class="hljs-number">3</span>,<span class="hljs-string">'Thymeleaf'</span>,<span class="hljs-string">'123456'</span>),(<span class="hljs-number">4</span>,<span class="hljs-string">'Java'</span>,<span class="hljs-string">'123456'</span>),(<span class="hljs-number">5</span>,<span class="hljs-string">'MySQL'</span>,<span class="hljs-string">'123456'</span>),(<span class="hljs-number">6</span>,<span class="hljs-string">'IDEA'</span>,<span class="hljs-string">'123456'</span>);
</code></pre>
<p>在数据库中新建了一个名称为 tb_user 的数据表，表中有 id , name , password 三个字段，在本机测试时可以直接将以上 SQL 拷贝到 MySQL 中执行即可。</p>
<p>接下来是功能实现步骤，使用 MyBatis 进行数据的增删改查操作。</p>
<h4>新建实体类和 Mapper 接口</h4>
<p>新建 entity 包并在 entity 包下新建 User 类，将 tb_user 中的字段映射到该实体类中，代码如下：</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">package</span> ltd.newbee.mall.entity;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>{

    <span class="hljs-keyword">private</span> Integer id;
    <span class="hljs-keyword">private</span> String name;
    <span class="hljs-keyword">private</span> String password;

    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getId</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> id;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setId</span><span class="hljs-params">(Integer id)</span> </span>{
        <span class="hljs-keyword">this</span>.id = id;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>{
        <span class="hljs-keyword">this</span>.name = name;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> password;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span><span class="hljs-params">(String password)</span> </span>{
        <span class="hljs-keyword">this</span>.password = password;
    }
}
</code></pre>
<p>新建 dao 包并在 dao 包中新建 UserDao 接口，并定义增删改查四个方法，代码如下：</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">package</span> ltd.newbee.mall.dao;
<span class="hljs-keyword">import</span> ltd.newbee.mall.entity.User;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-comment">/**
 * <span class="hljs-doctag">@author</span> 十三
 * MyBatis 功能测试
 */</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserDao</span> </span>{
    <span class="hljs-comment">/**
     * 返回数据列表
     *
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function">List&#x3C;User> <span class="hljs-title">findAllUsers</span><span class="hljs-params">()</span></span>;

    <span class="hljs-comment">/**
     * 添加
     *
     * <span class="hljs-doctag">@param</span> User
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insertUser</span><span class="hljs-params">(User User)</span></span>;

    <span class="hljs-comment">/**
     * 修改
     *
     * <span class="hljs-doctag">@param</span> User
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">updUser</span><span class="hljs-params">(User User)</span></span>;

    <span class="hljs-comment">/**
     * 删除
     *
     * <span class="hljs-doctag">@param</span> id
     * <span class="hljs-doctag">@return</span>
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">delUser</span><span class="hljs-params">(Integer id)</span></span>;
}
</code></pre>
<h4>创建 Mapper 接口的映射文件</h4>
<p>在 resources 目录下新建 mapper 目录，并在 mapper 目录下新建 Mapper 接口的映射文件 UserMapper.xml，之后进行映射文件的编写。</p>
<p>1.首先，定义映射文件与 Mapper 接口的对应关系，比如该示例中，需要将 UserMapper.xml 文件与对应的 UserDao 接口类之间的关系定义出来：</p>
<pre><code class="hljs language-xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"ltd.newbee.mall.dao.UserDao"</span>></span>
</code></pre>
<p>2.之后，配置表结构和实体类的对应关系：</p>
<pre><code class="hljs language-xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"ltd.newbee.mall.entity.User"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"UserResult"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"password"</span>/></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">resultMap</span>></span>
</code></pre>
<p>3.最后，按照对应的接口方法，编写增删改查方法具体的 SQL 语句，最终的 UserMapper.xml 文件如下：</p>
<pre><code class="hljs language-xml"><span class="hljs-meta">&#x3C;?xml version="1.0" encoding="UTF-8"?></span>
<span class="hljs-meta">&#x3C;!DOCTYPE <span class="hljs-meta-keyword">mapper</span> <span class="hljs-meta-keyword">PUBLIC</span> <span class="hljs-meta-string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="hljs-meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>></span>
<span class="hljs-tag">&#x3C;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">"ltd.newbee.mall.dao.UserDao"</span>></span>
  <span class="hljs-tag">&#x3C;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">"ltd.newbee.mall.entity.User"</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"UserResult"</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"id"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"id"</span>/></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"name"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"name"</span>/></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">result</span> <span class="hljs-attr">property</span>=<span class="hljs-string">"password"</span> <span class="hljs-attr">column</span>=<span class="hljs-string">"password"</span>/></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">resultMap</span>></span>

  <span class="hljs-tag">&#x3C;<span class="hljs-name">select</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"findAllUsers"</span> <span class="hljs-attr">resultMap</span>=<span class="hljs-string">"UserResult"</span>></span>
    select id,name,password from tb_user
    order by id desc
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">select</span>></span>

  <span class="hljs-tag">&#x3C;<span class="hljs-name">insert</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"insertUser"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"ltd.newbee.mall.entity.User"</span>></span>
    insert into tb_user(name,password)
    values(#{name},#{password})
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">insert</span>></span>

  <span class="hljs-tag">&#x3C;<span class="hljs-name">update</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"updUser"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"ltd.newbee.mall.entity.User"</span>></span>
    update tb_user
    set
    name=#{name},password=#{password}
    where id=#{id}
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">update</span>></span>

  <span class="hljs-tag">&#x3C;<span class="hljs-name">delete</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"delUser"</span> <span class="hljs-attr">parameterType</span>=<span class="hljs-string">"int"</span>></span>
    delete from tb_user where id=#{id}
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">delete</span>></span>
<span class="hljs-tag">&#x3C;/<span class="hljs-name">mapper</span>></span>
</code></pre>
<h4>新建 MyBatisController</h4>
<p>为了对 MyBatis 进行功能测试，在 controller 包下新建 MyBatisController 类，并新增 4 个方法分别接收对于 tb_user 表的增删改查请求，代码如下：</p>
<pre><code class="hljs language-java"><span class="hljs-keyword">package</span> ltd.newbee.mall.controller;

<span class="hljs-keyword">import</span> ltd.newbee.mall.dao.UserDao;
<span class="hljs-keyword">import</span> ltd.newbee.mall.entity.User;
<span class="hljs-keyword">import</span> org.springframework.util.StringUtils;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.GetMapping;
<span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.RestController;

<span class="hljs-keyword">import</span> javax.annotation.Resource;
<span class="hljs-keyword">import</span> java.util.List;

<span class="hljs-meta">@RestController</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyBatisController</span> </span>{

    <span class="hljs-meta">@Resource</span>
    UserDao userDao;

    <span class="hljs-comment">// 查询所有记录</span>
    <span class="hljs-meta">@GetMapping("/users/mybatis/queryAll")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> List&#x3C;User> <span class="hljs-title">queryAll</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> userDao.findAllUsers();
    }

    <span class="hljs-comment">// 新增一条记录</span>
    <span class="hljs-meta">@GetMapping("/users/mybatis/insert")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">insert</span><span class="hljs-params">(String name, String password)</span> </span>{
        <span class="hljs-keyword">if</span> (StringUtils.isEmpty(name) || StringUtils.isEmpty(password)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        User user = <span class="hljs-keyword">new</span> User();
        user.setName(name);
        user.setPassword(password);
        <span class="hljs-keyword">return</span> userDao.insertUser(user) > <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 修改一条记录</span>
    <span class="hljs-meta">@GetMapping("/users/mybatis/update")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">update</span><span class="hljs-params">(Integer id, String name, String password)</span> </span>{
        <span class="hljs-keyword">if</span> (id == <span class="hljs-keyword">null</span> || id &#x3C; <span class="hljs-number">1</span> || StringUtils.isEmpty(name) || StringUtils.isEmpty(password)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        User user = <span class="hljs-keyword">new</span> User();
        user.setId(id);
        user.setName(name);
        user.setPassword(password);
        <span class="hljs-keyword">return</span> userDao.updUser(user) > <span class="hljs-number">0</span>;
    }

    <span class="hljs-comment">// 删除一条记录</span>
    <span class="hljs-meta">@GetMapping("/users/mybatis/delete")</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Boolean <span class="hljs-title">delete</span><span class="hljs-params">(Integer id)</span> </span>{
        <span class="hljs-keyword">if</span> (id == <span class="hljs-keyword">null</span> || id &#x3C; <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-keyword">return</span> userDao.delUser(id) > <span class="hljs-number">0</span>;
    }
}
</code></pre>
<p>上述步骤完成后，项目的代码目录如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c1c7a75c3a34d5fb17e8f01dd48673d~tplv-k3u1fbpfcp-zoom-1.image" alt="WX20210111-160615@2x"></p>
<p>编码完成后启动 Spring Boot 项目，启动成功后打开浏览器中对以上四个功能进行验证。</p>
<p><strong>1.Spring Boot 整合 MyBatis 向数据库中新增记录。</strong></p>
<p>在地址栏输入如下地址：</p>
<p><code>http://localhost:8080/users/mybatis/insert?name=十三&#x26;password=1234567</code></p>
<p>传参分别为“十三”和“1234567”，表示向数据库中新增一条记录，其中 name 字段值为“十三”，password 字段值为“1234567”，页面返回结果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c02d01b9fad242d186f6c7847918a815~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107173053707"></p>
<p>此时查看数据库中的记录，可以看到已经新增成功，新的记录已经生成，数据如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d4f7cbe68b0422e856d543d44361d30~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107173605571"></p>
<p><strong>2.Spring Boot 整合 MyBatis 删除数据库中的记录。</strong></p>
<p>在地址栏输入如下地址：</p>
<p><code>http://localhost:8080/delete?id=3</code></p>
<p>传参为 5，表示从数据库表中删除一条 id 为 5 的记录，页面返回结果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7e97fbc255fb432c8509fc96c56dc6b8~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107173759835"></p>
<p>此时查看数据库中的记录，id 为 5 的记录已经被删除成功，数据如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/387a270e65124324a32e6f48aa67e122~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107173901505"></p>
<p><strong>3.Spring Boot 整合 MyBatis 修改数据库中的记录。</strong></p>
<p>在地址栏输入如下地址：</p>
<p><code>http://localhost:8080/users/mybatis/update?id=1&#x26;name=book01&#x26;password=12345678</code></p>
<p>传参分别为为 “1”、“book01”和“12345678”，表示修改数据库表中 id 为 1 的记录，页面返回结果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b9d02bbfdc2f44949aeafb260e23b80d~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107174052760"></p>
<p>此时查看数据库中的记录，id 为 1 的记录已经修改成功，数据如下图所示：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/70ecf557e0b146cc9a2f0558c5ee2353~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107174139644"></p>
<p><strong>4.Spring Boot 整合 MyBatis 查询数据库中的记录。</strong></p>
<p>在地址栏输入如下地址：</p>
<p><code>http://localhost:8080/users/mybatis/queryAll</code></p>
<p>该请求会查询出数据库中的所有记录，页面返回结果如下：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef1744fc6197448db054c0781feac785~tplv-k3u1fbpfcp-zoom-1.image" alt="image-20210107174216282"></p>
<p>以上为笔者进行功能测试的步骤，大家在测试时也可以尝试多添加几条记录，如果能够正常获取到记录以及正确的 操作 tb_user 表中的记录就表示功能整合成功！</p></div>
</body></html>