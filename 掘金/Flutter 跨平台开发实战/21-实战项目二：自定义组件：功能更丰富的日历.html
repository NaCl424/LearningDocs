<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第 01 讲：设计一份吸引面试官的简历</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* 页边距 和 页面大小 */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* 引用 */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* 表格 */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* 表格 背景色 */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* 粗体 */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* 斜体 */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* 图片 */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* 当 “![shadow-随便写]()”写时，会有阴影 */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* 代码框 */
/* CodeMirror 3024 Day theme */

/* 代码段 背景 */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* 边框 */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>实战项目二：自定义组件：功能更丰富的日历</h1>
<p>今天，我们再次讨论自定义组件。先来看这样一张图：</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c38583cc1d41425ba020c2cee2ed8337~tplv-k3u1fbpfcp-watermark.image?" alt="df2d0ae9f43849799e5cbec7d81a23fdtplv-k3u1fbpfcp-watermark.png"></p>
<p>没错，这张图就是本案例主页中的“日历”页。</p>
<p>相信到今天，分析 UI 结构的技能大家已经掌握得很好了。从宏观上看，整个界面呈垂直布局，自上而下分别是日历组件和日记列表组件。在操作上，若某天存在日记，则在日历组件的相应位置亮蓝灯。比如图中的 22 日、23 日和 24 日。此外，日历和日记列表组件联动：下方的日记列表仅显示所选日期的日记。</p>
<p>回顾在讲数据库时，我们已经实现了根据日期查询数据的方法。所以联动数据部分实现起来较为容易，本讲不再详细讲解，读者可参考本讲末尾的附录部分一探究竟。</p>
<p>接下来，我们把目光聚焦到日历，逐步实现这个组件。</p>
<p>在 Flutter 中，“一切皆组件”，再复杂的组件也不过是基础组件的排列组合。现在，让我们先对日历组件进行功能拆解，梳理需求。</p>
<h2>功能拆解</h2>
<p>作为日历，正确显示当前日期是必须的。从图上看，当前日期包含组件顶栏的年月显示和下方的日期矩阵。如果再进一步拆解，可以发现日历中还填充了上个月和/或下个月的日期。虽然它们是灰色的，不可点击，但它们确实是摆在那里的，也需要我们去实现它。再有就是蓝灯提示。综上，我把功能点简单梳理罗列如下：</p>
<ul>
<li><strong>顶栏显示当前选区所处的年月，并提供相邻月份切换功能；</strong></li>
<li><strong>顶栏和日期矩阵之间显示星期；</strong></li>
<li><strong>日期显示矩阵需填充本月所有的日期，空白部分填充相邻月份的日期；</strong></li>
<li><strong>本月的日期可点击，可跳转。若当天含有日记，则下方以蓝色圆点（即“蓝灯”）方式提示；</strong></li>
<li><strong>相邻月份的日期显示为灰色字体，不可点击，不可跳转；</strong></li>
<li><strong>当前选择的日期的背景改为蓝色，圆形。</strong></li>
</ul>
<h2>算法 &#x26; 实现</h2>
<p>如同我们在建造一个犬舍和摩天大楼一样。简单的犬舍，即使构建失败，重试的成本很低，而且简单。但摩天大楼就不同了，它的失败成本远远超出一个犬舍。</p>
<p>到编程上也是类似的，对于复杂的需求，没有规划，贸然行动，其结果可能会面临巨大的成本消耗。</p>
<p>所以，在动手编码之前，特别是这种数据和 UI 都需要处理的时候，通常要先有个规划。</p>
<p><code>💡 提示：当然，我在这里提供的算法仅是诸多解决方案中的一种，肯定还会有其它更好的算法。大家如果有什么好点子，欢迎一起探讨。</code></p>
<p>相信大家和我的想法一样，整个组件最难实现的，莫过于日期矩阵。</p>
<p>我的思路是这样的：<strong>日期矩阵其实是包含三个部分的日期：上个月、本月、下个月。它们的分界线实际上是本月 1 日和最后一天</strong>。比如下图中的日历：</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cdbc5d2f2aa543acb53670529ce288bd~tplv-k3u1fbpfcp-watermark.image?" alt="697ad59c5759489bb1706f692dc84916tplv-k3u1fbpfcp-watermark.png"></p>
<ul>
<li><strong>对于本月，首先确定最开始第一天的所在位置，然后让日期循环加 1，依次填充进矩阵。直到月份发生改变（即月份 +1）</strong> ；</li>
<li><strong>对于上个月，由于周的开始是周日，因此让本月第一天循环减 1，依次填充进矩阵。直到首个周日的到来</strong>；</li>
<li><strong>对于下个月，依然是由于周的开始是周日，因此让本月的最后一天循环加 1，依次填充进矩阵。直到首个周六的到来。</strong></li>
</ul>
<p>在 Dart 中，<code>DateTime</code>中的<code>add()</code>和<code>substract()</code>可以实现增加和减少天数的运算。当结果跳转到下个月或上个月时，年份和/或月份会自动增加或减少。</p>
<p>拿上图举例，在 2023 年 12 月 1 日减 1 天，时间将变为 2023 年 11 月 30 日；在 2023 年 12 月 31 日加 1 天，时间将变为 2024 年 1 月 1 日。</p>
<p>接着，由于日期矩阵是完全填充，没有空白格的，因此<strong>整个矩阵内的元素个数（即天数）恰好是 7 的倍数</strong>。</p>
<p>看到这，数据上的算法其实已经可以确定下来了。如果用代码实现的话，会是这样的：</p>
<pre><code class="hljs language-ini">List&#x3C;DateTime> allDates() {
  List&#x3C;DateTime> <span class="hljs-attr">returnData</span> = []<span class="hljs-comment">;</span>
  DateTime <span class="hljs-attr">singleDate</span> = DateTime(currentDate.year, currentDate.month, <span class="hljs-number">1</span>)<span class="hljs-comment">;</span>
  int <span class="hljs-attr">month</span> = currentDate.month<span class="hljs-comment">;</span>
  List&#x3C;DateTime> <span class="hljs-attr">datesOfThisMonth</span> = []<span class="hljs-comment">;</span>
  List&#x3C;DateTime> <span class="hljs-attr">dateData</span> = []<span class="hljs-comment">;</span>
  // 上个月日期填充
  for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &#x3C; singleDate.weekday; i++) {</span>
    dateData.add(singleDate.subtract(Duration(days: singleDate.weekday - i)))<span class="hljs-comment">;</span>
    datesOfThisMonth.add(dateData<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
  }
  // 本月首天
  dateData.add(singleDate)<span class="hljs-comment">;</span>
  // 本月日期填充
  while (<span class="hljs-attr">singleDate.month</span> == month) {
    datesOfThisMonth.add(singleDate)<span class="hljs-comment">;</span>
    dateData.add(singleDate.add(const Duration(days: 1)))<span class="hljs-comment">;</span>
    <span class="hljs-attr">singleDate</span> = singleDate.add(const Duration(days: <span class="hljs-number">1</span>))<span class="hljs-comment">;</span>
  }
  // 下月日期填充
  for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &#x3C; 7 - singleDate.weekday; i++) {</span>
    dateData.add(singleDate.add(Duration(days: i)))<span class="hljs-comment">;</span>
    datesOfThisMonth.add(singleDate<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
  }
  // 汇总所有日期
  for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &#x3C; datesOfThisMonth.length; i++) {</span>
    returnData.add(datesOfThisMonth<span class="hljs-section">[i]</span>)<span class="hljs-comment">;</span>
  }
  return returnData<span class="hljs-comment">;</span>
}
</code></pre>
<p>但是这还不够，界面上摆放的是组件（Widget），无法直接摆放 DateTime。还需要对<code>allDates()</code>方法进行改进，把返回值的类型：<code>List&#x3C;DateTime></code>改成<code>List&#x3C;Widget></code>。</p>
<p>具体代码如下：</p>
<pre><code class="hljs language-php"><span class="hljs-comment">// 计算并生成单个日期组件</span>
List&#x3C;Widget> <span class="hljs-title function_ invoke__">allDates</span>() {
  <span class="hljs-keyword">int</span> currentDay = currentDate.day;
  List&#x3C;Widget> returnData = [];
  DateTime singleDate = <span class="hljs-title function_ invoke__">DateTime</span>(currentDate.year, currentDate.month, <span class="hljs-number">1</span>);
  <span class="hljs-keyword">int</span> month = currentDate.month;
  List&#x3C;Widget> datesOfThisMonth = [];
  List&#x3C;DateTime> dateData = [];
  <span class="hljs-comment">// 上个月日期填充</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; singleDate.weekday; i++) {
    dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate.<span class="hljs-title function_ invoke__">subtract</span>(<span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: singleDate.weekday - i)));
    datesOfThisMonth.<span class="hljs-title function_ invoke__">add</span>(
      <span class="hljs-title function_ invoke__">Expanded</span>(
       <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Container</span>(
           <span class="hljs-attr"> alignment</span>: Alignment.center,
           <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">5</span>),
           <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
             <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceEvenly,
             <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
             <span class="hljs-attr"> children</span>: [
                <span class="hljs-title function_ invoke__">Text</span>(
                  dateData[i].day.<span class="hljs-title function_ invoke__">toString</span>(),
                 <span class="hljs-attr"> style</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">TextStyle</span>(
                     <span class="hljs-attr"> fontSize</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">color</span>: CupertinoColors.inactiveGray),
                 <span class="hljs-attr"> textAlign</span>: TextAlign.center,
                ),
                <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">SizedBox</span>(<span class="hljs-attr">height</span>: <span class="hljs-number">10</span>)
              ],
            )),
      ),
    );
  }
  <span class="hljs-comment">// 本月首天</span>
  dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate);
  <span class="hljs-comment">// 本月日期填充</span>
  <span class="hljs-keyword">while</span> (singleDate.month == month) {
    DateTime uniqueDate = singleDate;
    datesOfThisMonth.<span class="hljs-title function_ invoke__">add</span>(
      <span class="hljs-title function_ invoke__">Expanded</span>(
       <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">CupertinoButton</span>(
         <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">0</span>),
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Container</span>(
             <span class="hljs-attr"> alignment</span>: Alignment.center,
             <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">5</span>),
             <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">CircleAvatar</span>(
               <span class="hljs-attr"> backgroundColor</span>: currentDay == singleDate.day
                    ? Consts.themeColor
                    : CupertinoColors.white,
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
                 <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceEvenly,
                 <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
                 <span class="hljs-attr"> children</span>: [
                    <span class="hljs-title function_ invoke__">Text</span>(singleDate.day.<span class="hljs-title function_ invoke__">toString</span>(),
                       <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                           <span class="hljs-attr"> fontSize</span>: <span class="hljs-number">15</span>,
                           <span class="hljs-attr"> color</span>: currentDay == singleDate.day
                                ? CupertinoColors.white
                                : CupertinoColors.black),
                       <span class="hljs-attr"> textAlign</span>: TextAlign.center),
                    widget.markedDate.<span class="hljs-title function_ invoke__">contains</span>(uniqueDate) &#x26;&#x26;
                            currentDay != singleDate.day
                        ? <span class="hljs-title function_ invoke__">diaryExistDot</span>()
                        : <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">SizedBox</span>(<span class="hljs-attr">height</span>: <span class="hljs-number">4</span>)
                  ],
                ),
              )),
         <span class="hljs-attr"> onPressed</span>: () {
            <span class="hljs-title function_ invoke__">setState</span>(() {
              currentDate = uniqueDate;
            });
            widget.<span class="hljs-title function_ invoke__">onDateChanged</span>(currentDate);
          },
        ),
      ),
    );
    dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: <span class="hljs-number">1</span>)));
    singleDate = singleDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: <span class="hljs-number">1</span>));
  }
  <span class="hljs-comment">// 下月日期填充</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; <span class="hljs-number">7</span> - singleDate.weekday; i++) {
    dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: i)));
    datesOfThisMonth.<span class="hljs-title function_ invoke__">add</span>(
      <span class="hljs-title function_ invoke__">Expanded</span>(
       <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Container</span>(
         <span class="hljs-attr"> alignment</span>: Alignment.center,
         <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">5</span>),
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
             <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceEvenly,
             <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
             <span class="hljs-attr"> children</span>: [
                <span class="hljs-title function_ invoke__">Text</span>(dateData[dateData.length - <span class="hljs-number">1</span>].day.<span class="hljs-title function_ invoke__">toString</span>(),
                   <span class="hljs-attr"> style</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> fontSize</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">color</span>: CupertinoColors.inactiveGray),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
                <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">SizedBox</span>(<span class="hljs-attr">height</span>: <span class="hljs-number">10</span>)
              ]),
        ),
      ),
    );
  }
  <span class="hljs-comment">// 汇总所有日期</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; datesOfThisMonth.length; i++) {
    returnData.<span class="hljs-title function_ invoke__">add</span>(datesOfThisMonth[i]);
  }
  <span class="hljs-keyword">return</span> returnData;
}
</code></pre>
<p>大家注意阅读这段代码，当月日期我用了<code>CupertinoButton</code>。这样做的目的显然是<strong>增加点击响应，也就是为用户切换日期提供可能</strong>。</p>
<p>这里返回的<code>List&#x3C;Widget></code>指的是日期矩阵内单个元素，而非整个日期矩阵。</p>
<p>大家还记得前面我曾提到的数字 7 吗？<strong>日期矩阵中一行恰好是 7 个元素，元素总数又是 7 的倍数</strong>。于是，便可<strong>首先根据总元素数计算出总行数，再以 <code>7 * 行数</code> 为循环结束条件遍历整个矩阵元素，最后将每行内的元素作为 Row 组件的子组件，再将所有行的 Row 组件作为 Column 组件的子组件</strong>，构建整个日期矩阵。代码片段如下：</p>
<pre><code class="hljs language-ini">// 生成日期组件矩阵
List&#x3C;Widget> allDatesWidget(List&#x3C;Widget> allDates) {
  List&#x3C;Widget> <span class="hljs-attr">allLinesWidgets</span> = []<span class="hljs-comment">;</span>
  int <span class="hljs-attr">linesCount</span> = allDates.length ~/ <span class="hljs-number">7</span><span class="hljs-comment">;</span>
  for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &#x3C; linesCount; i++) {</span>
    List&#x3C;Widget> <span class="hljs-attr">singleLineWidgets</span> = []<span class="hljs-comment">;</span>
    for (int <span class="hljs-attr">j</span> = <span class="hljs-number">0</span><span class="hljs-comment">; j &#x3C; 7; j++) {</span>
      singleLineWidgets.add(allDates<span class="hljs-section">[i * 7 + j]</span>)<span class="hljs-comment">;</span>
    }
    allLinesWidgets.add(Row(
        mainAxisSize: MainAxisSize.max,
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: singleLineWidgets))<span class="hljs-comment">;</span>
  }
  return allLinesWidgets<span class="hljs-comment">;</span>
}
@override
Widget build(BuildContext context) {
  return Container(
    color: CupertinoColors.white,
    padding: const EdgeInsets.all(15),
    child: Column(
      children: <span class="hljs-section">[
        // 日期矩阵
        Container(
          margin: const EdgeInsets.only(top: 10),
          child: Column(
            children: allDatesWidget(allDates()),
          ),
        )
      ]</span>,
    ),
  )<span class="hljs-comment">;</span>
}
</code></pre>
<p>到此，我们应该可以得到正确的日期矩阵了。</p>
<p>后面的工作无需多说，自然是添加<strong>年月显示</strong>、<strong>相邻月份跳转</strong>以及<strong>数据库查询</strong>和<strong>UI 显示</strong>了。这些功能实现起来都比较简单，大家可以先自行尝试实现。本讲末尾附录为大家提供了完整的 explore_calendar.dart 和 calendar_widget.dart 源码。如果你在实现过程中遇到了困难，可以参考使用。</p>
<h2>小结</h2>
<p>🎉 恭喜，您完成了本次课程的学习！</p>
<p>📌 以下是本次课程的重点内容总结：</p>
<p>本讲我以日历为例，介绍了如何在 Flutter 中实现稍复杂的自定义组件。通过本讲的学习，相信大家对“一切皆组件”这句话有更深刻的理解：<strong>再复杂的组件也不过是基础组件的排列组合</strong>。</p>
<p>对于较为复杂的自定义组件而言，实现它的步骤是先进行功能拆解，把看似复杂的功能梳理成清晰的需求，拆解成若干易于实现的“小功能”。然后逐个“击破”它们。</p>
<p>此外，对 Dart 编程语言的理解也很重要。我相信有的人面对日期计算，会下意识地自行实现。而自行实现会面对很多挑战，比如闰年的处理、年/月份的自动加/减 1 等等。如果之前对 DateTime 有印象，就不至于创造这些困难，而是轻松解决了。</p>
<p>好了，本讲到此就该和大家说再见了。</p>
<p>在下一讲中，我将介绍事件总线的使用方法，它和观察者模式很像，但又不完全一样。它们都是发布订阅模型，为编码提供了很多方便。让我们拭目以待，下一讲见！</p>
<h2>附录一：explore_calendar.dart 完整源码</h2>
<pre><code class="hljs language-ini">import 'package:flutter/cupertino.dart'<span class="hljs-comment">;</span>
import '../../../util/db_util.dart'<span class="hljs-comment">;</span>
import '../widget/diary_list_widget.dart'<span class="hljs-comment">;</span>
import 'widget/calender_widget.dart'<span class="hljs-comment">;</span>
class ExploreCalenderPage extends StatefulWidget {
  const ExploreCalenderPage({Key? key}) : super(key: key)<span class="hljs-comment">;</span>
  @override
  State&#x3C;ExploreCalenderPage> createState() => _ExploreCalenderPageState()<span class="hljs-comment">;</span>
}
class _ExploreCalenderPageState extends State&#x3C;ExploreCalenderPage> {
  List&#x3C;Map&#x3C;String, Object?>> <span class="hljs-attr">allDiaryRow</span> = []<span class="hljs-comment">;</span>
  List&#x3C;Diary> <span class="hljs-attr">allDiary</span> = []<span class="hljs-comment">;</span>
  List&#x3C;Map&#x3C;String, Object?>> <span class="hljs-attr">allDiaryMonthlyRow</span> = []<span class="hljs-comment">;</span>
  List&#x3C;Diary> <span class="hljs-attr">allDiaryMonthly</span> = []<span class="hljs-comment">;</span>
  var saveDiaryDoneListener<span class="hljs-comment">;</span>
  DateTime <span class="hljs-attr">selectedDate</span> = DateTime.now()<span class="hljs-comment">;</span>
  Set&#x3C;DateTime> <span class="hljs-attr">markedDates</span> = {}<span class="hljs-comment">;</span>
  // 日期选择器组件
  Widget calenderSelector() {
    return CalenderWidget(
      markedDate: markedDates,
      onDateChanged: (currentDate) {
        <span class="hljs-attr">selectedDate</span> = currentDate<span class="hljs-comment">;</span>
        loadAllDiary()<span class="hljs-comment">;</span>
      },
    )<span class="hljs-comment">;</span>
  }
  // 载入所有日记
  void loadAllDiary() async {
    await DatabaseUtil.instance.openDb()<span class="hljs-comment">;</span>
    // 读取当天的日记
    <span class="hljs-attr">allDiaryRow</span> = await DatabaseUtil.instance.queryByDate(selectedDate)<span class="hljs-comment">;</span>
    allDiary.clear()<span class="hljs-comment">;</span>
    if (allDiaryRow.isNotEmpty) {
      for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &#x3C; allDiaryRow.length; i++) {</span>
        allDiary.add(Diary().fromMap(allDiaryRow<span class="hljs-section">[i]</span>))<span class="hljs-comment">;</span>
      }
    }
    // 读取当月的日记
    <span class="hljs-attr">allDiaryMonthlyRow</span> = await DatabaseUtil.instance.queryByMonth(selectedDate)<span class="hljs-comment">;</span>
    if (allDiaryMonthlyRow.isNotEmpty) {
      for (int <span class="hljs-attr">i</span> = <span class="hljs-number">0</span><span class="hljs-comment">; i &#x3C; allDiaryMonthlyRow.length; i++) {</span>
        Diary <span class="hljs-attr">singleDiary</span> = Diary().fromMap(allDiaryMonthlyRow[i])<span class="hljs-comment">;</span>
        markedDates.add(DateTime(singleDiary.date.year, singleDiary.date.month,
            singleDiary.date.day))<span class="hljs-comment">;</span>
      }
    }
    setState(() {})<span class="hljs-comment">;</span>
  }
  @override
  void initState() {
    super.initState()<span class="hljs-comment">;</span>
    loadAllDiary()<span class="hljs-comment">;</span>
  }
  @override
  Widget build(BuildContext context) {
    return SafeArea(
      child: Container(
        decoration: const BoxDecoration(
          image: DecorationImage(
            fit: BoxFit.cover,
            image: AssetImage('assets/image/bg.jpg'),
          ),
        ),
        child: Column(
          children: <span class="hljs-section">[
            calenderSelector(),
            Container(height: 5),
            Expanded(
              child: SingleChildScrollView(
                child: DiaryListWidget.diaryList(allDiary),
              ),
            ),
          ]</span>,
        ),
      ),
    )<span class="hljs-comment">;</span>
  }
}
</code></pre>
<h2>附录二：calendar_widget.dart 完整源码</h2>
<pre><code class="hljs language-php">import <span class="hljs-string">'package:flutter/cupertino.dart'</span>;
import <span class="hljs-string">'package:flutter/material.dart'</span>;
import <span class="hljs-string">'../../../../constants.dart'</span>;
import <span class="hljs-string">'../../../../util/datetime_util.dart'</span>;
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CalenderWidget</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">StatefulWidget</span> </span>{
  <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CalenderWidget</span>(
      {Key? key, required this.markedDate, required this.onDateChanged})
      : <span class="hljs-title function_ invoke__">super</span>(<span class="hljs-attr">key</span>: key);
  <span class="hljs-keyword">final</span> Set&#x3C;DateTime> markedDate;
  <span class="hljs-keyword">final</span> Function onDateChanged;
  @override
  State&#x3C;StatefulWidget> <span class="hljs-title function_ invoke__">createState</span>() => <span class="hljs-title function_ invoke__">_CalenderWidgetState</span>();
}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">_CalenderWidgetState</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">State</span>&#x3C;<span class="hljs-title">CalenderWidget</span>> </span>{
  DateTime currentDate = DateTime.<span class="hljs-title function_ invoke__">now</span>();
  <span class="hljs-comment">// 跳到上一个月</span>
  <span class="hljs-keyword">void</span> <span class="hljs-title function_ invoke__">jumpToPreviousMonth</span>() {
    <span class="hljs-title function_ invoke__">setState</span>(() {
      currentDate = currentDate.<span class="hljs-title function_ invoke__">subtract</span>(<span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: <span class="hljs-number">31</span>));
    });
    widget.<span class="hljs-title function_ invoke__">onDateChanged</span>(currentDate);
  }
  <span class="hljs-comment">// 跳到下一个月</span>
  <span class="hljs-keyword">void</span> <span class="hljs-title function_ invoke__">jumpToNextMonth</span>() {
    <span class="hljs-title function_ invoke__">setState</span>(() {
      currentDate = currentDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: <span class="hljs-number">31</span>));
    });
    widget.<span class="hljs-title function_ invoke__">onDateChanged</span>(currentDate);
  }
  <span class="hljs-comment">// 年月顶栏</span>
  Widget <span class="hljs-title function_ invoke__">topBar</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Row</span>(
     <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
     <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceBetween,
     <span class="hljs-attr"> children</span>: [
        <span class="hljs-title function_ invoke__">SizedBox</span>(
         <span class="hljs-attr"> width</span>: <span class="hljs-number">20</span>,
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">CupertinoButton</span>(
           <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">0</span>),
           <span class="hljs-attr"> child</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Icon</span>(CupertinoIcons.arrow_left, <span class="hljs-attr">size</span>: <span class="hljs-number">18</span>),
           <span class="hljs-attr"> onPressed</span>: () {
              <span class="hljs-title function_ invoke__">jumpToPreviousMonth</span>();
            },
          ),
        ),
        <span class="hljs-title function_ invoke__">Text</span>(DateTimeUtil.<span class="hljs-title function_ invoke__">parseMonth</span>(currentDate)),
        <span class="hljs-title function_ invoke__">SizedBox</span>(
         <span class="hljs-attr"> width</span>: <span class="hljs-number">20</span>,
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">CupertinoButton</span>(
           <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">0</span>),
           <span class="hljs-attr"> child</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Icon</span>(CupertinoIcons.arrow_right, <span class="hljs-attr">size</span>: <span class="hljs-number">18</span>),
           <span class="hljs-attr"> onPressed</span>: () {
              <span class="hljs-title function_ invoke__">jumpToNextMonth</span>();
            },
          ),
        ),
      ],
    );
  }
  <span class="hljs-comment">// 存在日志指示灯</span>
  Widget <span class="hljs-title function_ invoke__">diaryExistDot</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">const</span> <span class="hljs-variable constant_">SizedBox</span>(
      width: <span class="hljs-number">4</span>,
      height: <span class="hljs-number">4</span>,
      child: <span class="hljs-title function_ invoke__">CircleAvatar</span>(),
    );
  }
  <span class="hljs-comment">// 计算并生成单个日期组件</span>
  List&#x3C;Map> <span class="hljs-title function_ invoke__">allDates</span>() {
    <span class="hljs-keyword">int</span> currentDay = currentDate.day;
    List&#x3C;Map> returnData = [];
    DateTime singleDate = <span class="hljs-title function_ invoke__">DateTime</span>(currentDate.year, currentDate.month, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">int</span> month = currentDate.month;
    List&#x3C;Widget> datesOfThisMonth = [];
    List&#x3C;DateTime> dateData = [];
    <span class="hljs-comment">// 上个月日期填充</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; singleDate.weekday; i++) {
      dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate.<span class="hljs-title function_ invoke__">subtract</span>(<span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: singleDate.weekday - i)));
      datesOfThisMonth.<span class="hljs-title function_ invoke__">add</span>(
        <span class="hljs-title function_ invoke__">Expanded</span>(
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Container</span>(
             <span class="hljs-attr"> alignment</span>: Alignment.center,
             <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">5</span>),
             <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
               <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceEvenly,
               <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
               <span class="hljs-attr"> children</span>: [
                  <span class="hljs-title function_ invoke__">Text</span>(
                    dateData[i].day.<span class="hljs-title function_ invoke__">toString</span>(),
                   <span class="hljs-attr"> style</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> fontSize</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">color</span>: CupertinoColors.inactiveGray),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center,
                  ),
                  <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">SizedBox</span>(<span class="hljs-attr">height</span>: <span class="hljs-number">10</span>)
                ],
              )),
        ),
      );
    }
    <span class="hljs-comment">// 本月首天</span>
    dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate);
    <span class="hljs-comment">// 本月日期填充</span>
    <span class="hljs-keyword">while</span> (singleDate.month == month) {
      DateTime uniqueDate = singleDate;
      datesOfThisMonth.<span class="hljs-title function_ invoke__">add</span>(
        <span class="hljs-title function_ invoke__">Expanded</span>(
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">CupertinoButton</span>(
           <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">0</span>),
           <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Container</span>(
               <span class="hljs-attr"> alignment</span>: Alignment.center,
               <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">5</span>),
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">CircleAvatar</span>(
                 <span class="hljs-attr"> backgroundColor</span>: currentDay == singleDate.day
                      ? Consts.themeColor
                      : CupertinoColors.white,
                 <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
                   <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceEvenly,
                   <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
                   <span class="hljs-attr"> children</span>: [
                      <span class="hljs-title function_ invoke__">Text</span>(singleDate.day.<span class="hljs-title function_ invoke__">toString</span>(),
                         <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                             <span class="hljs-attr"> fontSize</span>: <span class="hljs-number">15</span>,
                             <span class="hljs-attr"> color</span>: currentDay == singleDate.day
                                  ? CupertinoColors.white
                                  : CupertinoColors.black),
                         <span class="hljs-attr"> textAlign</span>: TextAlign.center),
                      widget.markedDate.<span class="hljs-title function_ invoke__">contains</span>(uniqueDate) &#x26;&#x26;
                              currentDay != singleDate.day
                          ? <span class="hljs-title function_ invoke__">diaryExistDot</span>()
                          : <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">SizedBox</span>(<span class="hljs-attr">height</span>: <span class="hljs-number">4</span>)
                    ],
                  ),
                )),
           <span class="hljs-attr"> onPressed</span>: () {
              <span class="hljs-title function_ invoke__">setState</span>(() {
                currentDate = uniqueDate;
              });
              widget.<span class="hljs-title function_ invoke__">onDateChanged</span>(currentDate);
            },
          ),
        ),
      );
      dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: <span class="hljs-number">1</span>)));
      singleDate = singleDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: <span class="hljs-number">1</span>));
    }
    <span class="hljs-comment">// 下月日期填充</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; <span class="hljs-number">7</span> - singleDate.weekday; i++) {
      dateData.<span class="hljs-title function_ invoke__">add</span>(singleDate.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-title function_ invoke__">Duration</span>(<span class="hljs-attr">days</span>: i)));
      datesOfThisMonth.<span class="hljs-title function_ invoke__">add</span>(
        <span class="hljs-title function_ invoke__">Expanded</span>(
         <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Container</span>(
           <span class="hljs-attr"> alignment</span>: Alignment.center,
           <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">5</span>),
           <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
               <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceEvenly,
               <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
               <span class="hljs-attr"> children</span>: [
                  <span class="hljs-title function_ invoke__">Text</span>(dateData[dateData.length - <span class="hljs-number">1</span>].day.<span class="hljs-title function_ invoke__">toString</span>(),
                     <span class="hljs-attr"> style</span>: <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">TextStyle</span>(
                         <span class="hljs-attr"> fontSize</span>: <span class="hljs-number">15</span>, <span class="hljs-attr">color</span>: CupertinoColors.inactiveGray),
                     <span class="hljs-attr"> textAlign</span>: TextAlign.center),
                  <span class="hljs-keyword">const</span> <span class="hljs-title function_ invoke__">SizedBox</span>(<span class="hljs-attr">height</span>: <span class="hljs-number">10</span>)
                ]),
          ),
        ),
      );
    }
    <span class="hljs-comment">// 汇总所有日期</span>
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; datesOfThisMonth.length; i++) {
      returnData.<span class="hljs-title function_ invoke__">add</span>({<span class="hljs-string">'date'</span>: dateData[i], <span class="hljs-string">'widget'</span>: datesOfThisMonth[i]});
    }
    <span class="hljs-keyword">return</span> returnData;
  }
  <span class="hljs-comment">// 生成日期组件矩阵</span>
  List&#x3C;Widget> <span class="hljs-title function_ invoke__">allDatesWidget</span>(List&#x3C;Map> allDates) {
    List&#x3C;Widget> allLinesWidgets = [];
    <span class="hljs-keyword">int</span> linesCount = allDates.length ~/ <span class="hljs-number">7</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &#x3C; linesCount; i++) {
      List&#x3C;Widget> singleLineWidgets = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &#x3C; <span class="hljs-number">7</span>; j++) {
        singleLineWidgets.<span class="hljs-title function_ invoke__">add</span>(allDates[i * <span class="hljs-number">7</span> + j][<span class="hljs-string">'widget'</span>] <span class="hljs-keyword">as</span> Widget);
      }
      allLinesWidgets.<span class="hljs-title function_ invoke__">add</span>(<span class="hljs-title function_ invoke__">Row</span>(
         <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
         <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceBetween,
         <span class="hljs-attr"> children</span>: singleLineWidgets));
    }
    <span class="hljs-keyword">return</span> allLinesWidgets;
  }
  @override
  Widget <span class="hljs-title function_ invoke__">build</span>(BuildContext context) {
    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">Container</span>(
     <span class="hljs-attr"> color</span>: CupertinoColors.white,
     <span class="hljs-attr"> padding</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">all</span>(<span class="hljs-number">15</span>),
     <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
       <span class="hljs-attr"> children</span>: [
          // 年月顶栏
          <span class="hljs-title function_ invoke__">topBar</span>(),
          // 分割线
          <span class="hljs-title function_ invoke__">Container</span>(
           <span class="hljs-attr"> height</span>: <span class="hljs-number">10</span>,
          ),
          // 星期显示标头
          <span class="hljs-title function_ invoke__">Row</span>(
           <span class="hljs-attr"> mainAxisSize</span>: MainAxisSize.max,
           <span class="hljs-attr"> mainAxisAlignment</span>: MainAxisAlignment.spaceBetween,
           <span class="hljs-attr"> children</span>: <span class="hljs-keyword">const</span> [
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'日'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'一'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'二'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'三'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'四'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'五'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
              <span class="hljs-title function_ invoke__">Expanded</span>(
               <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Text</span>(<span class="hljs-string">'六'</span>,
                   <span class="hljs-attr"> style</span>: <span class="hljs-title function_ invoke__">TextStyle</span>(
                       <span class="hljs-attr"> color</span>: CupertinoColors.placeholderText, <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>),
                   <span class="hljs-attr"> textAlign</span>: TextAlign.center),
              ),
            ],
          ),
          // 日期矩阵
          <span class="hljs-title function_ invoke__">Container</span>(
           <span class="hljs-attr"> margin</span>: <span class="hljs-keyword">const</span> EdgeInsets.<span class="hljs-title function_ invoke__">only</span>(<span class="hljs-attr">top</span>: <span class="hljs-number">10</span>),
           <span class="hljs-attr"> child</span>: <span class="hljs-title function_ invoke__">Column</span>(
             <span class="hljs-attr"> children</span>: <span class="hljs-title function_ invoke__">allDatesWidget</span>(<span class="hljs-title function_ invoke__">allDates</span>()),
            ),
          )
        ],
      ),
    );
  }
}
</code></pre></div>
</body></html>