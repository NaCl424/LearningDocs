<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>第 01 讲：设计一份吸引面试官的简历</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* 页边距 和 页面大小 */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* 引用 */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* 表格 */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* 表格 背景色 */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* 粗体 */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* 斜体 */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* 图片 */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* 当 “![shadow-随便写]()”写时，会有阴影 */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* 代码框 */
/* CodeMirror 3024 Day theme */

/* 代码段 背景 */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* 边框 */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>数据可视化：基于 Strapi 实现后台数据的灵活配置</h1>
<blockquote>
<p>仓库地址：<a href="https://github.com/czm1290433700/nextjs-cms" target="_blank" rel="nofollow noopener noreferrer">https://github.com/czm1290433700/nextjs-cms</a></p>
</blockquote>
<p>上一节课程，我们学习了 Nextjs 中静态页面的开发方式，了解了 Nextjs 的文件约定式路由，模板页面的开发和通用 layout 的配置，不过之前的页面数据仍然是通过静态的数据进行注入的。从这节课开始，我们将继续完善官网项目数据层的链路。</p>
<p>作为 C 端网站，通常都有一个后台数据配置的平台，即 CMS（内容管理平台）。这个平台是居于后端与前端之间的一个数据管理平台，通常给运营或是相关审核同学进行内容的配置。</p>
<p>官网也不例外，不同的是，官网的数据具备更强的实时性要求，不仅仅是数据文章，包括 logo、标题等官网内可见的数据，其实都可能会涉及到频繁变动，那么，怎么去搭建一个后台平台可以灵活配置官网数据，又可以尽可能低地降低开发成本呢？</p>
<p>我们知道设计模式中有一种模式是装饰者模式，通过定义装饰类型，来对基础类型提供一些额外的能力，从而达到我们需要的不同场景，所以其实针对 CMS ，我们也并不需要从头去开发，因为大部分场景下的基础能力其实是高度相似的，只是不同的业务场景所需要配置的表格和字段不同。</p>
<p>这里我推荐大家使用 Strapi， 这是一个开源无头的 CMS 配置 Api。基于 Strapi ，可以快速针对我们的业务场景搭建一套对应的 CMS，包括增删改查和联表等较复杂场景，都可以通过可视化的配置实现。对于自定义较高的场景，它也暴露了相关的参数进行自定义，我们可以使用较少的开发量去实现特殊场景，下面我们就通过 Strapi 来实现我们官网后台的数据配置。</p>
<h1>项目初始化</h1>
<p>首先我们执行 Strapi 提供的脚手架命令来初始化项目。</p>
<pre><code class="hljs language-lua">npx <span class="hljs-built_in">create</span>-strapi-app nextjs-cms <span class="hljs-comment">--quickstart</span>
</code></pre>
<p>它会在当前目录生成名为 nextjs-cms 的项目，并且会自动运行，我们也可以进入到项目目录中执行脚本运行。</p>
<pre><code class="hljs language-arduino">npm install
npm run develop
</code></pre>
<p>会打开一个登录页，我们按照指示配置一下账号密码，登录一下就可以了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5b5568ba4de4d228fe48dae935662ff~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<h1>数据的可视化配置</h1>
<ol>
<li>
<h2>结构体的定义</h2>
</li>
</ol>
<p>在完成上面的登录后，我们可以进到 Strapi 的管理页面。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/15b0cfbdc14d4f1e9bd35800da1ab6b0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>其中<code>content manager</code>是我们 Api 的数据，而<code>content-type builder</code>对应我们 Api 的结构体，我们以上一章节 layout 下的静态数据举例：</p>
<pre><code class="hljs language-css">footerData: {
      title: <span class="hljs-string">"Demo"</span>,
      linkList: [
        {
          title: <span class="hljs-string">"技术栈"</span>,
          list: [
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"react"</span>,
            },
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"typescript"</span>,
            },
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"ssr"</span>,
            },
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"nodejs"</span>,
            },
          ],
        },
        {
          title: <span class="hljs-string">"了解更多"</span>,
          list: [
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"掘金"</span>,
              link: <span class="hljs-string">"https://juejin.cn/user/2714061017452557"</span>,
            },
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"知乎"</span>,
              link: <span class="hljs-string">"https://www.zhihu.com/people/zmAboutFront"</span>,
            },
            {
              <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"csdn"</span>,
            },
          ],
        },
        {
          title: <span class="hljs-string">"联系我"</span>,
          list: [{ <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"微信"</span> }, { <span class="hljs-selector-tag">label</span>: <span class="hljs-string">"QQ"</span> }],
        },
      ],
      qrCode: {
        image: code,
        text: <span class="hljs-string">"祯民讲前端微信公众号"</span>,
      },
      copyRight: <span class="hljs-string">"Copyright © 2022 xxx. 保留所有权利"</span>,
      siteNumber: <span class="hljs-string">"粤ICP备XXXXXXXX号-X"</span>,
      publicNumber: <span class="hljs-string">"粤公网安备 xxxxxxxxxxxxxx号"</span>,
    },
  }
</code></pre>
<p>针对这样一个结构体，应该如何去定义我们的 Api 呢，首先我们切到 <code>content-type builder</code>。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0dd142db18af4519b95a778b2e2bbda1~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>大家打开的时候应该只有一个 User，这几个结构体是我后面创建的，可以看到，这其中定义的其实就是我们需要的对应字段和它们的类型，如果需要创建一个新的结构体，我们点击<code>create new collection type</code>。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91ac5647d3e24cff88580a0e93ac6714~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>填完<code>display name</code>后，对应的单数和复数 id 它会自动生成，就是右边的两项，name 我们填需要的结构体就可以，至于右边的 tab 是一些高级配置，我们这里用不到可以先不管它。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e19ccb54230a4de38d61b5e533328ab1~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>然后为我们的结构体创建一些字段，常见的类型包括文本、boolean值、富文本，这些这里都是有的，咱们以 title 举例，因为是一个字符串，所以我们点 <code>text</code>。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d08a9fa5e08748cd861436af8963ddb9~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/512e6b47f0104de7b13d26aed3fe863f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>咱们这个直接用短文本就好，然后高级配置我们可以选个必填和唯一。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/85dde6228cba4d27ab060add2865dff5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>对应的字段就加好了，对于别的部分，我们用相同的方式加进来就可以，稍微特殊一些的字段是 linkList，可以看到它其实是一个对象数组，我们先把 footdata 的关系按照思维导图梳理一下。
<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6730a76e57c8405baf5fb68d4c68ae1f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>按照数据结构我们可以发现，footerdata 和 linklist，它们是一对多的关系，而 linklist 中又包含多个link，也是一对多的关系，所以要描述这部分字段，光 layout 一个结构体是不够的，我们需要创建 linklist 和 link，然后给它们之间来建立对应的关系。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/50b4909f24b74e09b0fb3ce62ef050aa~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>确定了思路，我们按照上面的来创建好 linklist 和 link 的结构体。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f460315f9a3b4ac2b1b247abe1384a52~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/54acf53e51954391b6c7eff796ea6f5a~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>那 linklist 和 link 的关系我们应该怎么建立呢？可以按之前说的，我们在 linklist 结构体中，点新建字段。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3c1b97985ac4483098471be038c9dca4~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>然后我们点击 relation 属性，这个属性我们用来联立结构体之间的数据库关系。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/93ff6ffcde724511bd6bffcfa36229b3~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>这里说一下从属和普通联合的区别，如果是从属关系，对应的属性会加到需要关联的结构体，并不会体现在当前表，可以理解为 a 是 b 的一个属性。如果是普通的联合，图中 icon 带有箭头的，是将 b 作为属性加到 a 中，每次切换下面也有对应的英文描述，大家可以结合理解。</p>
<p>根据上面我们说的关系，这里应该是选最后一个，也就是一对多，link 是作为 linklist 的属性来存在的，我们可以点完成，发现就已经加上了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2115080db7d4ace8799de6271d2f3a3~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>接下来，我们按照上面的原理配置完所有的结构体即可。</p>
<ol start="2">
<li>
<h2>结构体数据的写入</h2>
</li>
</ol>
<p>定义完结构体以后，我们需要为结构体加入一些数据，通常在开发完后，运营相关的同学配置，就只要进行这一步就可以了，别的部分就不需要再调整了，我们点击<code>content manager</code>。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90311104d25b4939822f440ab0b19209~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>数据的配置我们需要按照<strong>从子到父</strong>的原则，很好理解，因为 layout 有相关的字段依赖于 linklist， linklist 又依赖于 link，所以只有 link 配置完以后，才可以进行 linklist 和 layout 的配置，这里我们以 link 和 linklist 举例。</p>
<p>切到 link 的部分，点击 <code>create new entry</code>，可以进到下面的页面，我们输入完内容以后，可以进行保存，这里保存有两个按钮， 一个是 save， 一个是 publish，如果点击 publish 会生效到实际 cdn， 这里我们可以先点击 publish， 实际场景下运营配置的时候可以点 save，在 review 没问题后再发布即可。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9f85d6379aa046398fe42e48f97c6b7f~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>配置完大致是这样的：</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fdddc1bc1b194ea89bd388f7233b609b~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>然后我们配置 linklist 的部分，同样是点<code>create new entry</code>。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c1db958e5e0442de804cdaab80ac6488~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>除了基本的字段，右侧还会有对应关联的字段，勾选我们需要的就可以关联上了。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6f6ad40ac1494dd98e0d167f8e1f082d~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>保存完成后，我们可以看到对应的关联对象内容，确认无误就行了，然后剩下的部分我们用同样的原理完成就行。</p>
<ol start="3">
<li>
<h2>Api 权限配置及上线</h2>
</li>
</ol>
<p>结构体和数据定义完成后，我们已经完成大半了，现在问题是我们应该在哪里配置我们的 Api，使得有个 cdn 可以看到呢？</p>
<p>我们点击<code>settings -> Roles</code>，这里是权限配置的部分，包含作者权限和公共权限，因为需要所有的人可以看到我们的接口，所以我们点 public 右侧的 🖊（如果有特别需求的同学，可以点击 <code>add new role</code> 新增权限角色，再进行后续的步骤。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c37c6e5384b34b24997484edd1973c25~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>可以看到，我们之前定义的结构体，左侧对应结构体支持的类型，右侧对应结构体接口的指向 Api 路由。因为我们这边要给对应的接口配置全查和单查的能力，所以我们勾选上 find 和 findOne。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4474e1c87fee41559207388479bed9b5~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>因为 layout 依赖于 link 和 link-list，所以 link 和 link-list 的结构体我们也需勾选上 find 和 findOne，完成这些后，我们访问 <a href="http://localhost:1337/api/layouts" target="_blank" rel="nofollow noopener noreferrer">http://localhost:1337/api/layouts</a> 试一下。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b6c1e76a1b9f4722bb315cf178bf6daa~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>细心的同学会发现，好像只有基础的字段，联表的 linklist 和 link 去哪里了？这是因为 Strapi 默认是不会填充联表关系的，我们可以在路由后加<code>populate=*</code>，这个入参的意义是为所有的关系填充一级关系。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/da70fcfc566445e7b7b8d3b7fe12dedd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>可以看到现在已经有了，不过这个入参只能填充一级深度，如果有两层这种写法就不行了，引用一个官网的例子。</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/18d5092a87a94ea1a5c951c92d38a6cd~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>比如这样的结构，我们需要指定对应属性和子属性才可以，如果是这样，那可真的太糟糕了，每次我们配置一个复杂的结构体得花多少精力来配置入参呀！为了解决这个问题，我推荐大家使用<code>strapi-plugin-populate-deep</code>，这是基于 Strapi 的一个深度插件，我们切到项目目录下的终端安装一下。</p>
<pre><code class="hljs language-css">npm install strapi-plugin-populate-deep <span class="hljs-attr">--save</span>
</code></pre>
<p>然后重启一下，我们尝试访问 <a href="http://localhost:1337/api/layouts?populate=deep" target="_blank" rel="nofollow noopener noreferrer">http://localhost:1337/api/layouts?populate=deep</a> 。</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a4a684d55d3240a291fffc705e8f1e37~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>deep 参数的含义为使用默认的最大深度填充请求，即 5 层，如果 5 层不满足大家的需求，需要更多，入参的调整也很方便，比如针对 10 层的场景，我们只需要传递入参 <code>populate=deep,10</code>就可以，相比原生复杂的语法定义好理解很多~</p>
<h1>项目结构 &#x26; 调试</h1>
<p>上面我们通过可视化配置了一个接口，不过 Strapi 的能力远不止此，它提供了大量的 openApi ，可以支持自定义接口的开发，为了大家后续能更好理解自定义开发的过程，我们一起来看看之前脚手架生成的 Strapi 项目结构是怎么样的。</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0b5630580d64efdaa45cd2706697390~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<p>这其中咱们最需要关注的有三个文件夹：</p>
<ul>
<li>.tmp/data.db: 我们项目的 db 文件，存放有 user、结构体、Api 鉴权等所有数据，默认使用 SQLite，我们可以使用 navicat for SQLite 打开看看。</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/65b3d11550b3421187c788872c0a7499~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<ul>
<li>config/ *<em>.</em> : config目录下包含着我们项目使用的配置，比如数据库、中间件等配置，可以通过它来换用别的数据库或是进行跨域网关等操作。以数据库文件举例，我们可以看到，其中使用着 SQlite 的数据库，并指向了上面我们提到的 db 文件路径。</li>
</ul>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ca7faf2ac234dc49ca1358c9e9df0e0~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<ul>
<li>src/api/*: 这其中定义着我们之前配置的结构体，我们可以在这其中对我们配置的 Api 数据进行拦截进行一些额外的处理等自定义操作，具体我们会在下一节课举例说明。</li>
</ul>
<p>因为是一个服务器端项目，所以我们肯定也需要在服务器层进行接口的调试，调试的方式很简单，我们只需要在 VSCode 的 debugger 控制台下运行项目，然后正常 debugger 即可。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ec22b1c51671455a9188d1f69bbe8f7c~tplv-k3u1fbpfcp-watermark.image?" alt="image.png"></p>
<h1>小结</h1>
<p>这节课，我们学习了怎么通过 Strapi 搭建一个符合我们自己业务场景的 CMS，并定义了对应的 find 接口用于后续的查询，同时我们遇到了不能深度联表的问题，并引入了对应的深度查询插件来解决。我们还学习了 Strapi 的项目结构和调试能力，为下一节课的自定义学习打下了基础。</p>
<p>下一节课我们将在目前 CMS 接口基础上进行一些自定义的调整，并且定义 BFF 层调用我们这节课配置好的数据源接口，来替换之前我们写的固定的静态数据，完成整个数据链路的过程。</p></div>
</body></html>