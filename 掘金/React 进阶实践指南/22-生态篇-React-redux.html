<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬ 01 è®²ï¼šè®¾è®¡ä¸€ä»½å¸å¼•é¢è¯•å®˜çš„ç®€å†</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* é¡µè¾¹è· å’Œ é¡µé¢å¤§å° */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* å¼•ç”¨ */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* è¡¨æ ¼ */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* è¡¨æ ¼ èƒŒæ™¯è‰² */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* ç²—ä½“ */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* æ–œä½“ */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* å›¾ç‰‡ */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* å½“ â€œ![shadow-éšä¾¿å†™]()â€å†™æ—¶ï¼Œä¼šæœ‰é˜´å½± */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* ä»£ç æ¡† */
/* CodeMirror 3024 Day theme */

/* ä»£ç æ®µ èƒŒæ™¯ */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* è¾¹æ¡† */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>ç”Ÿæ€ç¯‡-React-redux</h1>
<h2>ä¸€ å‰è¨€</h2>
<p>çŠ¶æ€ç®¡ç†æ˜¯å•é¡µé¢åº”ç”¨è§£å†³ç»„ä»¶çŠ¶æ€å…±äº«ï¼Œå¤æ‚ç»„ä»¶é€šä¿¡çš„æŠ€æœ¯æ–¹æ¡ˆã€‚æ¥ä¸‹æ¥çš„ä¸¤ä¸ªç« èŠ‚ï¼Œæˆ‘ä»¬å°†è¯¦ç»†ä»‹ç» React åº”ç”¨ä¸­å¸¸è§çš„ä¸¤ç§çŠ¶æ€ç®¡ç†æ–¹å¼- <strong>React-Redux</strong> å’Œ <strong>React-Mobx</strong> ã€‚</p>
<p>æœ¬ç« èŠ‚ä¸»è¦è®² React-Reduxï¼ŒåŒ…æ‹¬Redux è®¾è®¡æ€æƒ³ã€ä¸­é—´ä»¶åŸç†ï¼Œä»¥åŠ React-Redux çš„ç”¨æ³•å’ŒåŸç†ã€‚</p>
<h3>1 çŠ¶æ€ç®¡ç†åº”ç”¨åœºæ™¯</h3>
<p>çŠ¶æ€ç®¡ç†å·¥å…·ä¸ºä»€ä¹ˆå—åˆ°å¼€å‘è€…çš„æ¬¢è¿å‘¢ï¼Ÿæˆ‘è®¤ä¸ºé¦–å…ˆåº”è¯¥æƒ³æƒ³çŠ¶æ€ç®¡ç†é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ã€‚è§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p><strong>â‘  ç»„ä»¶ä¹‹é—´å…±ç”¨æ•°æ®ï¼Œå¦‚ä½•å¤„ç†?</strong></p>
<p>è®¾æƒ³ä¸€ç§åœºæ™¯ï¼Œå°±æ˜¯ä¸€äº›é€šè¿‡ ajax å‘æœåŠ¡å™¨è¯·æ±‚çš„é‡è¦æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯ï¼Œæƒé™åˆ—è¡¨ï¼Œå¯èƒ½ä¼šè¢«å¤šä¸ªç»„ä»¶éœ€è¦ï¼Œé‚£ä¹ˆå¦‚æœæ¯ä¸ªç»„ä»¶åˆå§‹åŒ–éƒ½è¯·æ±‚ä¸€éæ•°æ®æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ã€‚è¿™æ—¶å€™å¸¸ç”¨çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œåº”ç”¨åˆå§‹åŒ–æ—¶å€™ï¼Œåªè¯·æ±‚ä¸€æ¬¡æ•°æ®ï¼Œç„¶åé€šè¿‡çŠ¶æ€ç®¡ç†æŠŠæ•°æ®å­˜èµ·æ¥ï¼Œéœ€è¦æ•°æ®çš„ç»„ä»¶åªéœ€è¦ä»çŠ¶æ€ç®¡ç†ä¸­â€˜æ‹¿â€™å°±å¯ä»¥äº†ã€‚</p>
<p>æ•ˆæœå›¾ï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9c8cdb1e78cb458eb20cabc6d5cf8da4~tplv-k3u1fbpfcp-watermark.image" alt="3.jpg"></p>
<p><strong>â‘¡ å¤æ‚ç»„ä»¶ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ</strong></p>
<p>è¿˜æœ‰ä¸€ç§åœºæ™¯å°±æ˜¯å¯¹äº spa å•é¡µé¢åº”ç”¨ä¸€åˆ‡çš†ç»„ä»¶ï¼Œå¯¹äºåµŒå¥—æ¯”è¾ƒæ·±çš„ç»„ä»¶ï¼Œç»„ä»¶é€šä¿¡æˆäº†ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜ã€‚æ¯”å¦‚å¦‚ä¸‹çš„åœºæ™¯ï¼Œ B ç»„ä»¶å‘ H ç»„ä»¶ä¼ é€’æŸäº›ä¿¡æ¯ï¼Œé‚£ä¹ˆå¸¸è§„çš„é€šä¿¡æ–¹å¼ä¼¼ä¹éš¾ä»¥å®ç°ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™çŠ¶æ€ç®¡ç†å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå¯ä»¥æŠŠ B ç»„ä»¶çš„ä¿¡æ¯ä¼ é€’ç»™çŠ¶æ€ç®¡ç†å±‚ï¼ŒH ç»„ä»¶è¿æ¥çŠ¶æ€ç®¡ç†å±‚ï¼Œå†ç”±çŠ¶æ€ç®¡ç†å±‚é€šçŸ¥ H ç»„ä»¶ï¼Œè¿™æ ·å°±æœ¬è´¨è§£å†³äº†ç»„ä»¶é€šä¿¡é—®é¢˜ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/21ad27c2f61c4fa1a78e9d1262824fc7~tplv-k3u1fbpfcp-watermark.image" alt="4.jpg"></p>
<h3>2 React-Redux,Redux,Reactä¸‰è€…å…³ç³»</h3>
<p>åœ¨æ·±å…¥ç ”ç©¶ React-Redux ä¹‹å‰ï¼Œåº”è¯¥å…ˆå¼„æ˜ç™½ React-Redux ï¼ŒRedux ï¼Œ React ä¸‰è€…åˆ°åº•æ˜¯ä»€ä¹ˆå…³ç³»ã€‚</p>
<ul>
<li>
<p><code>Redux</code>ï¼š é¦–å…ˆ Redux æ˜¯ä¸€ä¸ªåº”ç”¨çŠ¶æ€ç®¡ç†jsåº“ï¼Œå®ƒæœ¬èº«å’Œ React æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œæ¢å¥è¯è¯´ï¼ŒRedux å¯ä»¥åº”ç”¨äºå…¶ä»–æ¡†æ¶æ„å»ºçš„å‰ç«¯åº”ç”¨ï¼Œç”šè‡³ä¹Ÿå¯ä»¥åº”ç”¨äº Vue ä¸­ã€‚</p>
</li>
<li>
<p><code>React-Redux</code>ï¼šReact-Redux æ˜¯è¿æ¥ React åº”ç”¨å’Œ Redux çŠ¶æ€ç®¡ç†çš„æ¡¥æ¢ã€‚React-redux ä¸»è¦ä¸“æ³¨ä¸¤ä»¶äº‹ï¼Œä¸€æ˜¯å¦‚ä½•å‘ React åº”ç”¨ä¸­æ³¨å…¥ redux ä¸­çš„ Store ï¼ŒäºŒæ˜¯å¦‚ä½•æ ¹æ® Store çš„æ”¹å˜ï¼ŒæŠŠæ¶ˆæ¯æ´¾å‘ç»™åº”ç”¨ä¸­éœ€è¦çŠ¶æ€çš„æ¯ä¸€ä¸ªç»„ä»¶ã€‚</p>
</li>
<li>
<p><code>React</code>ï¼šè¿™ä¸ªå°±ä¸å¿…å¤šè¯´äº†ã€‚</p>
</li>
</ul>
<p>ä¸‰è€…çš„å…³ç³»å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/83eaf84d71b04b94b7b7e754a6778cd1~tplv-k3u1fbpfcp-watermark.image" alt="3.jpg"></p>
<h3>3 æ¸©ä¹  Redux</h3>
<p>å½»åº•å¼„æ˜ç™½ React-Redux ä¹‹å‰ï¼Œå°±å¿…é¡»è¦ææ‡‚ Redux åœ¨ React ä¸­æ‰®æ¼”çš„è§’è‰²ã€‚Redux çš„è®¾è®¡æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªåŸåˆ™ï¼š</p>
<h4>â‘ ä¸‰å¤§åŸåˆ™</h4>
<ul>
<li>1 å•å‘æ•°æ®æµï¼šæ•´ä¸ª redux ï¼Œæ•°æ®æµå‘éƒ½æ˜¯å•å‘çš„ï¼Œæˆ‘ç”¨ä¸€å¼ å®˜ç½‘çš„å›¾ç‰‡æè¿°æ•´ä¸ªæ•°æ®æµåŠ¨çš„æµç¨‹ã€‚</li>
</ul>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3775935f59d435fa6326dbcef90519e~tplv-k3u1fbpfcp-watermark.image" alt="redux.gif"></p>
<ul>
<li>
<p>2 state åªè¯»ï¼šåœ¨ Redux ä¸­ä¸èƒ½é€šè¿‡ç›´æ¥æ”¹å˜ state ï¼Œæ¥è®©çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæƒ³è¦æ”¹å˜ state ï¼Œé‚£å°±å¿…é¡»è§¦å‘ä¸€æ¬¡ action ï¼Œé€šè¿‡ action æ‰§è¡Œæ¯ä¸ª reducer ã€‚</p>
</li>
<li>
<p>3 çº¯å‡½æ•°æ‰§è¡Œï¼šæ¯ä¸€ä¸ª reducer éƒ½æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œé‡Œé¢ä¸è¦æ‰§è¡Œä»»ä½•å‰¯ä½œç”¨ï¼Œè¿”å›çš„å€¼ä½œä¸ºæ–°çš„ state ï¼Œstate æ”¹å˜ä¼šè§¦å‘ store ä¸­çš„ subscribe ã€‚</p>
</li>
</ul>
<h4>â‘¡å‘å¸ƒè®¢é˜…æ€æƒ³</h4>
<p>redux å¯ä»¥ä½œä¸ºå‘å¸ƒè®¢é˜…æ¨¡å¼çš„ä¸€ä¸ªå…·ä½“å®ç°ã€‚redux éƒ½ä¼šåˆ›å»ºä¸€ä¸ª store ï¼Œé‡Œé¢ä¿å­˜äº†çŠ¶æ€ä¿¡æ¯ï¼Œæ”¹å˜ store çš„æ–¹æ³• dispatch ï¼Œä»¥åŠè®¢é˜… store å˜åŒ–çš„æ–¹æ³• subscribe ã€‚</p>
<h4>â‘¢ä¸­é—´ä»¶æ€æƒ³</h4>
<p>redux åº”ç”¨äº†å‰ç«¯é¢†åŸŸä¸ºæ•°ä¸å¤šçš„ä¸­é—´ä»¶ <code>compose</code> ï¼Œé‚£ä¹ˆ redux çš„ä¸­é—´ä»¶æ˜¯ç”¨æ¥åšä»€ä¹ˆçš„ï¼Ÿ ç­”æ¡ˆåªæœ‰ä¸€ä¸ªï¼š é‚£å°±æ˜¯<strong>å¼ºåŒ– dispatch</strong> ï¼Œ Redux æä¾›äº†ä¸­é—´ä»¶æœºåˆ¶ï¼Œä½¿ç”¨è€…å¯ä»¥æ ¹æ®éœ€è¦æ¥å¼ºåŒ– dispatch å‡½æ•°ï¼Œä¼ ç»Ÿçš„ dispatch æ˜¯ä¸æ”¯æŒå¼‚æ­¥çš„ï¼Œä½†æ˜¯å¯ä»¥é’ˆå¯¹ Redux åšå¼ºåŒ–ï¼Œäºæ˜¯æœ‰äº† <code>redux-thunk</code>ï¼Œ<code>redux-actions</code> ç­‰ä¸­é—´ä»¶ï¼ŒåŒ…æ‹¬ dvajs ä¸­ï¼Œä¹Ÿå†™äº†ä¸€ä¸ª redux æ”¯æŒ promise çš„ä¸­é—´ä»¶ã€‚</p>
<p>ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ compose æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> compose = <span class="hljs-function">(<span class="hljs-params">...funcs</span>) =></span> {
  <span class="hljs-keyword">return</span> funcs.reduce(<span class="hljs-function">(<span class="hljs-params">f, g</span>) =></span> <span class="hljs-function">(<span class="hljs-params">x</span>) =></span> f(g(x)));
}
</code></pre>
<ul>
<li>funcs ä¸ºä¸­é—´ä»¶ç»„æˆçš„æ•°ç»„ï¼Œcompose é€šè¿‡æ•°ç»„çš„ reduce æ–¹æ³•ï¼Œå®ç°æ‰§è¡Œæ¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¼ºåŒ– dispatch ã€‚</li>
</ul>
<h4>â‘£æ ¸å¿ƒapi</h4>
<p>å¯¹äºå†…éƒ¨åŸç†ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¤šè¯´äº†ï¼Œæ¯•ç«Ÿè¿™èŠ‚ä¸»è¦è®²çš„æ˜¯ React-Redux ï¼Œä¸»è¦å…ˆæ¥çœ‹ä¸€ä¸‹ redux å‡ ä¸ªæ¯”è¾ƒæ ¸å¿ƒçš„ api:</p>
<p><strong>createStore</strong></p>
<p><code>createStore</code> reduxä¸­é€šè¿‡ createStore å¯ä»¥åˆ›å»ºä¸€ä¸ª Store ï¼Œä½¿ç”¨è€…å¯ä»¥å°†è¿™ä¸ª Store ä¿å­˜ä¼ é€’ç»™ React åº”ç”¨ï¼Œå…·ä½“æ€ä¹ˆä¼ é€’é‚£å°±æ˜¯ React-Redux åšçš„äº‹äº†ã€‚é¦–å…ˆçœ‹ä¸€ä¸‹ createStore çš„ä½¿ç”¨ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> Store = createStore(rootReducer,initialState,middleware)
</code></pre>
<ul>
<li>å‚æ•°ä¸€ reducers ï¼š redux çš„ reducer ï¼Œå¦‚æœæœ‰å¤šä¸ªé‚£ä¹ˆå¯ä»¥è°ƒç”¨ combineReducers åˆå¹¶ã€‚</li>
<li>å‚æ•°äºŒ initialState ï¼šåˆå§‹åŒ–çš„ state ã€‚</li>
<li>å‚æ•°ä¸‰ middleware ï¼šå¦‚æœæœ‰ä¸­é—´ä»¶ï¼Œé‚£ä¹ˆå­˜æ”¾ redux ä¸­é—´ä»¶ã€‚</li>
</ul>
<p><strong>combineReducers</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* å°† number å’Œ PersonalInfo ä¸¤ä¸ªreduceråˆå¹¶   */</span>
<span class="hljs-keyword">const</span> rootReducer = combineReducers({ <span class="hljs-attr">number</span>:numberReducer,<span class="hljs-attr">info</span>:InfoReducer })
</code></pre>
<ul>
<li>æ­£å¸¸çŠ¶æ€å¯ä»¥ä¼šæœ‰å¤šä¸ª reducer ï¼ŒcombineReducers å¯ä»¥åˆå¹¶å¤šä¸ªreducerã€‚</li>
</ul>
<p><strong>applyMiddleware</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> middleware = applyMiddleware(logMiddleware)
</code></pre>
<ul>
<li>applyMiddleware ç”¨äºæ³¨å†Œä¸­é—´ä»¶ï¼Œæ”¯æŒå¤šä¸ªå‚æ•°ï¼Œæ¯ä¸€ä¸ªå‚æ•°éƒ½æ˜¯ä¸€ä¸ªä¸­é—´ä»¶ã€‚æ¯æ¬¡è§¦å‘ action ï¼Œä¸­é—´ä»¶ä¾æ¬¡æ‰§è¡Œã€‚</li>
</ul>
<h4>â‘¤ å®æˆ˜-reduxåŸºæœ¬ç”¨æ³•</h4>
<p><strong>ç¬¬ä¸€æ­¥ï¼šç¼–å†™reducer</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* number Reducer */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">numberReducer</span>(<span class="hljs-params">state=<span class="hljs-number">1</span>,action</span>)</span>{
  <span class="hljs-keyword">switch</span> (action.type){
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ADD'</span>:
      <span class="hljs-keyword">return</span> state + <span class="hljs-number">1</span>
    <span class="hljs-keyword">case</span> <span class="hljs-string">'DEL'</span>:
      <span class="hljs-keyword">return</span> state - <span class="hljs-number">1</span>
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> state
  } 
}
<span class="hljs-comment">/* ç”¨æˆ·ä¿¡æ¯reducer */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">InfoReducer</span>(<span class="hljs-params">state={},action</span>)</span>{
  <span class="hljs-keyword">const</span> { payload = {} } = action
   <span class="hljs-keyword">switch</span> (action.type){
     <span class="hljs-keyword">case</span> <span class="hljs-string">'SET'</span>:
       <span class="hljs-keyword">return</span> {
         ...state,
         ...payload
       }
     <span class="hljs-attr">default</span>:
       <span class="hljs-keyword">return</span> state
   }
}
</code></pre>
<ul>
<li>ç¼–å†™äº†ä¸¤ä¸ª reducer ï¼Œä¸€ä¸ªç®¡ç†å˜é‡ number ï¼Œä¸€ä¸ªä¿å­˜ä¿¡æ¯ info ã€‚</li>
</ul>
<p><strong>ç¬¬äºŒæ­¥ï¼šæ³¨å†Œä¸­é—´ä»¶</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* æ‰“å°ä¸­é—´ä»¶ */</span>
<span class="hljs-comment">/* ç¬¬ä¸€å±‚åœ¨ compose ä¸­è¢«æ‰§è¡Œ */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">logMiddleware</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-comment">/* ç¬¬äºŒå±‚åœ¨reduceä¸­è¢«æ‰§è¡Œ */</span> 
    <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">next</span>) =></span> {
      <span class="hljs-comment">/* è¿”å›å¢å¼ºåçš„dispatch */</span>
      <span class="hljs-keyword">return</span> <span class="hljs-function">(<span class="hljs-params">action</span>)=></span>{
        <span class="hljs-keyword">const</span> { type } = action
        <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'å‘ç”Ÿä¸€æ¬¡action:'</span>, type )
        <span class="hljs-keyword">return</span> next(action)
      }
    }
}
</code></pre>
<ul>
<li>åœ¨é‡ç‚¹çœ‹ä¸€ä¸‹ redux çš„ä¸­é—´ä»¶çš„ç¼–å†™æ–¹å¼ï¼Œæœ¬è´¨ä¸Šåº”ç”¨äº†å‡½æ•°æŸ¯é‡ŒåŒ–ã€‚</li>
</ul>
<p><strong>ç¬¬ä¸‰æ­¥ï¼šç”ŸæˆStore</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* æ³¨å†Œä¸­é—´ä»¶  */</span>
<span class="hljs-keyword">const</span> rootMiddleware = applyMiddleware(logMiddleware)
<span class="hljs-comment">/* æ³¨å†Œreducer */</span>
<span class="hljs-keyword">const</span> rootReducer = combineReducers({ <span class="hljs-attr">number</span>:numberReducer,<span class="hljs-attr">info</span>:InfoReducer  })
<span class="hljs-comment">/* åˆæˆStore */</span>
<span class="hljs-keyword">const</span> Store = createStore(rootReducer,{ <span class="hljs-attr">number</span>:<span class="hljs-number">1</span> , <span class="hljs-attr">info</span>:{ <span class="hljs-attr">name</span>:<span class="hljs-literal">null</span> } } ,rootMiddleware) 
</code></pre>
<ul>
<li>è¿™ä¸€æ­¥æ²¡ä»€ä¹ˆå¥½è¯´çš„ï¼Œç›´æ¥æ³¨å†Œå°±å¯ä»¥äº†ã€‚</li>
</ul>
<p><strong>ç¬¬å››æ­¥ï¼šè¯•ç”¨redux</strong></p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Index</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">const</span> [ state , changeState  ] = useState(Store.getState())
  useEffect(<span class="hljs-function">()=></span>{
    <span class="hljs-comment">/* è®¢é˜…state */</span>
    <span class="hljs-keyword">const</span> unSubscribe = Store.subscribe(<span class="hljs-function">()=></span>{
         changeState(Store.getState())
     })
    <span class="hljs-comment">/* è§£é™¤è®¢é˜… */</span>
     <span class="hljs-keyword">return</span> <span class="hljs-function">() =></span> unSubscribe()
  },[])
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> ></span> 
          <span class="hljs-tag">&#x3C;<span class="hljs-name">p</span>></span>  { state.info.name ? `hello, my name is ${ state.info.name}` : 'what is your name' } ,
           { state.info.mes ? state.info.mes  : ' what do you say? '  } <span class="hljs-tag">&#x3C;/<span class="hljs-name">p</span>></span>
         ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹ { state.number } ğŸ‘ <span class="hljs-tag">&#x3C;<span class="hljs-name">br</span>/></span>
        <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=></span>{ Store.dispatch({ type:'ADD' })  }} >ç‚¹èµ<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
        <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span>=></span>{ Store.dispatch({ type:'SET',payload:{ name:'alien' , mes:'let us learn React!'  } }) }} >ä¿®æ”¹æ ‡é¢˜<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
     <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
}
</code></pre>
<ul>
<li>ä¸ºäº†è®©å¤§å®¶ç›´è§‚çœ‹åˆ°æ•ˆæœï¼Œå¯ä»¥ç›´æ¥æŠŠ redux å’Œ react ç›´æ¥ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œåœ¨ useEffect ä¸­è¿›è¡Œè®¢é˜…å’Œè§£é™¤è®¢é˜…ï¼Œé€šè¿‡ useState æ”¹å˜è§†å›¾å±‚ã€‚</li>
<li>store.getState å¯ä»¥è·å– redux æœ€æ–°çš„ state ã€‚</li>
</ul>
<p><strong>æ•ˆæœ</strong></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/edbce9a094cd49fb9732753cc708d731~tplv-k3u1fbpfcp-watermark.image" alt="1.gif"></p>
<p><strong>æ€»ç»“ï¼š</strong></p>
<p>ä¸Šè¿°demoä¸­ï¼Œæ²¡æœ‰ç”¨åˆ° react-redux ï¼Œä½†æ˜¯æ˜æ˜¾æš´éœ²äº†å¾ˆå¤šé—®é¢˜ã€‚æˆ‘æ¥åšä¸€ä¸‹æ€»ç»“ï¼š</p>
<ul>
<li>1 é¦–å…ˆæƒ³è¦çš„çŠ¶æ€æ˜¯å…±ç”¨çš„ï¼Œä¸Šè¿° demo æ— æ³•æ»¡è¶³çŠ¶æ€å…±ç”¨çš„æƒ…å†µã€‚</li>
<li>2 æ­£å¸¸æƒ…å†µä¸å¯èƒ½å°†æ¯ä¸€ä¸ªéœ€è¦çŠ¶æ€çš„ç»„ä»¶éƒ½ç”¨ subscribe / unSubscribe æ¥è¿›è¡Œè®¢é˜…</li>
<li>3 æ¯”å¦‚ A ç»„ä»¶éœ€è¦çŠ¶æ€ aï¼ŒB ç»„ä»¶éœ€è¦çŠ¶æ€ b ï¼Œé‚£ä¹ˆæ”¹å˜ aï¼Œåªå¸Œæœ› A ç»„ä»¶æ›´æ–°ï¼Œä¸å¸Œæœ› B ç»„ä»¶æ›´æ–°ï¼Œæ˜¾ç„¶ä¸Šè¿°æ˜¯ä¸èƒ½æ»¡è¶³çš„ã€‚</li>
<li>4 ...</li>
</ul>
<p>æ‰€ä»¥ä¸ºäº†è§£å†³ä¸Šè¿°è¯¸å¤šé—®é¢˜ï¼Œreact-redux å°±åº”è¿è€Œç”Ÿäº†ã€‚</p>
<h2>äºŒ React-Reduxç”¨æ³•</h2>
<p>ä¸Šè¿°è®²åˆ° React-Redux æ˜¯æ²Ÿé€š React å’Œ Redux çš„æ¡¥æ¢ï¼Œå®ƒä¸»è¦åŠŸèƒ½ä½“ç°åœ¨å¦‚ä¸‹ä¸¤ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>1 æ¥å— Redux çš„ Storeï¼Œå¹¶æŠŠå®ƒåˆç†åˆ†é…åˆ°æ‰€éœ€è¦çš„ç»„ä»¶ä¸­ã€‚</li>
<li>2 è®¢é˜… Store ä¸­ state çš„æ”¹å˜ï¼Œä¿ƒä½¿æ¶ˆè´¹å¯¹åº”çš„ state çš„ç»„ä»¶æ›´æ–°ã€‚</li>
</ul>
<h3>1 ç”¨æ³•ç®€ä»‹</h3>
<h4>Provider</h4>
<p>ç”±äº redux æ•°æ®å±‚ï¼Œå¯èƒ½è¢«å¾ˆå¤šç»„ä»¶æ¶ˆè´¹ï¼Œæ‰€ä»¥ react-redux ä¸­æä¾›äº†ä¸€ä¸ª Provider ç»„ä»¶ï¼Œå¯ä»¥å…¨å±€æ³¨å…¥ redux ä¸­çš„ store ï¼Œæ‰€ä»¥ä½¿ç”¨è€…éœ€è¦æŠŠ Provider æ³¨å†Œåˆ°æ ¹éƒ¨ç»„ä»¶ä¸­ã€‚</p>
<ul>
<li>Provider ä½œç”¨å°±æ˜¯ä¿å­˜ redux ä¸­çš„ store ï¼Œåˆ†é…ç»™æ‰€æœ‰éœ€è¦ state çš„å­å­™ç»„ä»¶ã€‚</li>
</ul>
<p>ä¾‹å­ğŸŒ°ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Root</span>(<span class="hljs-params"></span>)</span>{
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{Store}</span> ></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">Index</span> /></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">Provider</span>></span></span>
}
</code></pre>
<h4>connect</h4>
<p>æ—¢ç„¶å·²ç»å…¨å±€æ³¨å…¥äº† Store ï¼Œé‚£ä¹ˆéœ€è¦ Store ä¸­çš„çŠ¶æ€æˆ–è€…æƒ³è¦æ”¹å˜Storeçš„çŠ¶æ€ï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†å‘¢ï¼ŒReact-Redux æä¾›äº†ä¸€ä¸ªé«˜é˜¶ç»„ä»¶connectï¼Œè¢« connect åŒ…è£…åç»„ä»¶å°†è·å¾—å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li>1 èƒ½å¤Ÿä» props ä¸­è·å–æ”¹å˜ state çš„æ–¹æ³• Store.dispatch ã€‚</li>
<li>2 å¦‚æœ connect æœ‰ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆä¼šå°† redux state ä¸­çš„æ•°æ®ï¼Œæ˜ å°„åˆ°å½“å‰ç»„ä»¶çš„ props ä¸­ï¼Œå­ç»„ä»¶å¯ä»¥ä½¿ç”¨æ¶ˆè´¹ã€‚</li>
<li>3 å½“éœ€è¦çš„ state ï¼Œæœ‰å˜åŒ–çš„æ—¶å€™ï¼Œä¼šé€šçŸ¥å½“å‰ç»„ä»¶æ›´æ–°ï¼Œé‡æ–°æ¸²æŸ“è§†å›¾ã€‚</li>
</ul>
<p>å¼€å‘è€…å¯ä»¥åˆ©ç”¨ connect æä¾›çš„åŠŸèƒ½ï¼Œåšæ•°æ®è·å–ï¼Œæ•°æ®é€šä¿¡ï¼ŒçŠ¶æ€æ´¾å‘ç­‰æ“ä½œã€‚é¦–å…ˆæ¥çœ‹çœ‹ connect ç”¨æ³•ã€‚</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params">mapStateToProps?, mapDispatchToProps?, mergeProps?, options?</span>)
</span></code></pre>
<p><strong>â‘ mapStateToProps</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mapStateToProps = <span class="hljs-function"><span class="hljs-params">state</span> =></span> ({ <span class="hljs-attr">number</span>: state.number })
</code></pre>
<ul>
<li>ç»„ä»¶ä¾èµ– redux çš„ stateï¼Œæ˜ å°„åˆ°ä¸šåŠ¡ç»„ä»¶çš„ props ä¸­ï¼Œstate æ”¹å˜è§¦å‘ï¼Œä¸šåŠ¡ç»„ä»¶ props æ”¹å˜ï¼Œè§¦å‘ä¸šåŠ¡ç»„ä»¶æ›´æ–°è§†å›¾ã€‚å½“è¿™ä¸ªå‚æ•°æ²¡æœ‰çš„æ—¶å€™ï¼Œå½“å‰ç»„ä»¶ä¸ä¼šè®¢é˜… store çš„æ”¹å˜ã€‚</li>
</ul>
<p><strong>â‘¡mapDispatchToProps</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> mapDispatchToProps = <span class="hljs-function"><span class="hljs-params">dispatch</span> =></span> {
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">numberAdd</span>: <span class="hljs-function">() =></span> dispatch({ <span class="hljs-attr">type</span>: <span class="hljs-string">'ADD'</span> }),
    <span class="hljs-attr">setInfo</span>: <span class="hljs-function">() =></span> dispatch({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SET'</span> }),
  }
}
</code></pre>
<ul>
<li>å°† redux ä¸­çš„ dispatch æ–¹æ³•ï¼Œæ˜ å°„åˆ°ä¸šåŠ¡ç»„ä»¶çš„ props ä¸­ã€‚æ¯”å¦‚å°†å¦‚ä¸Š demo ä¸­çš„ä¸¤ä¸ªæ–¹æ³•æ˜ å°„åˆ° props ï¼Œå˜æˆäº† numberAdd ï¼Œ setInfo æ–¹æ³•ã€‚</li>
</ul>
<p><strong>â‘¢mergeProps</strong></p>
<pre><code class="hljs language-js"><span class="hljs-comment">/*
* stateProps , state æ˜ å°„åˆ° props ä¸­çš„å†…å®¹
* dispatchPropsï¼Œ dispatch æ˜ å°„åˆ° props ä¸­çš„å†…å®¹ã€‚
* ownProps ç»„ä»¶æœ¬èº«çš„ props
*/</span>
(stateProps, dispatchProps, ownProps) => <span class="hljs-built_in">Object</span>
</code></pre>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰è¿™ä¸ªå‚æ•°ï¼Œä¼šæŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œåˆå¹¶ï¼Œè¿”å›çš„å¯¹è±¡å¯ä»¥æ˜¯ï¼Œå¯ä»¥è‡ªå®šä¹‰çš„åˆå¹¶è§„åˆ™ï¼Œè¿˜å¯ä»¥é™„åŠ ä¸€äº›å±æ€§ã€‚</p>
<pre><code class="hljs language-js">{ ...ownProps, ...stateProps, ...dispatchProps }
</code></pre>
<p><strong>â‘£options</strong></p>
<pre><code class="hljs language-js">{
  context?: <span class="hljs-built_in">Object</span>,   <span class="hljs-comment">// è‡ªå®šä¹‰ä¸Šä¸‹æ–‡</span>
  pure?: boolean, <span class="hljs-comment">// é»˜è®¤ä¸º true , å½“ä¸º true çš„æ—¶å€™ ï¼Œé™¤äº† mapStateToProps å’Œ props ,å…¶ä»–è¾“å…¥æˆ–è€…state æ”¹å˜ï¼Œå‡ä¸ä¼šæ›´æ–°ç»„ä»¶ã€‚</span>
  areStatesEqual?: <span class="hljs-built_in">Function</span>, <span class="hljs-comment">// å½“pure true , æ¯”è¾ƒå¼•è¿›store ä¸­stateå€¼ æ˜¯å¦å’Œä¹‹å‰ç›¸ç­‰ã€‚ (next: Object, prev: Object) => boolean</span>
  areOwnPropsEqual?: <span class="hljs-built_in">Function</span>, <span class="hljs-comment">// å½“pure true , æ¯”è¾ƒ props å€¼, æ˜¯å¦å’Œä¹‹å‰ç›¸ç­‰ã€‚ (next: Object, prev: Object) => boolean</span>
  areStatePropsEqual?: <span class="hljs-built_in">Function</span>, <span class="hljs-comment">// å½“pure true , æ¯”è¾ƒ mapStateToProps åçš„å€¼ æ˜¯å¦å’Œä¹‹å‰ç›¸ç­‰ã€‚  (next: Object, prev: Object) => boolean</span>
  areMergedPropsEqual?: <span class="hljs-built_in">Function</span>, <span class="hljs-comment">// å½“ pure ä¸º true æ—¶ï¼Œ æ¯”è¾ƒ ç»è¿‡ mergeProps åˆå¹¶åçš„å€¼ ï¼Œ æ˜¯å¦ä¸ä¹‹å‰ç­‰  (next: Object, prev: Object) => boolean</span>
  forwardRef?: boolean, <span class="hljs-comment">//å½“ä¸ºtrue æ—¶å€™,å¯ä»¥é€šè¿‡ref è·å–è¢«connectåŒ…è£¹çš„ç»„ä»¶å®ä¾‹ã€‚</span>
}
</code></pre>
<p>å¦‚ä¸Šæ ‡æ³¨äº† options å±æ€§æ¯ä¸€ä¸ªçš„å«ä¹‰ã€‚å¹¶ä¸”è®²è§£äº† react-redux çš„åŸºæœ¬ç”¨æ³•ï¼Œæ¥ä¸‹æ¥ç®€å•å®ç° react-redux çš„ä¸¤ä¸ªåŠŸèƒ½ã€‚</p>
<h3>2 å®è·µä¸€ï¼šReact-Reduxå®ç°çŠ¶æ€å…±äº«</h3>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Root</span>(<span class="hljs-params"></span>)</span>{
  React.useEffect(<span class="hljs-function">()=></span>{
    Store.dispatch({ <span class="hljs-attr">type</span>:<span class="hljs-string">'ADD'</span>})
    Store.dispatch({ <span class="hljs-attr">type</span>:<span class="hljs-string">'SET'</span>,<span class="hljs-attr">payload</span>:{ <span class="hljs-attr">name</span>:<span class="hljs-string">'alien'</span> , <span class="hljs-attr">mes</span>:<span class="hljs-string">'let us learn React!'</span>  } })
  },[])
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Provider</span> <span class="hljs-attr">store</span>=<span class="hljs-string">{Store}</span> ></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">Index</span> /></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">Provider</span>></span></span>
}
</code></pre>
<ul>
<li>é€šè¿‡åœ¨æ ¹ç»„ä»¶ä¸­æ³¨å…¥ store ï¼Œå¹¶åœ¨ useEffect ä¸­æ”¹å˜ state å†…å®¹ã€‚</li>
</ul>
<p>ç„¶ååœ¨æ•´ä¸ªåº”ç”¨ä¸­åœ¨æƒ³è¦è·å–æ•°æ®çš„ç»„ä»¶é‡Œï¼Œè·å– state ä¸­çš„å†…å®¹ã€‚</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> { connect } <span class="hljs-keyword">from</span> <span class="hljs-string">'react-redux'</span>


<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
    <span class="hljs-function"><span class="hljs-title">componentDidMount</span>(<span class="hljs-params"></span>)</span> { }
    <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
         <span class="hljs-keyword">const</span> { info , number }:any = <span class="hljs-built_in">this</span>.props  
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> ></span>
            <span class="hljs-tag">&#x3C;<span class="hljs-name">p</span>></span>  {info.name ? `hello, my name is ${info.name}` : 'what is your name'} ,
          {info.mes ? info.mes : ' what do you say? '} <span class="hljs-tag">&#x3C;/<span class="hljs-name">p</span>></span>
        ã€ŠReactè¿›é˜¶å®è·µæŒ‡å—ã€‹ {number} ğŸ‘ <span class="hljs-tag">&#x3C;<span class="hljs-name">br</span> /></span>
        <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
    }
}

<span class="hljs-keyword">const</span> mapStateToProps = <span class="hljs-function"><span class="hljs-params">state</span> =></span> ({ <span class="hljs-attr">number</span>: state.number, <span class="hljs-attr">info</span>: state.info })

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> connect(mapStateToProps)(Index)
</code></pre>
<ul>
<li>é€šè¿‡ mapStateToProps è·å–æŒ‡å®š state ä¸­çš„å†…å®¹ï¼Œç„¶åæ¸²æŸ“è§†å›¾ã€‚</li>
</ul>
<p>æ•ˆæœï¼š</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2765c6dee4e3486a9982dcfcb2b03470~tplv-k3u1fbpfcp-watermark.image" alt="5.jpg"></p>
<h3>3 å®è·µäºŒï¼šReact-Reduxå®ç°ç»„ä»¶é€šä¿¡</h3>
<p>æ¥ä¸‹æ¥å¯ä»¥ç”¨ React-Redux æ¨¡æ‹Ÿä¸€ä¸ªï¼Œç»„ä»¶é€šä¿¡çš„åœºæ™¯ã€‚</p>
<p><strong>ç»„ä»¶A</strong></p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ComponentA</span>(<span class="hljs-params">{ toCompB, compBsay }</span>) </span>{ <span class="hljs-comment">/* ç»„ä»¶A */</span>
  <span class="hljs-keyword">const</span> [CompAsay, setCompAsay] = useState(<span class="hljs-string">''</span>)
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"box"</span> ></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">p</span>></span>æˆ‘æ˜¯ç»„ä»¶A<span class="hljs-tag">&#x3C;/<span class="hljs-name">p</span>></span>
    <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span> Bç»„ä»¶å¯¹æˆ‘è¯´ï¼š{compBsay} <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
        æˆ‘å¯¹Bç»„ä»¶è¯´ï¼š<span class="hljs-tag">&#x3C;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"CompAsay"</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span> =></span> setCompAsay(e.target.value)} />
    <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =></span> toCompB(CompAsay)} >ç¡®å®š<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
  <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
}
<span class="hljs-comment">/* æ˜ å°„stateä¸­CompBsay  */</span>
<span class="hljs-keyword">const</span> CompAMapStateToProps = <span class="hljs-function"><span class="hljs-params">state</span> =></span> ({ <span class="hljs-attr">compBsay</span>: state.info.compBsay })
<span class="hljs-comment">/* æ˜ å°„toCompBæ–¹æ³•åˆ°propsä¸­ */</span>
<span class="hljs-keyword">const</span> CompAmapDispatchToProps = <span class="hljs-function"><span class="hljs-params">dispatch</span> =></span> ({ <span class="hljs-attr">toCompB</span>: <span class="hljs-function">(<span class="hljs-params">mes</span>) =></span> dispatch({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SET'</span>, <span class="hljs-attr">payload</span>: { <span class="hljs-attr">compAsay</span>: mes } }) })
<span class="hljs-comment">/* connectåŒ…è£…ç»„ä»¶A */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> CompA = connect(CompAMapStateToProps, CompAmapDispatchToProps)(ComponentA)
</code></pre>
<ul>
<li>ç»„ä»¶ A é€šè¿‡ mapStateToPropsï¼ŒmapDispatchToPropsï¼Œåˆ†åˆ«å°†state ä¸­çš„ compBsay å±æ€§ï¼Œå’Œæ”¹å˜ state çš„ compAsay æ–¹æ³•ï¼Œæ˜ å°„åˆ° props ä¸­ã€‚</li>
</ul>
<p><strong>ç»„ä»¶B</strong></p>
<pre><code class="hljs language-js"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ComponentB</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{ <span class="hljs-comment">/* Bç»„ä»¶ */</span>
  state={ <span class="hljs-attr">compBsay</span>:<span class="hljs-string">''</span> }
  handleToA=<span class="hljs-function">()=></span>{
     <span class="hljs-built_in">this</span>.props.dispatch({ <span class="hljs-attr">type</span>: <span class="hljs-string">'SET'</span>, <span class="hljs-attr">payload</span>: { <span class="hljs-attr">compBsay</span>: <span class="hljs-built_in">this</span>.state.compBsay } })
  }
  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span> <span class="hljs-attr">className</span>=<span class="hljs-string">"box"</span> ></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">p</span>></span>æˆ‘æ˜¯ç»„ä»¶B<span class="hljs-tag">&#x3C;/<span class="hljs-name">p</span>></span>
      <span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span> Aç»„ä»¶å¯¹æˆ‘è¯´ï¼š{ this.props.compAsay } <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span>
       æˆ‘å¯¹Aç»„ä»¶è¯´ï¼š<span class="hljs-tag">&#x3C;<span class="hljs-name">input</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"CompBsay"</span> <span class="hljs-attr">onChange</span>=<span class="hljs-string">{(e)</span>=></span> this.setState({ compBsay: e.target.value  }) }  />
      <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span>  <span class="hljs-attr">onClick</span>=<span class="hljs-string">{</span> <span class="hljs-attr">this.handleToA</span> } ></span>ç¡®å®š<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
  }
}
<span class="hljs-comment">/* æ˜ å°„stateä¸­ CompAsay  */</span>
<span class="hljs-keyword">const</span> CompBMapStateToProps = <span class="hljs-function"><span class="hljs-params">state</span> =></span> ({ <span class="hljs-attr">compAsay</span>: state.info.compAsay })
<span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> CompB =  connect(CompBMapStateToProps)(ComponentB)
</code></pre>
<ul>
<li>B ç»„ä»¶å’Œ A ç»„ä»¶å·®ä¸å¤šï¼Œé€šè¿‡è§¦å‘ dispatch å‘ç»„ä»¶ A ä¼ é€’ä¿¡æ¯ï¼ŒåŒæ—¶æ¥å— B ç»„ä»¶çš„ä¿¡æ¯ã€‚</li>
</ul>
<p><strong>æ•ˆæœï¼š</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d32665608ce42eab09a60ccc11bb2ef~tplv-k3u1fbpfcp-watermark.image" alt="2.gif"></p>
<h2>ä¸‰ React-ReduxåŸç†</h2>
<p>å¯¹äº React-Redux åŸç†ï¼Œæˆ‘æŒ‰ç…§åŠŸèƒ½ç»„æˆï¼Œå¤§è‡´åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œæ¥ä¸‹æ¥å°†æŒ‰ç…§è¿™ä¸‰éƒ¨åˆ†é€ä¸€å‡»ç ´ï¼š</p>
<h3>ç¬¬ä¸€éƒ¨åˆ†ï¼š Provideræ³¨å…¥Store</h3>
<blockquote>
<p>react-redux/src/components/Provider.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> ReactReduxContext =  React.createContext(<span class="hljs-literal">null</span>)
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Provider</span>(<span class="hljs-params">{ store, context, children }</span>) </span>{
   <span class="hljs-comment">/* åˆ©ç”¨useMemoï¼Œè·Ÿæ®storeå˜åŒ–åˆ›å»ºå‡ºä¸€ä¸ªcontextValue åŒ…å«ä¸€ä¸ªæ ¹å…ƒç´ è®¢é˜…å™¨å’Œå½“å‰store  */</span> 
  <span class="hljs-keyword">const</span> contextValue = useMemo(<span class="hljs-function">() =></span> {
      <span class="hljs-comment">/* åˆ›å»ºäº†ä¸€ä¸ªæ ¹çº§ Subscription è®¢é˜…å™¨ */</span>
    <span class="hljs-keyword">const</span> subscription = <span class="hljs-keyword">new</span> Subscription(store)
    <span class="hljs-keyword">return</span> {
      store,
      subscription
    } <span class="hljs-comment">/* store æ”¹å˜åˆ›å»ºæ–°çš„contextValue */</span>
  }, [store])
  useEffect(<span class="hljs-function">() =></span> {
    <span class="hljs-keyword">const</span> { subscription } = contextValue
    <span class="hljs-comment">/* è§¦å‘trySubscribeæ–¹æ³•æ‰§è¡Œï¼Œåˆ›å»ºlistens */</span>
    subscription.trySubscribe() <span class="hljs-comment">// å‘èµ·è®¢é˜…</span>
    <span class="hljs-keyword">return</span> <span class="hljs-function">() =></span> {
      subscription.tryUnsubscribe()  <span class="hljs-comment">// å¸è½½è®¢é˜…</span>
    } 
  }, [contextValue])  <span class="hljs-comment">/*  contextValue state æ”¹å˜å‡ºå‘æ–°çš„ effect */</span>
  <span class="hljs-keyword">const</span> Context = ReactReduxContext
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">Context.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{contextValue}</span>></span>{children}<span class="hljs-tag">&#x3C;/<span class="hljs-name">Context.Provider</span>></span></span>
}
</code></pre>
<p>è¿™é‡Œä¿ç•™äº†æ ¸å¿ƒçš„ä»£ç ã€‚ä»è¿™æ®µä»£ç ï¼Œä»ä¸­å¯ä»¥åˆ†æå‡º Provider åšäº†å“ªäº›äº‹ã€‚</p>
<ul>
<li>1 é¦–å…ˆçŸ¥é“ React-Redux æ˜¯é€šè¿‡ context ä¸Šä¸‹æ–‡æ¥ä¿å­˜ä¼ é€’ Store çš„ï¼Œä½†æ˜¯ä¸Šä¸‹æ–‡ value ä¿å­˜çš„é™¤äº† Store è¿˜æœ‰ subscription ã€‚</li>
<li>2 subscription å¯ä»¥ç†è§£ä¸ºè®¢é˜…å™¨ï¼Œåœ¨ React-redux ä¸­ä¸€æ–¹é¢ç”¨æ¥è®¢é˜…æ¥è‡ª state å˜åŒ–ï¼Œå¦ä¸€æ–¹é¢é€šçŸ¥å¯¹åº”çš„ç»„ä»¶æ›´æ–°ã€‚åœ¨ Provider ä¸­çš„è®¢é˜…å™¨ subscription ä¸ºæ ¹è®¢é˜…å™¨ï¼Œ</li>
<li>3 åœ¨ Provider çš„ useEffect ä¸­ï¼Œè¿›è¡ŒçœŸæ­£çš„ç»‘å®šè®¢é˜…åŠŸèƒ½ï¼Œå…¶åŸç†å†…éƒ¨è°ƒç”¨äº† store.subscribe ï¼Œåªæœ‰æ ¹è®¢é˜…å™¨æ‰ä¼šè§¦å‘store.subscribeï¼Œè‡³äºä¸ºä»€ä¹ˆï¼Œé©¬ä¸Šå°±ä¼šè®²åˆ°ã€‚</li>
</ul>
<h3>ç¬¬äºŒéƒ¨åˆ†ï¼š Subscriptionè®¢é˜…å™¨</h3>
<blockquote>
<p>react-redux/src/utils/Subscription.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-comment">/* å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ */</span>
<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Subscription</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">store, parentSub</span>)</span> {
  <span class="hljs-comment">//....</span>
  }
  <span class="hljs-comment">/* è´Ÿè´£æ£€æµ‹æ˜¯å¦è¯¥ç»„ä»¶è®¢é˜…ï¼Œç„¶åæ·»åŠ è®¢é˜…è€…ä¹Ÿå°±æ˜¯listener */</span>
  <span class="hljs-function"><span class="hljs-title">addNestedSub</span>(<span class="hljs-params">listener</span>)</span> {
    <span class="hljs-built_in">this</span>.trySubscribe()
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.listeners.subscribe(listener)
  }
  <span class="hljs-comment">/* å‘listenerså‘å¸ƒé€šçŸ¥ */</span>
  <span class="hljs-function"><span class="hljs-title">notifyNestedSubs</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">this</span>.listeners.notify()
  }
  <span class="hljs-comment">/* å¼€å¯è®¢é˜…æ¨¡å¼ é¦–å…ˆåˆ¤æ–­å½“å‰è®¢é˜…å™¨æœ‰æ²¡æœ‰çˆ¶çº§è®¢é˜…å™¨ ï¼Œ å¦‚æœæœ‰çˆ¶çº§è®¢é˜…å™¨(å°±æ˜¯çˆ¶çº§Subscription)ï¼ŒæŠŠè‡ªå·±çš„handleChangeWrapperæ”¾å…¥åˆ°ç›‘å¬è€…é“¾è¡¨ä¸­ */</span>
  <span class="hljs-function"><span class="hljs-title">trySubscribe</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-comment">/*
    parentSub  å³æ˜¯provide value é‡Œé¢çš„ Subscription è¿™é‡Œå¯ä»¥ç†è§£ä¸º çˆ¶çº§å…ƒç´ çš„ Subscription
    */</span>
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.unsubscribe) {
      <span class="hljs-built_in">this</span>.unsubscribe = <span class="hljs-built_in">this</span>.parentSub
        ? <span class="hljs-built_in">this</span>.parentSub.addNestedSub(<span class="hljs-built_in">this</span>.handleChangeWrapper)
        <span class="hljs-comment">/* providerçš„Subscriptionæ˜¯ä¸å­˜åœ¨parentSubï¼Œæ‰€ä»¥æ­¤æ—¶trySubscribe å°±ä¼šè°ƒç”¨ store.subscribe   */</span>
        : <span class="hljs-built_in">this</span>.store.subscribe(<span class="hljs-built_in">this</span>.handleChangeWrapper)
      <span class="hljs-built_in">this</span>.listeners = createListenerCollection()
    }
  }
  <span class="hljs-comment">/* å–æ¶ˆè®¢é˜… */</span>
  <span class="hljs-function"><span class="hljs-title">tryUnsubscribe</span>(<span class="hljs-params"></span>)</span> {
     <span class="hljs-comment">//....</span>
  }
}
</code></pre>
<p>æ•´ä¸ªè®¢é˜…å™¨çš„æ ¸å¿ƒï¼Œæˆ‘æµ“ç¼©æç‚¼æˆ8ä¸ªå­—ï¼š<strong>å±‚å±‚è®¢é˜…ï¼Œä¸Šè®¢ä¸‹å‘</strong>ã€‚</p>
<p><strong>å±‚å±‚è®¢é˜…</strong>ï¼šReact-Redux é‡‡ç”¨äº†å±‚å±‚è®¢é˜…çš„æ€æƒ³ï¼Œä¸Šè¿°å†…å®¹è®²åˆ° Provider é‡Œé¢æœ‰ä¸€ä¸ª Subscription ï¼Œæå‰é€éœ²ä¸€ä¸‹ï¼Œæ¯ä¸€ä¸ªç”¨ connect åŒ…è£…çš„ç»„ä»¶ï¼Œå†…éƒ¨ä¹Ÿæœ‰ä¸€ä¸ª Subscription ï¼Œè€Œä¸”è¿™äº›è®¢é˜…å™¨ä¸€å±‚å±‚å»ºç«‹èµ·å…³è”ï¼ŒProviderä¸­çš„è®¢é˜…å™¨æ˜¯æœ€æ ¹éƒ¨çš„è®¢é˜…å™¨ï¼Œå¯ä»¥é€šè¿‡ trySubscribe å’Œ addNestedSub æ–¹æ³•å¯ä»¥çœ‹åˆ°ã€‚è¿˜æœ‰ä¸€ä¸ªæ³¨æ„çš„ç‚¹å°±æ˜¯ï¼Œå¦‚æœçˆ¶ç»„ä»¶æ˜¯ä¸€ä¸ª connect ï¼Œå­å­™ç»„ä»¶ä¹Ÿæœ‰ connect ï¼Œé‚£ä¹ˆçˆ¶å­ connect çš„ Subscription ä¹Ÿä¼šå»ºç«‹èµ·çˆ¶å­å…³ç³»ã€‚</p>
<p><strong>ä¸Šè®¢ä¸‹å‘</strong>ï¼šåœ¨è°ƒç”¨ trySubscribe çš„æ—¶å€™ï¼Œèƒ½å¤Ÿçœ‹åˆ°è®¢é˜…å™¨ä¼šå’Œä¸Šä¸€çº§çš„è®¢é˜…å™¨é€šè¿‡ addNestedSub å»ºç«‹èµ·å…³è”ï¼Œå½“ store ä¸­ state å‘ç”Ÿæ”¹å˜ï¼Œä¼šè§¦å‘ store.subscribe ï¼Œä½†æ˜¯åªä¼šé€šçŸ¥ç»™ Provider ä¸­çš„æ ¹Subscriptionï¼Œæ ¹ Subscription ä¹Ÿä¸ä¼šç›´æ¥æ´¾å‘æ›´æ–°ï¼Œè€Œæ˜¯ä¼šä¸‹å‘ç»™å­ä»£è®¢é˜…å™¨ï¼ˆ connect ä¸­çš„ Subscription ï¼‰ï¼Œå†ç”±å­ä»£è®¢é˜…å™¨ï¼Œå†³å®šæ˜¯å¦æ›´æ–°ç»„ä»¶ï¼Œå±‚å±‚ä¸‹å‘ã€‚</p>
<p><strong>ï½œ--------é—®ä¸ç­”--------ï½œ</strong><br>
é—®ï¼šä¸ºä»€ä¹ˆ React-Redux ä¼šé‡‡ç”¨ subscription è®¢é˜…å™¨è¿›è¡Œè®¢é˜…ï¼Œè€Œä¸æ˜¯ç›´æ¥é‡‡ç”¨ store.subscribe å‘¢ ï¼Ÿ</p>
<ul>
<li>
<p>1 é¦–å…ˆ state çš„æ”¹å˜ï¼ŒProvider æ˜¯ä¸èƒ½ç›´æ¥ä¸‹å‘æ›´æ–°çš„ï¼Œå¦‚æœä¸‹å‘æ›´æ–°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ›´æ–°æ˜¯æ•´ä¸ªåº”ç”¨å±‚çº§ä¸Šçš„ï¼Œè¿˜æœ‰ä¸€ç‚¹ï¼Œå¦‚æœéœ€è¦ state çš„ç»„ä»¶ï¼Œåšä¸€äº›æ€§èƒ½ä¼˜åŒ–çš„ç­–ç•¥ï¼Œé‚£ä¹ˆè¯¥æ›´æ–°çš„ç»„ä»¶ä¸ä¼šè¢«æ›´æ–°ï¼Œä¸è¯¥æ›´æ–°çš„ç»„ä»¶åè€Œä¼šæ›´æ–°äº†ã€‚</p>
</li>
<li>
<p>2 çˆ¶ Subscription -> å­ Subscription è¿™ç§æ¨¡å¼ï¼Œå¯ä»¥é€å±‚ç®¡ç† connect çš„çŠ¶æ€æ´¾å‘ï¼Œä¸ä¼šå› ä¸º state çš„æ”¹å˜è€Œå¯¼è‡´æ›´æ–°çš„æ··ä¹±ã€‚</p>
</li>
</ul>
<p><strong>ï½œ--------END--------ï½œ</strong><br></p>
<p><strong>å±‚å±‚è®¢é˜…æ¨¡å‹ï¼š</strong></p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/91741c58bbf84ce7ba0dbb2cea510135~tplv-k3u1fbpfcp-watermark.image" alt="6.jpg"></p>
<h3>ç¬¬ä¸‰éƒ¨åˆ†ï¼š connectæ§åˆ¶æ›´æ–°</h3>
<p>ç”±äºconnectä¸­çš„ä»£ç è¿‡äºå¤æ‚ï¼Œæˆ‘è¿™é‡Œåªä¿ç•™æ ¸å¿ƒçš„æµç¨‹ï¼Œè€Œä¸”å¯¹ä»£ç è¿›è¡Œç®€åŒ–å¤„ç†ã€‚</p>
<blockquote>
<p>react-redux/src/components/connectAdvanced.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params">mapStateToProps,mapDispatchToProps</span>)</span>{
    <span class="hljs-keyword">const</span> Context = ReactReduxContext
    <span class="hljs-comment">/* WrappedComponent ä¸ºconnect åŒ…è£¹çš„ç»„ä»¶æœ¬èº«  */</span>   
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapWithConnect</span>(<span class="hljs-params">WrappedComponent</span>)</span>{
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createChildSelector</span>(<span class="hljs-params">store</span>) </span>{
          <span class="hljs-comment">/* é€‰æ‹©å™¨  åˆå¹¶å‡½æ•° mergeprops */</span>
          <span class="hljs-keyword">return</span> selectorFactory(store.dispatch, { mapStateToProps,mapDispatchToProps })
        }
        <span class="hljs-comment">/* è´Ÿè´£æ›´æ–°ç»„ä»¶çš„å®¹å™¨ */</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ConnectFunction</span>(<span class="hljs-params">props</span>)</span>{
          <span class="hljs-comment">/* è·å– contextå†…å®¹ é‡Œé¢å«æœ‰ reduxä¸­store å’Œçˆ¶çº§subscription */</span>
          <span class="hljs-keyword">const</span> contextValue = useContext(ContextToUse)
          <span class="hljs-comment">/* åˆ›å»ºå­é€‰æ‹©å™¨,ç”¨äºæå–stateä¸­çš„çŠ¶æ€å’Œdispatchæ˜ å°„ï¼Œåˆå¹¶åˆ°propsä¸­ */</span>
          <span class="hljs-keyword">const</span> childPropsSelector = createChildSelector(contextValue.store)
          <span class="hljs-keyword">const</span> [subscription, notifyNestedSubs] = useMemo(<span class="hljs-function">() =></span> {
            <span class="hljs-comment">/* åˆ›å»ºä¸€ä¸ªå­ä»£Subscriptionï¼Œå¹¶å’Œçˆ¶çº§subscriptionå»ºç«‹èµ·å…³ç³» */</span>
            <span class="hljs-keyword">const</span> subscription = <span class="hljs-keyword">new</span> Subscription(
              store,
              didStoreComeFromProps ? <span class="hljs-literal">null</span> : contextValue.subscription <span class="hljs-comment">// çˆ¶çº§subscriptionï¼Œé€šè¿‡è¿™ä¸ªå’Œçˆ¶çº§è®¢é˜…å™¨å»ºç«‹èµ·å…³è”ã€‚</span>
            )
             <span class="hljs-keyword">return</span> [subscription, subscription.notifyNestedSubs]
            }, [store, didStoreComeFromProps, contextValue])
            
            <span class="hljs-comment">/* åˆæˆçš„çœŸæ­£çš„props */</span>
            <span class="hljs-keyword">const</span> actualChildProps = childPropsSelector(store.getState(), wrapperProps)
            <span class="hljs-keyword">const</span> lastChildProps = useRef()
            <span class="hljs-comment">/* æ›´æ–°å‡½æ•° */</span>
            <span class="hljs-keyword">const</span> [ forceUpdate, ] = useState(<span class="hljs-number">0</span>)
            useEffect(<span class="hljs-function">()=></span>{
                <span class="hljs-keyword">const</span> checkForUpdates =<span class="hljs-function">()=></span>{
                   newChildProps = childPropsSelector()
                  <span class="hljs-keyword">if</span> (newChildProps === lastChildProps.current) { 
                      <span class="hljs-comment">/* è®¢é˜…çš„stateæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¯¥ç»„ä»¶ä¸éœ€è¦æ›´æ–°ï¼Œé€šçŸ¥å­ä»£è®¢é˜…å™¨ */</span>
                      notifyNestedSubs() 
                  }<span class="hljs-keyword">else</span>{
                     <span class="hljs-comment">/* è¿™ä¸ªæ‰æ˜¯çœŸæ­£çš„è§¦å‘ç»„ä»¶æ›´æ–°çš„å‡½æ•° */</span>
                     forceUpdate(<span class="hljs-function"><span class="hljs-params">state</span>=></span>state+<span class="hljs-number">1</span>)
                     lastChildProps.current = newChildProps <span class="hljs-comment">/* ä¿å­˜ä¸Šä¸€æ¬¡çš„props */</span>
                  }
                }
                subscription.onStateChange = checkForUpdates
                <span class="hljs-comment">//å¼€å¯è®¢é˜…è€… ï¼Œå½“å‰æ˜¯è¢«connect åŒ…è½¬çš„æƒ…å†µ ä¼šæŠŠ å½“å‰çš„ checkForceUpdate æ”¾åœ¨å­˜å…¥ çˆ¶å…ƒç´ çš„addNestedSubä¸­ ï¼Œä¸€ç‚¹ç‚¹å‘ä¸Šçº§ä¼ é€’ æœ€åä¼ åˆ° provide </span>
                subscription.trySubscribe()
                <span class="hljs-comment">/* å…ˆæ£€æŸ¥ä¸€éï¼Œåæ­£åˆå§‹åŒ–stateå°±å˜äº† */</span>
                checkForUpdates()
            },[store, subscription, childPropsSelector])

             <span class="hljs-comment">/* åˆ©ç”¨ Provider ç‰¹æ€§é€å±‚ä¼ é€’æ–°çš„ subscription */</span>
            <span class="hljs-keyword">return</span>  <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">ContextToUse.Provider</span> <span class="hljs-attr">value</span>=<span class="hljs-string">{{</span>  <span class="hljs-attr">...contextValue</span>, <span class="hljs-attr">subscription</span>}}></span>
                 <span class="hljs-tag">&#x3C;<span class="hljs-name">WrappedComponent</span>  {<span class="hljs-attr">...actualChildProps</span>}  /></span>
            <span class="hljs-tag">&#x3C;/<span class="hljs-name">ContextToUse.Provider</span>></span></span>  
          }
          <span class="hljs-comment">/* memo ä¼˜åŒ–å¤„ç† */</span>
          <span class="hljs-keyword">const</span> Connect = React.memo(ConnectFunction) 
        <span class="hljs-keyword">return</span> hoistStatics(Connect, WrappedComponent)  <span class="hljs-comment">/* ç»§æ‰¿é™æ€å±æ€§ */</span>
    }
}
</code></pre>
<p>connect çš„é€»è¾‘è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæˆ‘æ€»ç»“ä¸€ä¸‹æ ¸å¿ƒæµç¨‹ã€‚</p>
<ul>
<li>1  connect ä¸­æœ‰ä¸€ä¸ª selector çš„æ¦‚å¿µï¼Œselector æœ‰ä»€ä¹ˆç”¨ï¼Ÿå°±æ˜¯é€šè¿‡ mapStateToProps ï¼ŒmapDispatchToProps ï¼ŒæŠŠ redux ä¸­ state çŠ¶æ€åˆå¹¶åˆ° props ä¸­ï¼Œå¾—åˆ°æœ€æ–°çš„ props ã€‚</li>
<li>2 ä¸Šè¿°è®²åˆ°è¿‡ï¼Œæ¯ä¸€ä¸ª connect éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„ Subscription ï¼Œå’Œçˆ¶çº§è®¢é˜…å™¨å»ºç«‹èµ·å…³è”ï¼Œè¿™æ ·çˆ¶çº§ä¼šè§¦å‘å­ä»£çš„ Subscription æ¥å®ç°é€å±‚çš„çŠ¶æ€æ´¾å‘ã€‚</li>
<li>3 æœ‰ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå°±æ˜¯ Subscription é€šçŸ¥çš„æ˜¯ checkForUpdates å‡½æ•°ï¼ŒcheckForUpdates ä¼šå½¢æˆæ–°çš„ props ï¼Œä¸ä¹‹å‰ç¼“å­˜çš„ props è¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœä¸æƒ³ç­‰ï¼Œé‚£ä¹ˆè¯´æ˜ state å·²ç»å˜åŒ–äº†ï¼Œç›´æ¥è§¦å‘ä¸€ä¸ªuseReducer æ¥æ›´æ–°ç»„ä»¶ï¼Œä¸Šè¿°ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ç”¨ useState ä»£æ›¿ useReducer äº†ï¼Œå¦‚æœç›¸ç­‰ï¼Œé‚£ä¹ˆå½“å‰ç»„ä»¶ä¸éœ€è¦æ›´æ–°ï¼Œç›´æ¥é€šçŸ¥å­ä»£ Subscription ï¼Œæ£€æŸ¥å­ä»£ Subscription æ˜¯å¦æ›´æ–°ï¼Œå®Œæˆæ•´ä¸ªæµç¨‹ã€‚</li>
</ul>
<h2>å›› å®ç°å¼‚æ­¥</h2>
<p>åŸºäº redux å¼‚æ­¥çš„åº“æœ‰å¾ˆå¤šï¼Œæœ€ç®€å•çš„ <code>redux-thunk</code> ï¼Œä»£ç é‡å°‘ï¼Œåªæœ‰å‡ è¡Œï¼Œå…¶ä¸­å¤§é‡çš„é€»è¾‘éœ€è¦å¼€å‘è€…å®ç°ï¼Œè¿˜æœ‰æ¯”è¾ƒå¤æ‚çš„ <code>redux-saga</code> ï¼ŒåŸºäº <code>generator</code> å®ç°ï¼Œç”¨èµ·æ¥ç¨å¾®ç¹çã€‚</p>
<p>å¯¹äºå®Œæ•´çš„çŠ¶æ€ç®¡ç†ç”Ÿæ€ï¼Œå¤§å®¶å¯ä»¥å°è¯•ä¸€ä¸‹ <code>dvajs</code> ï¼Œå®ƒæ˜¯åŸºäº redux-saga åŸºç¡€ä¸Šï¼Œå®ç°çš„å¼‚æ­¥çš„çŠ¶æ€ç®¡ç†å·¥å…·ã€‚dvajs å¤„ç† reducers ä¹Ÿæ¯”è¾ƒç²¾å¦™ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç ”ç©¶ä¸€ä¸‹ã€‚</p>
<h2>äº” æ€»ç»“</h2>
<p>é€šè¿‡æœ¬ç« èŠ‚çš„å­¦ä¹ ï¼Œåº”è¯¥å·²ç»æŒæ¡ä¸€ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>1 Redux çš„åŸºæœ¬æ¦‚å¿µå’Œå¸¸ç”¨ API ã€‚</li>
<li>2 react-redux åŸºæœ¬ç”¨æ³•ï¼Œä»¥åŠä¸¤ç§å¸¸ç”¨åœºæ™¯çš„å®è·µ demo ã€‚</li>
<li>3 react-redux åŸç†å®ç°ã€‚</li>
</ul>
<p>ä¸‹ä¸€èŠ‚å°†å­¦ä¹  React çŠ¶æ€ç®¡ç†çš„å¦å¤–ä¸€ç§æ–¹å¼ Mobx ã€‚</p></div>
</body></html>