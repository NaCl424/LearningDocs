<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬ 01 è®²ï¼šè®¾è®¡ä¸€ä»½å¸å¼•é¢è¯•å®˜çš„ç®€å†</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* é¡µè¾¹è· å’Œ é¡µé¢å¤§å° */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* å¼•ç”¨ */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* è¡¨æ ¼ */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* è¡¨æ ¼ èƒŒæ™¯è‰² */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* ç²—ä½“ */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* æ–œä½“ */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* å›¾ç‰‡ */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* å½“ â€œ![shadow-éšä¾¿å†™]()â€å†™æ—¶ï¼Œä¼šæœ‰é˜´å½± */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* ä»£ç æ¡† */
/* CodeMirror 3024 Day theme */

/* ä»£ç æ®µ èƒŒæ™¯ */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* è¾¹æ¡† */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>åŸç†ç¯‡-ContextåŸç†</h1>
<p>æ¥ä¸‹æ¥å°†ä»‹ç» <code>context</code> åŸç†ã€‚é‡ç‚¹æµç¨‹æ”¾åœ¨ context çš„<strong>ä¼ é€’</strong>å’Œ<strong>æ›´æ–°</strong>ä¸¤ä¸ªæ–¹é¢ã€‚å¯¹äºåŸç†éƒ¨åˆ†ï¼Œæˆ‘åœ¨è¿™é‡Œåªä»‹ç»äº†æ–°ç‰ˆæœ¬ Context çš„åŸç†ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹ä¸€ä¸‹æºç ã€‚</p>
<p>ä»¥ <code>React 16.8</code> ä¸ºä¾‹å­ğŸŒ°ï¼š</p>
<ul>
<li>æ–°ç‰ˆæœ¬ Context ä½ç½®ï¼š<code>react-reconciler/src/ReactFiberNewContext.js</code></li>
<li>è€ç‰ˆæœ¬ Context ä½ç½®ï¼š<code>react-reconciler/src/ReactFiberContext.js</code></li>
</ul>
<p>å¸Œæœ›å¤§å®¶å¸¦ç€è¿™äº›é—®é¢˜å»é˜…è¯»</p>
<ul>
<li>1 Provder å¦‚ä½•ä¼ é€’ contextï¼Ÿ</li>
<li>2 ä¸‰ç§è·å– context åŸç† ï¼ˆ <code>Consumer</code>ï¼Œ <code>useContext</code>ï¼Œ<code>contextType</code> ï¼‰ï¼Ÿ</li>
<li>3 æ¶ˆè´¹ <code>context</code> çš„ç»„ä»¶ï¼Œcontext æ”¹å˜ï¼Œä¸ºä»€ä¹ˆä¼šè®¢é˜…æ›´æ–° ï¼ˆå¦‚ä½•å®ç°ï¼‰ ã€‚</li>
<li>4 context æ›´æ–°ï¼Œå¦‚ä½•é¿å… <code>pureComponent</code> ï¼Œ <code>shouldComponentUpdate</code> æ¸²æŸ“æ§åˆ¶ç­–ç•¥çš„å½±å“ã€‚</li>
<li>5 å¦‚ä½•å®ç°çš„ context åµŒå¥—ä¼ é€’ ï¼ˆ å¤šä¸ª Povider ï¼‰?</li>
</ul>
<h3>1 context å¯¹è±¡</h3>
<p>ä¸Šè¿°æ‰€è¯´çš„è€ç‰ˆæœ¬ context å°±æ˜¯ Legacy Context æ¨¡å¼ä¸‹çš„ context ï¼Œè€ç‰ˆæœ¬çš„ context æ˜¯é‡‡ç”¨çº¦å®šå¼çš„ä½¿ç”¨è§„åˆ™ï¼Œäºæ˜¯æœ‰äº† <code>getChildContext</code> å’Œ <code>childContextTypes</code> åå•†çš„å±æ€§å’Œæ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ä¸ä»…ä¸å¤Ÿçµæ´»ï¼Œè€Œä¸”å¯¹äºå‡½æ•°ç»„ä»¶ä¹Ÿå­˜åœ¨å±€é™æ€§ï¼Œæ‰€ä»¥åœ¨ <code>v16.3</code> æ¨å‡ºäº†æ–°ç‰ˆæœ¬çš„ <code>context</code>ï¼Œå¼€å‘è€…èƒ½å¤Ÿæ›´åŠ çµæ´»çš„è¿ç”¨ Contextã€‚æ–°ç‰ˆæœ¬å¼•å…¥ context å¯¹è±¡çš„æ¦‚å¿µï¼Œè€Œä¸” context å¯¹è±¡ä¸Šé™¤äº†ä¿ç•™äº†ä¼ é€’çš„ä¿¡æ¯ <code>value</code> å¤– ï¼Œ è¿˜æœ‰æä¾›è€… <code>Provder</code> å’Œæ¶ˆè´¹è€… <code>Consumer</code>ã€‚</p>
<h4>context å¯¹è±¡</h4>
<p>è¦æƒ³åƒé€ context ï¼Œé¦–å…ˆè¦ç ”ç©¶ä¸€ä¸‹ Context å¯¹è±¡æ˜¯ä»€ä¹ˆã€‚ä¸Šè¿°è®²åˆ°å¯ä»¥é€šè¿‡ <code>createContext</code> åˆ›å»ºä¸€ä¸ª context ã€‚é‚£ä¹ˆä¸‡ç‰©ä¹‹æºå°±æ˜¯è¿™ä¸ª API ï¼Œæ¥ä¸‹æ¥ä¸€èµ·æ­å¼€ context å¯¹è±¡é¢çº±ã€‚</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createContext</span>(<span class="hljs-params">defaultValue,calculateChangedBits</span>)</span>{
   <span class="hljs-comment">/* context å¯¹è±¡æœ¬è´¨  */</span> 
  <span class="hljs-keyword">const</span> context  = {
        <span class="hljs-attr">$$typeof</span>: REACT_CONTEXT_TYPE, <span class="hljs-comment">/* æœ¬è´¨ä¸Šå°±æ˜¯ Consumer element ç±»å‹ */</span>
        <span class="hljs-attr">_calculateChangedBits</span>: calculateChangedBits,
        <span class="hljs-attr">_currentValue</span>: defaultValue,
        <span class="hljs-attr">_threadCount</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">Provider</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">Consumer</span>: <span class="hljs-literal">null</span>,
  };
  <span class="hljs-comment">/* æœ¬è´¨ä¸Šå°±æ˜¯ Provider element ç±»å‹ã€‚  */</span>
  context.Provider = {
    <span class="hljs-attr">$$typeof</span>: REACT_PROVIDER_TYPE,
    <span class="hljs-attr">_context</span>: context,
  };
  context.Consumer = context 
}
</code></pre>
<p>å¦‚ä¸Šå¯ä»¥å¾ˆå®¹æ˜“çš„çœ‹æ¸…æ¥š context å¯¹è±¡çš„æœ¬è´¨ï¼Œè¿™é‡Œé‡ç‚¹ä»‹ç»ä¸‰ä¸ªå±æ€§</p>
<ul>
<li><strong><code>Provider</code></strong> æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª element å¯¹è±¡ $$typeof -> <code>REACT_PROVIDER_TYPE</code></li>
<li><strong><code>Consumer</code></strong> æœ¬è´¨ä¸Šä¹Ÿæ˜¯ä¸€ä¸ª element å¯¹è±¡ $$typeof -> <code>REACT_CONTEXT_TYPE</code></li>
<li><strong><code>_currentValue</code></strong> è¿™ä¸ªç”¨æ¥ä¿å­˜ä¼ é€’ç»™  Provider çš„ value ã€‚</li>
</ul>
<h4>Provider æä¾›è€…</h4>
<p>ä¸Šè¿°æ˜ç™½äº† Provider æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ React Element å¯¹è±¡ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥é‡ç‚¹çœ‹ä¸€ä¸‹ Provider çš„å®ç°åŸç†ï¼Œç ”ç©¶ Provider é‡ç‚¹å›´ç»•è¿™ä¸¤ä¸ªç‚¹ã€‚</p>
<ul>
<li>Provider å¦‚ä½•ä¼ é€’ context çŠ¶æ€çš„ã€‚</li>
<li>Provider ä¸­ value æ”¹å˜ï¼Œå¦‚ä½•é€šçŸ¥è®¢é˜… contextã€‚</li>
</ul>
<p>ä¹‹å‰çš„ç« èŠ‚è®²è¿°äº† <strong>jsx -> element -> fiber</strong> çš„æµç¨‹ï¼ŒæŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œæ¥ä¸‹æ¥çœ‹ä¸€ä¸‹ Provdier çš„å¤„ç†ã€‚</p>
<ul>
<li>é¦–å…ˆæ ‡ç­¾å½¢å¼çš„ <code>&#x3C;Provider></code> æœ¬è´¨ä¸Šå°±æ˜¯ <code>REACT_PROVIDER_TYPE</code> çš„ React Element ã€‚<code>&#x3C;Provider></code> -> <code>REACT_PROVIDER_TYPE</code> React element ã€‚</li>
<li>æ¥ä¸‹æ¥ element ä¼šè½¬åŒ–æˆ fiber ï¼Œfiber ç±»å‹ä¸º <strong>ContextProvider</strong> ï¼Œ React element ->  <code>ContextProvide fiber</code>ã€‚</li>
</ul>
<p>ContextProvider ç±»å‹çš„ fiber ï¼Œåœ¨ fiber è°ƒå’Œé˜¶æ®µä¼šè¿›å…¥åˆ° <code>beginWork</code> æµç¨‹ï¼Œè¿™ä¸ªé˜¶æ®µä¼šå‘ç”Ÿä¸¤ä»¶äº‹ã€‚</p>
<ul>
<li>å¦‚æœå½“å‰ç±»å‹çš„ fiber ä¸éœ€è¦æ›´æ–°ï¼Œé‚£ä¹ˆä¼š <code>FinishedWork</code> ä¸­æ­¢å½“å‰èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„æ›´æ–°ã€‚</li>
<li>å¦‚æœå½“å‰ç±»å‹ fiber éœ€è¦æ›´æ–°ï¼Œé‚£ä¹ˆä¼šè°ƒç”¨ä¸åŒç±»å‹ fiber çš„å¤„ç†æ–¹æ³•ã€‚å½“ç„¶ <code>ContextProvider</code> ä¹Ÿæœ‰ç‰¹æœ‰çš„ fiber æ›´æ–°æ–¹æ³• â€”â€” <code>updateContextProvider</code>ï¼Œé‚£ä¹ˆå¦‚æœæƒ³è¦æ·±å…¥ <code>Provder</code> çš„å¥¥ç§˜ï¼Œæœ‰å¿…è¦çœ‹ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•åšäº†äº›ä»€ä¹ˆï¼Ÿ</li>
</ul>
<blockquote>
<p>react-reconciler/src/ReactFiberBeginWork.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateContextProvider</span>(<span class="hljs-params">current ,workInProgress,renderExpirationTime,</span>) </span>{
  <span class="hljs-comment">/*  è·å– Provder ä¸Šçš„ value  */</span>
  pushProvider(workInProgress, newProps.value;);
  <span class="hljs-comment">/* æ›´æ–° context  */</span>
  <span class="hljs-keyword">if</span> (oldProps !== <span class="hljs-literal">null</span>) {
    <span class="hljs-keyword">const</span> changedBits = calculateChangedBits(context, newProps.value;, oldProps.value);
    <span class="hljs-keyword">if</span> (changedBits === <span class="hljs-number">0</span>) {
      <span class="hljs-comment">//context æ²¡æœ‰å˜åŒ–ã€‚å¦‚æœå­©å­ä»¬éƒ½æ˜¯ä¸€æ ·çš„è¯ã€‚é‚£ä¹ˆä¸éœ€è¦æ›´æ–°</span>
      <span class="hljs-keyword">if</span> (
        oldProps.children === newProps.children &#x26;&#x26;
        !hasLegacyContextChanged() 
      ) {
         <span class="hljs-keyword">return</span> ...  <span class="hljs-comment">// åœæ­¢è°ƒåˆå­èŠ‚ç‚¹,æ”¶å°¾å·¥ä½œ</span>
      }
    } <span class="hljs-keyword">else</span> { <span class="hljs-comment">/* context æ”¹å˜ï¼Œæ›´æ–° context */</span>
      propagateContextChange( workInProgress,context, changedBits, renderExpirationTime,);
    }
  }
  <span class="hljs-comment">/* ç»§ç»­å‘ä¸‹è°ƒå’Œå­ä»£ fiber  */</span>
  ...
}
</code></pre>
<p>å¦‚ä¸Šä¿ç•™äº† <code>updateContextProvider</code> çš„æ ¸å¿ƒæµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>ç¬¬ä¸€æ­¥ï¼š é¦–å…ˆä¼šè°ƒç”¨ <code>pushProvider</code>ï¼Œ<code>pushProvider</code> ä¼šè·å– type å±æ€§ä¸Šçš„ _context å¯¹è±¡ï¼Œå°±æ˜¯ä¸Šè¿°é€šè¿‡ <code>createContext</code> åˆ›å»ºçš„ context å¯¹è±¡ã€‚ç„¶åå°† Provider çš„ value å±æ€§ï¼Œèµ‹å€¼ç»™ context çš„ _currentValue å±æ€§ä¸Šã€‚<strong>è¿™é‡Œè§£é‡Šäº† Provder é€šè¿‡ä»€ä¹ˆæ‰‹æ®µä¼ é€’ context valueï¼Œå³é€šè¿‡æŒ‚è½½ context çš„ _currentValue å±æ€§ã€‚</strong></p>
</li>
<li>
<p>ç¬¬äºŒæ­¥ï¼š é€šè¿‡ <code>calculateChangedBits</code> è®¡ç®—å‡º changedBits ï¼Œ<code>calculateChangedBits</code> å†…éƒ¨è§¦å‘ context å¯¹è±¡ä¸Šçš„ <code>_calculateChangedBits</code> ï¼Œç»†å¿ƒçš„åŒå­¦å¯ä»¥å‘ç°ï¼Œåœ¨è°ƒç”¨ <code>createContext</code> çš„æ—¶å€™ï¼Œå®é™…ä¸Šæ˜¯æœ‰ç¬¬äºŒä¸ªå‚æ•°çš„ <code>calculateChangedBits</code>ï¼Œåœ¨æ›´æ–° Provider çš„æ—¶å€™è¿™ä¸ªå‚æ•°å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œå½“å®ƒè¿”å›çš„ <code>changedBits === 0</code> çš„æ—¶å€™ï¼Œé‚£ä¹ˆè¿˜ä¼šæµ…æ¯”è¾ƒ children æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œè¿˜æœ‰å°±æ˜¯æœ‰æ²¡æœ‰ <code>legacy context</code>ï¼Œå¦‚æœè¿™ä¸‰ç‚¹éƒ½æ»¡è¶³çš„è¯ï¼Œé‚£ä¹ˆä¼šåˆ¤æ–­å½“å‰ Provider å’Œå­èŠ‚ç‚¹ä¸éœ€è¦æ›´æ–°ï¼Œé‚£ä¹ˆä¼š return åœæ­¢å‘ä¸‹è°ƒå’Œå­èŠ‚ç‚¹ã€‚</p>
</li>
<li>
<p>ç¬¬ä¸‰æ­¥ï¼ˆ<strong>é‡ç‚¹</strong>ï¼‰ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œç»å¤§å¤šæ•°å½“ value å‘ç”Ÿå˜åŒ–ï¼Œä¼šèµ° <code>propagateContextChange</code> è¿™ä¸ªæµç¨‹ï¼Œä¹Ÿæ˜¯ Provider æ›´æ–°çš„ç‰¹ç‚¹ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åˆ°åº•åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿæ¥ä¸‹æ¥é‡ç‚¹çœ‹ä¸€ä¸‹è¿™ä¸ªå‡½æ•°åšäº†äº›ä»€ä¹ˆï¼Ÿ</p>
</li>
</ul>
<p><strong>propagateContextChange</strong> å‡½æ•°æµç¨‹å¾ˆç¹çï¼Œè¿™é‡Œç®€åŒ–äº†æµç¨‹ï¼Œä¿ç•™äº†æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ã€‚</p>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">propagateContextChange</span>(<span class="hljs-params">workInProgress,context</span>)</span>{
    <span class="hljs-keyword">let</span> fiber = workInProgress.child;
    <span class="hljs-keyword">if</span> (fiber !== <span class="hljs-literal">null</span>) {
        fiber.return = workInProgress;
    }
    <span class="hljs-keyword">while</span>(fiber !== <span class="hljs-literal">null</span>){
        <span class="hljs-keyword">const</span> list = fiber.dependencies;
         <span class="hljs-keyword">while</span> (dependency !== <span class="hljs-literal">null</span>) {
              <span class="hljs-keyword">if</span> (dependency.context === context){
                   <span class="hljs-comment">/* ç±»ç»„ä»¶ï¼šä¸å— PureComponent å’Œ shouldComponentUpdate å½±å“ */</span>
                   <span class="hljs-keyword">if</span> (fiber.tag === ClassComponent) {
                         <span class="hljs-comment">/* ä¼šèµ° forceUpdate é€»è¾‘ */</span>
                        <span class="hljs-keyword">const</span> update = createUpdate(renderExpirationTime, <span class="hljs-literal">null</span>);
                        update.tag = ForceUpdate;
                        enqueueUpdate(fiber, update);
                   }
                   <span class="hljs-comment">/* é‡è¦ï¼š<span class="hljs-doctag">TODO:</span> æé«˜ fiber çš„ä¼˜å…ˆçº§ï¼Œè®©å½“å‰ fiber å¯ä»¥ beginWork ï¼Œå¹¶ä¸”å‘ä¸Šæ›´æ–°çˆ¶çº§ fiber é“¾ä¸Šçš„ä¼˜å…ˆçº§ */</span>
                   ...
              } 
         }
    }
}
</code></pre>
<p><code>propagateContextChange</code> éå¸¸é‡è¦ï¼Œå®ƒçš„èŒè´£å°±æ˜¯æ·±åº¦éå†æ‰€æœ‰çš„å­ä»£ fiber ï¼Œç„¶åæ‰¾åˆ°é‡Œé¢å…·æœ‰ <code>dependencies</code> çš„å±æ€§ï¼Œå¯¹æ¯” dependencies ä¸­çš„ context å’Œå½“å‰ Provider çš„ context æ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Œå¦‚æœæ˜¯åŒä¸€ä¸ªï¼Œé‚£ä¹ˆå¦‚æœå½“å‰ fiber æ˜¯ç±»ç»„ä»¶ï¼Œé‚£ä¹ˆä¼šç»™ç»‘å®šä¸€ä¸ª forceUpdate æ ‡è¯† ã€‚ç„¶åä¼šæé«˜  fiber çš„æ›´æ–°ä¼˜å…ˆçº§ï¼Œè®© fiber åœ¨æ¥ä¸‹æ¥çš„è°ƒå’Œè¿‡ç¨‹ä¸­ï¼Œå¤„äºä¸€ä¸ªé«˜ä¼˜å…ˆçº§å¾…æ›´æ–°çš„çŠ¶æ€ã€‚æ¥ä¸‹æ¥çš„ä»£ç æ¯”è¾ƒé•¿ï¼Œæˆ‘è¿™é‡Œæ²¡æœ‰å…¨éƒ¨ç½—åˆ—å‡ºæ¥ï¼Œå¤§è‡´é€»è¾‘å°±æ˜¯ï¼Œæ‰¾åˆ°å½“å‰ fiber å‘ä¸Šçš„çˆ¶çº§é“¾ä¸Šçš„ fiber ï¼Œç»Ÿä¸€æ›´æ–°ä»–ä»¬çš„ä¼˜å…ˆçº§ï¼Œä½¿ä¹‹å˜æˆé«˜ä¼˜å…ˆçº§å¾…æ›´æ–°çŠ¶æ€ã€‚</p>
<p>é‚£ä¹ˆä¸Šè¿°æµç¨‹ä¸­æš´éœ²å‡ºå‡ ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>
<p>1 ä»€ä¹ˆæƒ…å†µä¸‹ fiber ä¼šå­˜åœ¨ dependencies ï¼Œé¦–å…ˆ dependencies åœ¨ç¬¬åä¸ƒç« ä¸­ä¼šè®²åˆ°ï¼Œå®ƒä¿å­˜çš„æ˜¯ context çš„ä¾èµ–é¡¹ï¼Œé‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹ä¼šå­˜åœ¨ <strong>context ä¾èµ–é¡¹</strong>ã€‚</p>
</li>
<li>
<p>2 ä¸ºä»€ä¹ˆå¯¹äº class ç±»ç»„ä»¶ä¼šåˆ›å»ºä¸€ä¸ª ForceUpdate ç±»å‹çš„ update å¯¹è±¡å‘¢ï¼Ÿ <br> çŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œé¦–å…ˆçœ‹ä¸€ä¸‹å®ƒæ˜¯ä»€ä¹ˆï¼Ÿ</p>
</li>
</ul>
<p><strong>ï½œ--------é—®ä¸ç­”--------ï½œ</strong><br></p>
<p>é—®ï¼š <strong>ForceUpdate ç±»å‹ update</strong>ï¼š ä»€ä¹ˆæ˜¯ forceUpdate ç±»å‹çš„ update å‘¢ï¼Ÿ</p>
<p>ç­”ï¼šåœ¨ç±»ç»„ä»¶ä¸­ï¼Œé€šè¿‡è°ƒç”¨ <code>this.forceUpdate()</code> å¸¦æ¥çš„æ›´æ–°å°±ä¼šè¢«æ‰“ä¸Š ForceUpdate ç±»å‹çš„ update tagï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºå¼ºåˆ¶æ›´æ–°ã€‚ ç”Ÿå‘½å‘¨æœŸç« èŠ‚è®²è¿‡ï¼Œ åœ¨ç±»ç»„ä»¶æ›´æ–°æµç¨‹ä¸­ï¼Œå¼ºåˆ¶æ›´æ–°ä¼šè·³è¿‡ <code>PureComponent</code> å’Œ <code>shouldComponentUpdate</code> ç­‰ä¼˜åŒ–ç­–ç•¥ã€‚
<strong>ï½œ---------end---------ï½œ</strong></p>
<ul>
<li>3 å­˜åœ¨ dependency çš„ fiber ï¼Œä¸ºä»€ä¹ˆè¦å‘ä¸Šæ›´æ–°çˆ¶çº§ fiber é“¾ä¸Šçš„ä¼˜å…ˆçº§ï¼Œè®©æ‰€æœ‰çˆ¶çº§ fiber éƒ½å¤„äºä¸€ä¸ªé«˜ä¼˜å…ˆçº§ã€‚</li>
</ul>
<p>å¯¹äºä¸Šé¢è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œè·Ÿä¸Šæˆ‘çš„æ€è·¯é€ä¸€çªç ´ã€‚</p>
<p><strong>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š</strong>
é¦–å…ˆå°±æ˜¯ dependencies å±æ€§ï¼Œè¿™ä¸ªå±æ€§å¯ä»¥æŠŠå½“å‰çš„ fiber å’Œ context å»ºç«‹èµ·å…³è”ï¼Œé‚£ä¹ˆå¯ä»¥ç†è§£æˆï¼Œä½¿ç”¨äº†å½“å‰ context çš„ fiber ä¼šæŠŠ context æ”¾åœ¨ dependencies ä¸­ï¼Œdependencies å±æ€§æœ¬èº«æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„ï¼Œä¸€ä¸ª fiber å¯ä»¥æœ‰å¤šä¸ª context ä¸ä¹‹å¯¹åº”ã€‚åè¿‡æ¥æ¨æµ‹ä¸€ä¸‹ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šä½¿ç”¨ context å‘¢ã€‚é‚£ä¹ˆæœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š</p>
<p>1 æœ‰ <code>contextType</code> é™æ€å±æ€§æŒ‡å‘çš„ç±»ç»„ä»¶ã€‚<br>
2 ä½¿ç”¨ <code>useContext</code> hooks çš„å‡½æ•°ç»„ä»¶ã€‚ <br>
3 context æä¾›çš„ <code>Consumer</code>ã€‚</p>
<p>é‚£ä¹ˆå¯ä»¥å¤§èƒ†çš„æ¨æµ‹ä¸€ä¸‹ï¼Œ<strong>ä½¿ç”¨è¿‡ contextType useContext çš„ç»„ä»¶å¯¹åº” fiber,å’Œ Consumer ç±»å‹ fiberï¼Œä¼šå’Œ dependencies å»ºç«‹èµ·è”ç³»ï¼Œä¼šæŠŠå½“å‰æ¶ˆè´¹çš„ context æ”¾å…¥ dependencies ä¸­ã€‚è¿™ä¸ªä¸‹é¢ä¼šç»™è¯¦ç»†è§£é‡Š</strong></p>
<p><strong>ç¬¬äºŒä¸ªé—®é¢˜ï¼š</strong>
ä¸ºä»€ä¹ˆå¯¹äº class ç»„ä»¶ä¼šåˆ›å»ºä¸€ä¸ª ForceUpdate çš„ update å‘¢ï¼Ÿ</p>
<p>åœ¨<strong>ç”Ÿå‘½å‘¨æœŸç« èŠ‚</strong>å’Œ<strong>æ¸²æŸ“æ§åˆ¶ç« èŠ‚</strong>ï¼Œè®²åˆ°è¿‡å¦‚æœæƒ³è¦è®©ç±»ç»„ä»¶è°ƒç”¨ renderï¼Œå¾—åˆ°æ–°çš„ childrenï¼Œé‚£ä¹ˆå°±è¦é€šè¿‡ <code>PureComponent</code> å’Œ <code>shouldComponentUpdate</code> ç­‰å±‚å±‚é˜»ç¢ï¼Œé‚£ä¹ˆ context è¦çªç ´è¿™äº›æ§åˆ¶ï¼Œå°±è¦åšåˆ°å½“ value æ”¹å˜ï¼Œæ¶ˆè´¹ context çš„ç±»ç»„ä»¶æ›´æ–°ï¼Œåˆ™éœ€è¦é€šè¿‡ forceUpdate å¼ºåˆ¶æ›´æ–°ã€‚è¿™æ ·å°±è§£å†³äº†ç±»ç»„ä»¶æ›´æ–°é™åˆ¶ã€‚</p>
<p>é‚£ä¹ˆæ€»ç»“ä¸€ä¸‹æµç¨‹ï¼Œå½“ Provider çš„ value æ›´æ–°ä¹‹åï¼ŒProvider ä¸‹é¢çš„åªè¦æœ‰æ¶ˆè´¹äº† context çš„ç±»ç»„ä»¶ï¼Œå°±ä¼šè§¦å‘å¼ºåˆ¶æ›´æ–°ã€‚è¿™ä¹Ÿå°±è§£é‡Šäº†æœ€å¼€å§‹çš„é—®é¢˜â€”â€”<strong>context æ›´æ–°ï¼Œå¦‚ä½•é¿å… <code>pureComponent</code> ï¼Œ <code>shouldComponentUpdate</code> æ¸²æŸ“æ§åˆ¶ç­–ç•¥çš„å½±å“ã€‚</strong> ç”¨ä¸€å¹…æµç¨‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6ad02d5d2b0640ca8d376abebff714a2~tplv-k3u1fbpfcp-watermark.image?" alt="context7.jpg"></p>
<p><strong>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼š</strong> è¿™ä¸ªé—®é¢˜å°±è¦ä» Provider ç±»å‹çš„ fiber è°ƒå’Œå¼€å§‹è®²ã€‚</p>
<h4>Provider å’Œ beiginWork è°ƒå’Œæ›´æ–°æœºåˆ¶</h4>
<p>æ¥ä¸‹æ¥é‡ç‚¹ä»‹ç» Provider å’Œ beiginWork è°ƒå’Œæ›´æ–°æœºåˆ¶ã€‚é¦–å…ˆå¼•å‡ºä¸¤ä¸ªæ€è€ƒç‚¹ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªç±»ç»„ä»¶æ‰§è¡Œ render ï¼Œå‡½æ•°ç»„ä»¶æ‰§è¡Œå°±æ˜¯æ¸²æŸ“ä¹ˆï¼Ÿ</li>
<li>ç¬¬äºŒä¸ª Context æ”¹å˜å¦‚ä½•åšåˆ°æ¶ˆè´¹ context çš„ç»„ä»¶æ›´æ–°çš„ï¼Ÿï¼ˆæ›´æ–°åŸç†ï¼‰</li>
</ul>
<p>å…ˆæ¥çœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªæ€è€ƒç‚¹ï¼Œå…³äºæ¸²æŸ“çš„æ€è€ƒï¼Œå®é™…ä¸Šåœ¨ React æ•´ä¸ª <code>Reconciler</code> è°ƒå’Œæµç¨‹ä¸­ï¼Œä»æ›´æ–°è°ƒåº¦ä»»åŠ¡çš„å‘èµ·ï¼Œå†åˆ°åœ¨ commit å’Œ render ä¸¤å¤§é˜¶æ®µï¼Œå†åˆ°çœŸå®çš„ dom å…ƒç´ ç»˜åˆ¶ï¼Œæ¯ä¸€ä¸ªç¯èŠ‚éƒ½å±äºæ¸²æŸ“çš„ä¸€éƒ¨åˆ†ã€‚è€Œå¼€å‘è€…èƒ½å¤Ÿæ§åˆ¶çš„ render ï¼Œåªæ˜¯å…¶ä¸­çš„ä¸€å°éƒ¨åˆ†â€”â€”ç±»ç»„ä»¶æ‰§è¡Œ render ï¼Œå‡½æ•°ç»„ä»¶æ‰§è¡Œã€‚è€Œä¸”è¿™äº›æœ¬è´¨ä¸Šéƒ½å‘ç”Ÿåœ¨ FunctionComponent fiber å’Œ ClassComponent fiber ä¸Šã€‚ä½†æ˜¯æ•´ä¸ª fiber æ ‘åœ¨è°ƒå’Œé˜¶æ®µéƒ½éœ€è¦æ›´æ–°çš„ã€‚æ›´æ–°è°ƒå’Œ fiber çš„æ–¹æ³•åœ¨ React åº•å±‚å«åš <strong><code>beginWork</code></strong>ã€‚æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ <code>beginWork</code> é renderã€‚å…ˆæ¥çœ‹çœ‹ä¸¤è€…çš„åŒºåˆ«ã€‚</p>
<ul>
<li><code>beginWork</code> ï¼š åœ¨ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œåªè¦éœ€è¦æ›´æ–°çš„ fiber æˆ–è€…å—åˆ°ç‰µè¿çš„ fiberï¼Œéƒ½ä¼šæ‰§è¡Œ beginWork ã€‚</li>
<li><code>render</code>   ï¼š åœ¨ä¸€æ¬¡æ›´æ–°ä¸­ï¼Œåªæœ‰ç»„ä»¶ç±»å‹çš„ fiber ä¼šæ‰§è¡Œ render ï¼Œå¾—åˆ°æ–°çš„ children ã€‚å¦‚æœç»„ä»¶è§¦å‘ render é‚£ä¹ˆå®ƒä¸€å®šç»å†è¿‡ <code>beginWork</code></li>
</ul>
<p>è¿™é‡Œå¦‚æœæœ‰åŒå­¦ä¸æ˜ç™½ä¸è¦ç´§ï¼Œæ¥ç€å¾€ä¸‹çœ‹ã€‚</p>
<p>æ¯”å¦‚å‘ç”Ÿä¸€æ¬¡æ›´æ–°ä»»åŠ¡ï¼Œæ­¤æ¬¡æ›´æ–°å¯èƒ½å‘ç”Ÿæ•´ä¸ª fiber æ ‘çš„ä»»æ„æå¶ä¸Šï¼Œä½†æ˜¯å› ä¸º context props ç©¿é€å½±å“ï¼ŒReact ä¸çŸ¥é“æ­¤æ¬¡æ›´æ–°çš„æ³¢åŠèŒƒå›´ï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†å‘¢ï¼Ÿ React ä¼šä» rootFiber å¼€å§‹æ›´æ–°ï¼Œæ¯ä¸€ä¸ªæ›´æ–° fiber éƒ½ä¼šèµ° <code>beginWork</code> æµç¨‹ï¼Œå¼€å§‹æ‰¾ä¸åŒï¼Œæ‰¾åˆ°æœ‰æ²¡æœ‰éœ€è¦æ›´æ–°çš„åœ°æ–¹ï¼Œé‚£ä¹ˆæŒ‡æ ‡æ˜¯ä»€ä¹ˆå‘¢ï¼Œå…¶ä¸­ä¸€ä¸ªé‡è¦çš„æŒ‡æ ‡å°±æ˜¯<strong>æ›´æ–°çš„ä¼˜å…ˆçº§</strong>ï¼Œè€ç‰ˆæœ¬ç”¨çš„æ˜¯ <code>expirationTime</code> ï¼Œæ–°ç‰ˆæœ¬ç”¨çš„æ˜¯ <code>lane</code>ï¼Œé‚£ä¹ˆå°±è¦ä¿è¯ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å¦‚æœæ›´æ–°å‘ç”Ÿåœ¨ä¸€ä¸ªå­ä»£èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåªæœ‰çˆ¶èŠ‚ç‚¹ <code>beginWork</code> æ‰èƒ½è®©å­ä»£èŠ‚ç‚¹ <code>beginWork</code>ã€‚è¿™æ ·å°±å½¢æˆäº†ä¸€æ¡ root fiber -> çˆ¶ fiber -> å­ fiber çš„ <code>beginWork</code> é“¾ã€‚åœ¨ beginwork è¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>ç¬¬ä¸€ç§ï¼š å¦‚æœé‡åˆ°ç»„ä»¶ï¼Œè€Œä¸”æ›´æ–°ä¸æ¶‰åŠå½“å‰ç»„ä»¶ï¼Œä¹Ÿä¸åœ¨å½“å‰ç»„ä»¶çš„çˆ¶å­é€’å½’é“¾ä¸Šï¼Œé‚£ä¹ˆå°±ä¸ä¼š renderï¼Œä¹Ÿä¸ä¼šå‘ä¸‹ beginWork ã€‚</li>
<li>ç¬¬äºŒç§ï¼š å¦‚æœé‡åˆ°ç»„ä»¶ï¼Œè€Œä¸”æ›´æ–°ä¸æ¶‰åŠå½“å‰ç»„ä»¶ï¼Œä½†æ˜¯æ›´æ–°ç»„ä»¶å±äºå½“å‰ç»„ä»¶çš„å­å­™åä»£ï¼Œé‚£ä¹ˆä¸ä¼š renderï¼Œä½†æ˜¯ä¼šå‘ä¸‹ beginWork ï¼Œç›®çš„å¾ˆæ˜ç¡®ï¼Œæ‰¾åˆ°å¯¹åº”çš„æ›´æ–°ç»„ä»¶ã€‚</li>
<li>ç¬¬ä¸‰ç§ï¼š å¦‚æœé‡åˆ°å…¶ä»–ç±»å‹çš„ fiber æ¯”å¦‚ hostComponent  <code>&#x3C;div></code> ï¼Œé‚£ä¹ˆä¼šå¯¹æ¯”å½“å‰çš„æ›´æ–°ä¼˜å…ˆçº§ï¼Œå¦‚æœä½ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆä¸éœ€è¦å‘ä¸‹ beginWork ã€‚åä¹‹å‘ä¸‹ beginWorkã€‚</li>
</ul>
<p>è¿™ä¹ˆè¯´å¯èƒ½å¤§å®¶ä¸æ˜¯å¾ˆç†è§£ï¼Œæˆ‘ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p>
<p>å¦‚ä¸‹å½“ç‚¹å‡» componentB ä¸‹é¢çš„ span è§¦å‘ setState æ›´æ–° ï¼Œå¦‚ä¸‹å¯ä»¥æ¸…æ™°çœ‹è§ beginWork å’Œ render æµç¨‹ã€‚</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4be69acfeb8d42c68249f96b8bbb7b98~tplv-k3u1fbpfcp-watermark.image?" alt="context8.jpg"></p>
<ul>
<li>ä» root å¼€å§‹ç¬¬ä¸€æ¬¡è°ƒå’Œï¼Œ ä¸‰ä¸ª fiber éƒ½ä¼šç»å† beginWork ï¼Œé€šè¿‡å¯¹æ¯”ä¼˜å…ˆçº§ï¼Œ <code>componentA</code> å’Œ <code>div</code> åœæ­¢å‘ä¸‹ beginworkã€‚</li>
<li>æ›´æ–°å‘ç”Ÿåœ¨ componentB ï¼Œæ‰€ä»¥ componentB æ¸²æŸ“ï¼Œè§¦å‘ <code>render</code> ï¼Œå¾—åˆ°æ–°çš„ elementï¼Œé€šè¿‡å¯¹æ¯”ï¼Œ <code>div</code> <code>span</code> éƒ½ä¼š beginworkã€‚</li>
<li>componentC ç”±äºçˆ¶ç»„ä»¶æ›´æ–°ï¼Œæ²¡æœ‰ä»»ä½•ä¼˜åŒ–ç­–ç•¥çš„æƒ…å†µï¼Œé‚£ä¹ˆä¹Ÿä¼šè·Ÿç€ <code>render</code>ï¼Œæ¥ç€ div ä¹Ÿä¼šè·Ÿç€ beginworkã€‚</li>
</ul>
<p>é‚£ä¹ˆå¦‚ä¸Šï¼Œå¦‚æœ componentC é€šè¿‡ <code>PureComponent</code> æˆ–è€… <code>shouldComponentUpdate</code> é™åˆ¶æ›´æ–°ä¹‹åã€‚é‚£ä¹ˆä¼šå˜æˆå¦‚ä¸‹çš„æ ·å­ï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/76bac2d4e134455dbdf31fa33cd7f27b~tplv-k3u1fbpfcp-watermark.image?" alt="context9.jpg"></p>
<ul>
<li>å¦‚ä¸Š componentC é€šè¿‡ <code>PureComponent</code> å¤„ç†åï¼Œä¸å† render ï¼Œå½“ç„¶ä¹Ÿä¸ä¼šå†å‘ä¸‹ beginworkã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œå¦‚æœç‚¹å‡» componentC ä¸‹çš„ divï¼Œè§¦å‘ setState æ›´æ–°ï¼Œé‚£ä¹ˆåˆä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<ul>
<li>æ­¤æ—¶æ›´æ–°å‘ç”Ÿåœ¨ <code>componentC</code> ä¸Šï¼Œæ‰€ä»¥ componentB åªä¼šå‘ç”Ÿ beginwork ï¼Œä¸ä¼šå‘ç”Ÿ renderã€‚</li>
<li><code>componentB</code> ä¸‹é¢çš„ <code>div</code> ä¼šåœæ­¢å‘ä¸‹çš„ beiginwork ã€‚</li>
</ul>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/015b6ad8e1404fae88319b150cd05451~tplv-k3u1fbpfcp-watermark.image?" alt="context10.jpg"></p>
<p><strong>æˆ‘ä»¬æ€»ç»“æµç¨‹å¦‚ä¸‹ï¼š</strong></p>
<ul>
<li>1 å¦‚æœä¸€ä¸ªç»„ä»¶å‘ç”Ÿæ›´æ–°ï¼Œé‚£ä¹ˆå½“å‰ç»„ä»¶åˆ° fiber root ä¸Šçš„çˆ¶çº§é“¾ä¸Šçš„æ‰€æœ‰ fiber ï¼Œæ›´æ–°ä¼˜å…ˆçº§éƒ½ä¼šå‡é«˜ï¼Œéƒ½ä¼šè§¦å‘ beginwork ã€‚</li>
<li>2 render ä¸ç­‰äº beginWorkï¼Œä½†æ˜¯ render å‘ç”Ÿï¼Œä¸€å®šè§¦å‘äº† beginwork ã€‚</li>
<li>3 ä¸€æ¬¡ beginwork ï¼Œä¸€ä¸ª fiber ä¸‹çš„åŒçº§å…„å¼Ÿ fiber ä¼šå‘ç”Ÿå¯¹æ¯”ï¼Œæ‰¾åˆ°ä»»åŠ¡ä¼˜å…ˆçº§é«˜çš„ fiber ã€‚å‘ä¸‹ beginwork ã€‚</li>
</ul>
<p>å¯¹äº beginwork çš„æµç¨‹ï¼Œæ¥ä¸‹æ¥ä¼šæœ‰ä¸“é—¨çš„ç« èŠ‚ç»´æŠ¤ã€‚</p>
<p><strong>Context åŸç†</strong></p>
<p>æ¥ä¸‹æ¥è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ context çš„æ›´æ–°åŸç†ï¼Œä¸Šé¢è¯´åˆ° <code>Provider</code> æ›´æ–°ï¼Œä¼šé€’å½’æ‰€æœ‰çš„å­ç»„ä»¶ï¼Œåªè¦æ¶ˆè´¹äº† context çš„å­ä»£ fiber ï¼Œéƒ½ä¼šç»™ä¸€ä¸ªé«˜ä¼˜å…ˆçº§ã€‚è€Œä¸”å‘ä¸Šæ›´æ–°çˆ¶çº§ fiber é“¾ä¸Šçš„ä¼˜å…ˆçº§ï¼Œè®©æ‰€æœ‰çˆ¶çº§ fiber éƒ½å¤„äºä¸€ä¸ªé«˜ä¼˜å…ˆçº§ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥é«˜ä¼˜å…ˆçº§çš„ fiber éƒ½ä¼š beginWork ã€‚</p>
<p>é‚£ä¹ˆå°†ä¸Šè¿°ä¾‹å­è¿›è¡Œä¿®æ”¹ï¼Œ<code>propagateContextChange</code> çš„æµç¨‹ä¼šä¸‹å¦‚ä¸‹ä¸€æ ·ï¼ŒæŠŠçˆ¶çº§ fiber çš„ä¼˜å…ˆçº§æé«˜ã€‚</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/84210209b512493889a9d2c3a066324e~tplv-k3u1fbpfcp-watermark.image?" alt="context11.jpg"></p>
<p>é‚£ä¹ˆæ•´ä¸ª fiber æ›´æ–°æµç¨‹ä¼šåƒå¦‚ä¸‹ä¸€æ ·</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/761505beb9664b09a27599550b6a0cf7~tplv-k3u1fbpfcp-watermark.image?" alt="context12.jpg"></p>
<h3>2 Consumer</h3>
<p>æˆ‘ä»¬å·²ç»è®²äº† Provider æ ¸å¿ƒåŸç†ï¼Œè¿˜æœ‰å¦å¤–ä¸€éƒ¨åˆ†å°±æ˜¯ Consumer ï¼Œç ”ç©¶ä¸€ä¸‹å…¶åŸç†ã€‚</p>
<h4>Consumer æµç¨‹</h4>
<p>ä¸Šæ–‡è¯´é“ï¼ŒConsumer æœ¬è´¨ä¸Šæ˜¯ç±»å‹ä¸º <code>REACT_CONTEXT_TYPE</code> çš„ element å¯¹è±¡ã€‚åœ¨è°ƒå’Œé˜¶æ®µï¼Œä¼šè½¬åŒ–æˆ <code>ContextConsumer</code> ç±»å‹çš„ fiber å¯¹è±¡ã€‚åœ¨ beginwork ä¸­ï¼Œä¼šè°ƒç”¨ <code>updateContextConsumer</code> æ–¹æ³•ã€‚é‚£ä¹ˆè¿™ä¸ªæ–¹æ³•åšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<blockquote>
<p>react/react-reconcider/src/ReactFiberBeginWork.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateContextConsumer</span>(<span class="hljs-params">current,workInProgress,renderExpirationTime,</span>) </span>{
  <span class="hljs-keyword">let</span> context  = workInProgress.type;
  <span class="hljs-keyword">const</span> newProps = workInProgress.pendingProps;
  <span class="hljs-comment">/* å¾—åˆ° render props children */</span>
  <span class="hljs-keyword">const</span> render = newProps.children;
  <span class="hljs-comment">/* è¯»å– context */</span> 
  prepareToReadContext(workInProgress, renderExpirationTime);
  <span class="hljs-comment">/* å¾—åˆ°æœ€æ–°çš„æ–°çš„ context value */</span>
  <span class="hljs-keyword">const</span> newValue = readContext(context, newProps.unstable_observedBits);
  <span class="hljs-keyword">let</span> newChildren;
  <span class="hljs-comment">/* å¾—åˆ°æœ€æ–°çš„ children element */</span>
  newChildren = render(newValue);
  workInProgress.effectTag |= PerformedWork;
  <span class="hljs-comment">/* è°ƒå’Œ children */</span>
  reconcileChildren(current, workInProgress, newChildren, renderExpirationTime);
  <span class="hljs-keyword">return</span> workInProgress.child;
}
</code></pre>
<p><code>updateContextConsumer</code>çš„æ ¸å¿ƒæµç¨‹ï¼š</p>
<ul>
<li>é¦–å…ˆè°ƒç”¨ <code>readContext</code> è·å–æœ€æ–°çš„ value ã€‚</li>
<li>ç„¶åé€šè¿‡ <code>render props</code> å‡½æ•°ï¼Œä¼ å…¥æœ€æ–°çš„ valueï¼Œå¾—åˆ°æœ€æ–°çš„ <code>children</code> ã€‚</li>
<li>æ¥ä¸‹æ¥è°ƒå’Œ children ã€‚</li>
</ul>
<p>é‚£ä¹ˆæœ‰ä¸€ä¸ªé—®é¢˜<strong>å°±æ˜¯ fiber ä¸Šçš„ dependencies å¦‚ä½•å’Œ context å»ºç«‹èµ·å…³è”ã€‚</strong> é‚£ä¹ˆå°±æ˜¯ <strong><code>readContext</code></strong> è¿™ä¸ªå‡½æ•°åšçš„äº‹ï¼Œå¯ä»¥æå‰é€éœ²ä¸€ä¸‹ï¼ŒuseContext å’Œ contextType æœ¬è´¨ä¸Šä¹Ÿæ˜¯</p>
<h4>readContext</h4>
<p>readContext æ˜¯é™¤äº† <code>Provider</code> ä¹‹å¤–ï¼Œç¬¬äºŒä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚</p>
<blockquote>
<p>react/react-reconcider/src/ReactFiberNewContext.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readContext</span>(<span class="hljs-params"> context,observedBits </span>)</span>{
    <span class="hljs-comment">/* åˆ›å»ºä¸€ä¸ª contextItem */</span>
    <span class="hljs-keyword">const</span> contextItem = {
      context,
      <span class="hljs-attr">observedBits</span>: resolvedObservedBits,
      <span class="hljs-attr">next</span>: <span class="hljs-literal">null</span>,
    };
    <span class="hljs-comment">/* ä¸å­˜åœ¨æœ€åä¸€ä¸ª context Dependency  */</span>
    <span class="hljs-keyword">if</span> (lastContextDependency === <span class="hljs-literal">null</span>) {
      lastContextDependency = contextItem;
      currentlyRenderingFiber.dependencies = {
        <span class="hljs-attr">expirationTime</span>: NoWork,
        <span class="hljs-attr">firstContext</span>: contextItem,
        <span class="hljs-attr">responders</span>: <span class="hljs-literal">null</span>,
      };
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">/* å­˜åœ¨çš„æƒ…å†µ */</span>
      lastContextDependency = lastContextDependency.next = contextItem;
    }
   
  <span class="hljs-keyword">return</span> isPrimaryRenderer ? context._currentValue : context._currentValue2;
}
</code></pre>
<ul>
<li>readContext ä¸»è¦åšçš„äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼Œé¦–å…ˆä¼šåˆ›å»ºä¸€ä¸ª contextItem ï¼Œä¸Šè¿°è¯´åˆ°è¿‡ fiber ä¸Šä¼šå­˜åœ¨å¤šä¸ª <code>dependencies</code> ï¼Œå®ƒä»¬ä»¥é“¾è¡¨çš„å½¢å¼è”ç³»åˆ°ä¸€èµ·ï¼Œå¦‚æœä¸å­˜åœ¨æœ€åä¸€ä¸ª <code>context dependency</code> ï¼Œé‚£è¯æ˜ context dependencies ä¸ºç©º ï¼Œé‚£ä¹ˆä¼šåˆ›å»ºç¬¬ä¸€ä¸ª dependency ï¼Œå¦‚æœå­˜åœ¨æœ€åä¸€ä¸ª dependency ï¼Œé‚£ä¹ˆ contextItem ä¼šä»¥é“¾è¡¨å½¢å¼ä¿å­˜ï¼Œå¹¶å˜æˆæœ€åä¸€ä¸ª lastContextDependency ã€‚</li>
</ul>
<h4>å¤šä¸ª Provider åµŒå¥—</h4>
<p>å¦‚æœæœ‰å¤šä¸ª Provider çš„æƒ…å†µï¼Œé‚£ä¹ˆåä¸€ä¸ª contextValue ä¼šè¦†ç›–å‰ä¸€ä¸ª contextValueï¼Œåœ¨å¼€å‘è€…è„‘æµ·ä¸­ï¼Œè¦æœ‰ä¸€ä¸ªå®šå¾‹å°±æ˜¯ï¼š<strong><code>Provider</code> æ˜¯ç”¨æ¥ä¼ é€’ valueï¼Œè€Œéä¿å­˜ value ã€‚</strong></p>
<h3>3 contextType å’Œ useContext</h3>
<h4>useContext åŸç†</h4>
<p><code>useContext</code> åŸç†ï¼Œè°ƒç”¨ useContext æœ¬è´¨ä¸Šè°ƒç”¨ <code>readContext</code> æ–¹æ³•ã€‚</p>
<blockquote>
<p>react/react-reconcider/src/ReactFiberHooks.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> HooksDispatcherOnMount ={
    <span class="hljs-attr">useContext</span>: readContext
}
</code></pre>
<ul>
<li>å‡½æ•°ç»„ä»¶é€šè¿‡ readContext ï¼Œå°†å‡½æ•°ç»„ä»¶çš„ <code>dependencies</code>å’Œå½“å‰ context å»ºç«‹èµ·å…³è”ï¼Œcontext æ”¹å˜ï¼Œå°†å½“å‰å‡½æ•°ç»„ä»¶è®¾ç½®é«˜ä¼˜å…ˆçº§ï¼Œä¿ƒä½¿å…¶æ¸²æŸ“ã€‚</li>
</ul>
<h4>contextType åŸç†</h4>
<p>ç±»ç»„ä»¶çš„é™æ€å±æ€§ <code>contextType</code> å’Œ useContext ä¸€æ ·ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯è°ƒç”¨ readContext æ–¹æ³•ã€‚</p>
<blockquote>
<p>react/react-reconcider/src/ReactFiberClassComponent.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">constructClassInstance</span>(<span class="hljs-params">workInProgress,ctor,props</span>)</span>{
     <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> contextType === <span class="hljs-string">'object'</span> &#x26;&#x26; contextType !== <span class="hljs-literal">null</span>) {
         <span class="hljs-comment">/* è¯»å– context  */</span>
        context = readContext(contextType);
    } 

    <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> ctor(props, context);
}
</code></pre>
<ul>
<li>é™æ€å±æ€§ contextType ï¼Œåœ¨ç±»ç»„ä»¶å®ä¾‹åŒ–çš„æ—¶å€™è¢«ä½¿ç”¨ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯è°ƒç”¨ <code>readContext</code>å°† context å’Œ fiber ä¸Šçš„  <code>dependencies</code> å»ºç«‹èµ·å…³è”ã€‚</li>
</ul>
<h3>4 Context æµç¨‹æ€»ç»“</h3>
<p>ä¸‹é¢å¯¹æ•´ä¸ª context åŸç†éƒ¨åˆ†åšæ€»ç»“ã€‚</p>
<ul>
<li>
<p>Provider ä¼ é€’æµç¨‹ï¼šProvider çš„æ›´æ–°ï¼Œä¼šæ·±åº¦éå†å­ä»£ fiberï¼Œæ¶ˆè´¹ context çš„ fiber å’Œçˆ¶çº§é“¾éƒ½ä¼šæå‡æ›´æ–°ä¼˜å…ˆçº§ã€‚ å¯¹äºç±»ç»„ä»¶çš„ fiber ï¼Œä¼š forceUpdate å¤„ç†ã€‚æ¥ä¸‹æ¥æ‰€æœ‰æ¶ˆè´¹çš„ fiberï¼Œéƒ½ä¼š beginWork ã€‚</p>
</li>
<li>
<p>context è®¢é˜…æµç¨‹ï¼š <code>contextType</code> ï¼Œ <code>useContext</code>ï¼Œ <code>Consumer</code> ä¼šå†…éƒ¨è°ƒç”¨ <code>readContext</code> ï¼ŒreadContext ä¼šæŠŠ fiber ä¸Šçš„ <code>dependencies</code> å±æ€§å’Œ context å¯¹è±¡å»ºç«‹èµ·å…³è”ã€‚</p>
</li>
</ul>
<h3>5 æ€»ç»“</h3>
<p>æœ¬ç« èŠ‚çŸ¥è¯†ç‚¹æ€»ç»“:</p>
<ul>
<li>context åŸç†ï¼ŒProvider åšäº†äº›ä»€ä¹ˆã€‚</li>
<li>beginWork å’Œ render çš„æ›´æ–°åŸåˆ™å’ŒåŒºåˆ«ã€‚</li>
<li>ä¸‰ç§ context ä¼ é€’æ¨¡å¼åŸç†ã€‚</li>
<li>context è®¢é˜…æ¶ˆè´¹åŸç†ã€‚</li>
<li>Provider åµŒå¥—ä¼ é€’åŸç†ã€‚</li>
</ul>
<p>é€æ¼ä¸€ä¸‹ï¼Œæ¥ä¸‹æ¥ä¼šæ›´æ–°å¦å¤–ä¸€ä¸ªæ–°çš„ç« èŠ‚ fiber åˆå§‹åŒ–å’Œè°ƒå’Œæµç¨‹ã€‚</p></div>
</body></html>