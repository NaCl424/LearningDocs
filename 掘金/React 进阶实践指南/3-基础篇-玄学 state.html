<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¬¬ 01 è®²ï¼šè®¾è®¡ä¸€ä»½å¸å¼•é¢è¯•å®˜çš„ç®€å†</title>
<style type="text/css">
:root {
    --control-text-color: #777;
    --select-text-bg-color: rgba(223, 197, 223);  /*#7e66992e;*/
    
    /* side bar */
    --side-bar-bg-color: rgb(255, 255, 255);
    --active-file-text-color: #8163bd;
    --active-file-bg-color: #E9E4F0;
    --item-hover-bg-color: #E9E4F0;
    --active-file-border-color: #8163bd;

    --title-color: #6c549c;
    --font-sans-serif: 'Ubuntu', 'Source Sans Pro', sans-serif !important;
    --font-monospace: 'Fira Code', 'Roboto Mono', monospace !important;
    --purple-1: #8163bd;
    --purple-2: #79589F;
    --purple-3: #fd5eb8;
    --purple-light-1: rgba(99, 99, 172, .05);
    --purple-light-2: rgba(99, 99, 172, .1);
    --purple-light-3: rgba(99, 99, 172, .2);
    --purple-light-4: rgba(129, 99, 189, .3);
    --purple-light-5: #E9E4F0;
    --purple-light-6: rgba(129, 99, 189, .8);
}

/* html {
    font-size: 16px;
} */

body {
    font-family: var(--font-sans-serif);
    color: #34495e;
    -webkit-font-smoothing: antialiased;
    line-height: 1.6rem;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
}

/* é¡µè¾¹è· å’Œ é¡µé¢å¤§å° */
#write {
    padding-left: 6ch;
    padding-right: 6ch;
    margin: 0 auto;
}

#write p {
    line-height: 1.6rem;
    word-spacing: .05rem;
}

#write ol li {
    padding-left: 0.5rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

a {
    color: var(--purple-1);
    padding: 0 2px;
    text-decoration: none;
}
.md-content {
    color: var(--purple-light-6);
}
#write a {
    border-bottom: 1px solid var(--purple-1);
    color: var(--purple-1);
    text-decoration: none;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
    /* font-weight: bold; */
    font-weight: 500 !important;
    line-height: 1.4;
    cursor: text;
    color: var(--title-color);
    font-family: var(--font-sans-serif);
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}
h2 tt,
h2 code {
    font-size: inherit !important;
}
h3 tt,
h3 code {
    font-size: inherit !important;
}
h4 tt,
h4 code {
    font-size: inherit !important;
}
h5 tt,
h5 code {
    font-size: inherit !important;
}
h6 tt,
h6 code {
    font-size: inherit !important;
}


h1 {
    padding-bottom: .4rem;
    font-size: 2.2rem;
    line-height: 1.3;
}
h1 {
    text-align: center;
    padding-bottom: 0.3em;
    font-size: 2.2em;
    line-height: 1.2;
    margin: 2.4em auto 1.2em;
}
h1:after {
    content: '';
    display: block;
    margin: 0.2em auto 0;
    width: 100px;
    height: 2px;
    border-bottom: 2px solid var(--title-color);
}

h2 {
    margin: 1.6em auto 0.5em;
    padding-left: 10px;
    line-height: 1.4;
    font-size: 1.8em;
    border-left: 9px solid var(--title-color);
    border-bottom: 1px solid var(--title-color);
}
h3 {
    font-size: 1.5rem;
    margin: 1.2em auto 0.5em;
}
h4 {
    font-size: 1.3rem;
}
h5 {
    font-size: 1.2rem;
}
h6 {
    font-size: 1.1rem;
}

p,
blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul,
ol {
    padding-left: 30px;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

/* å¼•ç”¨ */
blockquote {
    /* margin-left: 1rem; */
    border-left: 4px solid var(--purple-light-4);
    padding: 10px 15px;
    color: #777;
    background-color: var(--purple-light-1);
}

/* è¡¨æ ¼ */
table {
    padding: 0;
    word-break: initial;
}

table tr {
    border-top: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}

/* è¡¨æ ¼ èƒŒæ™¯è‰² */
table tr:nth-child(2n),
thead {
    background-color: var(--purple-light-1);
}
#write table thead th {
    background-color: var(--purple-light-2);
}

table tr th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr td {
    border: 1px solid #dfe2e5;
    text-align: left;
    margin: 0;
    padding: 6px 13px;
}

table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}

table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

/* ç²—ä½“ */
#write strong {
    padding: 0 2px;
    color: var(--purple-1);
}

/* æ–œä½“ */
#write em {
    padding: 0 5px 0 2px;
    /* font-style: normal; */
    color: #42b983;
}

/* inline code */
#write code, tt {
    padding: 2px 4px;
    border-radius: 2px;
    font-family: var(--font-monospace);
    font-size: 0.92rem;
    color: var(--purple-3); 
    background-color: rgba(99, 99, 172, .05);
}

tt {
    margin: 0 2px;
}

#write .md-footnote {
    background-color: #f8f8f8;
    color: var(--purple-3);
}

/* heighlight. */
#write mark {
    background-color: #fbd3ea;
    border-radius: 2px;
    padding: 2px 4px;
    margin: 0 2px;
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 0.9rem;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

#write pre.md-meta-block {
    padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

/* å›¾ç‰‡ */
.md-image > .md-meta {
    border-radius: 3px;
    font-family: var(--font-monospace);
    padding: 2px 0 0 4px;
    font-size: 0.9em;
    color: inherit;
}
p .md-image:only-child{
    width: auto;
    text-align: left;
    margin-left: 2rem;
}
.md-tag {
    color: inherit;
}
/* å½“ â€œ![shadow-éšä¾¿å†™]()â€å†™æ—¶ï¼Œä¼šæœ‰é˜´å½± */
.md-image img[alt|='shadow'] {
    /* box-shadow: 0 4px 24px -6px #ddd; */
    box-shadow:var(--purple-light-2) 0px 10px 15px;
}

#write a.md-toc-inner {
    line-height: 1.6;
    white-space: pre-line;
    border-bottom: none;
    font-size: 0.9rem;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

#md-notification:before {
    top: 10px;
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: var(--font-sans-serif);
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

.md-lang {
    color: #b4654d;
}

.html-for-mac .context-menu {
    --item-hover-bg-color: #E6F0FE;
}

/* ä»£ç æ¡† */
/* CodeMirror 3024 Day theme */

/* ä»£ç æ®µ èƒŒæ™¯ */
pre {
    --select-text-bg-color: rgba(223, 197, 223) !important;
    margin: .5em 0;
    padding: 1em 1.4em;
    border-radius: 8px;
    background: #f6f8fa;
    overflow-x: auto;
    box-sizing: border-box;
    font-size: 14px;
}

/* è¾¹æ¡† */
.md-fences {
    border: 1px solid #e7eaed;
    border-radius: 3px;
}

.cm-s-inner {
  padding: .25rem;
  border-radius: .25rem;
}

.cm-s-inner.CodeMirror, .cm-s-inner .CodeMirror-gutters {
  background-color: #f8f8f8 !important;
  color: #3a3432 !important;
  border: none;
}

.cm-s-inner .CodeMirror-gutters {
  color: #6d8a88;
}

.cm-s-inner .CodeMirror-cursor {
  border-left: solid thin #5c5855 !important;
}

.cm-s-inner .CodeMirror-linenumber {
  color: #807d7c;
}

.cm-s-inner .CodeMirror-line::selection, .cm-s-inner .CodeMirror-line::-moz-selection,
.cm-s-inner .CodeMirror-line > span::selection,
.cm-s-inner .CodeMirror-line > span::-moz-selection,
.cm-s-inner .CodeMirror-line > span > span::selection,
.cm-s-inner .CodeMirror-line > span > span::-moz-selection {
  background: var(--purple-light-2);
}

.cm-s-inner span.cm-comment {
  color: #cdab53;
}

.cm-s-inner span.cm-string, .cm-s-inner span.cm-string-2 {
  color: #f2b01d;
}

.cm-s-inner span.cm-number {
  color: #a34e8f;
}

.cm-s-inner span.cm-variable {
  color: #01a252;
}

.cm-s-inner span.cm-variable-2 {
  color: #01a0e4;
}

.cm-s-inner span.cm-def {
  /* color: #e8bbd0; */
  color: #e2287f;
}

.cm-s-inner span.cm-operator {
  color: #ff79c6;
}

.cm-s-inner span.cm-keyword {
  color: #db2d20;
}

.cm-s-inner span.cm-atom {
  color: #a34e8f;
}

.cm-s-inner span.cm-meta {
  color: inherit;
}

.cm-s-inner span.cm-tag {
  color: #db2d20;
}

.cm-s-inner span.cm-attribute {
  color: #01a252;
}

.cm-s-inner span.cm-qualifier {
  color: #388aa3;
}

.cm-s-inner span.cm-property {
  color: #01a252;
}

.cm-s-inner span.cm-builtin {
  color: #388aa3;
}

.cm-s-inner span.cm-variable-3, .cm-s-inner span.cm-type {
  color: #ffb86c;
}

.cm-s-inner span.cm-bracket {
  color: #3a3432;
}

.cm-s-inner span.cm-link {
  color: #a34e8f;
}

.cm-s-inner span.cm-error {
  background: #db2d20;
  color: #5c5855;
}

/* .md-fences.md-focus .cm-s-inner .CodeMirror-activeline-background {
  background: var(--purple-light-2);
} */

.cm-s-inner .CodeMirror-matchingbracket {
  text-decoration: underline;
  color: #a34e8f !important;
}

#fences-auto-suggest .active {
  background: #ddd;
}

#write .code-tooltip {
  bottom: initial;
  top: calc(100% - 1px);
  background: #f7f7f7;
  border: 1px solid #ddd;
  border-top: 0;
}

.auto-suggest-container {
  border-color: #b4b4b4;
}

.auto-suggest-container .autoComplt-hint.active {
  background: #b4b4b4;
  color: inherit;
}

/* task list */
#write .md-task-list-item > input {
  -webkit-appearance: initial;
  display: block;
  position: absolute;
  border: 1px solid #b4b4b4;
  border-radius: .25rem;
  margin-top: .1rem;
  margin-left: -1.8rem;
  height: 1.2rem;
  width: 1.2rem;
  transition: background 0.3s;
}

#write .md-task-list-item > input:focus {
  outline: none;
  box-shadow: none;
}

#write .md-task-list-item > input:hover {
  background: #ddd;
}

#write .md-task-list-item > input[checked]::before {
  content: '';
  position: absolute;
  top: 20%;
  left: 50%;
  height: 60%;
  width: 2px;
  transform: rotate(40deg);
  background: #333;
}

#write .md-task-list-item > input[checked]::after {
  content: '';
  position: absolute;
  top: 46%;
  left: 25%;
  height: 30%;
  width: 2px;
  transform: rotate(-40deg);
  background: #333;
}

#write .md-task-list-item > p {
  transition: color 0.3s, opacity 0.3s;
}

#write .md-task-list-item.task-list-done > p {
  color: #b4b4b4;
  text-decoration: line-through;
}

#write .md-task-list-item.task-list-done > p > .md-emoji {
  opacity: .5;
}

#write .md-task-list-item.task-list-done > p > .md-link > a {
  opacity: .6;
}

/* sidebar and outline */
.pin-outline .outline-active {
  color: var(--active-file-text-color); 
}

.file-list-item {
    border-bottom: 1px solid;
    border-color: var(--purple-light-5);
}

.file-list-item-summary {
    font-weight: 400;
}

.file-list-item.active {
    color: var(--active-file-text-color);
    background-color: var(--purple-light-5);
}

.file-tree-node.active>.file-node-background {
    background-color: var(--purple-light-5);
    font-weight: 700;
} 

.file-tree-node.active>.file-node-content {
    color: var(--active-file-text-color);
    font-weight: 700;
}

.file-node-content {
    color: #5e676d;
}

.sidebar-tabs {
    border-bottom: none;
}
.sidebar-tab.active {
    font-weight: 400;
}

.sidebar-content-content {
    font-size: 0.9rem;
}

img {
    max-width: 100%;
}

body {
    background-color: rgb(237, 237, 237);
}
#content {
    width: 836px;
    padding: 50px;
    background: #fff;
    margin: 0 auto;
}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/purple.css*/</style><style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style></head>
<body>
<div id="content"><h1>åŸºç¡€ç¯‡-ç„å­¦ state</h1>
<h2>ä¸€ å‰è¨€</h2>
<p>æœ¬ç« èŠ‚å°†è¯¦ç»†ä»‹ç»ä¸€ä¸‹ state ï¼Œé¢˜ç›®å«åšç„å­¦ state ï¼Œä¸ºä»€ä¹ˆè¯´ç„å­¦ state å‘¢ï¼Œå› ä¸ºåœ¨ä¸åŒçš„æ‰§è¡Œç¯å¢ƒä¸‹ï¼Œæˆ–è€…ä¸åŒçš„ React æ¨¡å¼ä¸‹ï¼ŒState æ›´æ–°æµç¨‹éƒ½æ˜¯ä¸åŒçš„ã€‚</p>
<p>ä¸ºäº†è¯å®ä¸Šé¢çš„è¯ï¼Œé¦–å…ˆç¿»å‡ºä¸€é“è€æ‰ç‰™çš„é¢è¯•é¢˜ï¼š<strong>state åˆ°åº•æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥çš„ï¼Ÿ</strong></p>
<p>å¦‚æœå¯¹ React åº•å±‚æœ‰ä¸€å®šäº†è§£ï¼Œå›ç­”å‡º batchUpdate æ‰¹é‡æ›´æ–°æ¦‚å¿µï¼Œä»¥åŠæ‰¹é‡æ›´æ–°è¢«æ‰“ç ´çš„æ¡ä»¶ã€‚ä¼¼ä¹å·²ç»è¾¾åˆ°äº†é¢è¯•å®˜çš„è¦æ±‚ï¼Œä½†æ˜¯è¿™é‡Œæƒ³è¯´çš„æ˜¯ï¼Œè¿™ä¸ªç­”æ¡ˆåœ¨ä¸ä¹…çš„å°†æ¥æœ‰å¯èƒ½è¢«é¢ è¦†ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿ</p>
<p>React æ˜¯æœ‰å¤šç§æ¨¡å¼çš„ï¼ŒåŸºæœ¬å¹³æ—¶ç”¨çš„éƒ½æ˜¯ legacy æ¨¡å¼ä¸‹çš„ Reactï¼Œé™¤äº†<code>legacy</code> æ¨¡å¼ï¼Œè¿˜æœ‰ <code>blocking</code> æ¨¡å¼å’Œ <code>concurrent</code> æ¨¡å¼ï¼Œ blocking å¯ä»¥è§†ä¸º concurrent çš„ä¼˜é›…é™çº§ç‰ˆæœ¬å’Œè¿‡æ¸¡ç‰ˆæœ¬ï¼ŒReact æœ€ç»ˆç›®çš„ï¼Œä¸ä¹…çš„æœªæ¥å°†ä»¥ concurrent æ¨¡å¼ä½œä¸ºé»˜è®¤ç‰ˆæœ¬ï¼Œè¿™ä¸ªæ¨¡å¼ä¸‹ä¼šå¼€å¯ä¸€äº›æ–°åŠŸèƒ½ã€‚</p>
<p>å¯¹äº concurrent æ¨¡å¼ä¸‹ï¼Œä¼šé‡‡ç”¨ä¸åŒ State æ›´æ–°é€»è¾‘ã€‚å‰ä¸ä¹…é€éœ²å‡ºæœªæ¥çš„Reactv18 ç‰ˆæœ¬ï¼Œconcurrent å°†ä½œä¸ºä¸€ä¸ªç¨³å®šçš„åŠŸèƒ½å‡ºç°ã€‚</p>
<p>æœ¬ç« èŠ‚ä¸»è¦è¿˜æ˜¯å›´ç»• legacy æ¨¡å¼ä¸‹çš„ state ã€‚é€šè¿‡æœ¬æ–‡å­¦ä¹ ï¼Œç›®çš„æ˜¯è®©å¤§å®¶äº†è§£ React æ›´æ–°æµç¨‹ï¼Œä»¥åŠç±»ç»„ä»¶ setState å’Œå‡½æ•°ç»„ä»¶ useState çš„è¯¸å¤šç»†èŠ‚é—®é¢˜ã€‚</p>
<h2>äºŒ ç±»ç»„ä»¶ä¸­çš„ state</h2>
<h3>setStateç”¨æ³•</h3>
<p>React é¡¹ç›®ä¸­ UI çš„æ”¹å˜æ¥æºäº state æ”¹å˜ï¼Œç±»ç»„ä»¶ä¸­ <code>setState</code> æ˜¯æ›´æ–°ç»„ä»¶ï¼Œæ¸²æŸ“è§†å›¾çš„ä¸»è¦æ–¹å¼ã€‚</p>
<p><strong>åŸºæœ¬ç”¨æ³•</strong></p>
<pre><code class="hljs language-js"><span class="hljs-title function_">setState</span>(obj,callback)
</code></pre>
<ul>
<li>
<p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šå½“ obj ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¸ºå³å°†åˆå¹¶çš„ state ï¼›å¦‚æœ obj æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå½“å‰ç»„ä»¶çš„ state å’Œ props å°†ä½œä¸ºå‚æ•°ï¼Œè¿”å›å€¼ç”¨äºåˆå¹¶æ–°çš„ stateã€‚</p>
</li>
<li>
<p>ç¬¬äºŒä¸ªå‚æ•° callback ï¼šcallback ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­å¯ä»¥è·å–å½“å‰ setState æ›´æ–°åçš„æœ€æ–° state çš„å€¼ï¼Œå¯ä»¥ä½œä¸ºä¾èµ– state å˜åŒ–çš„å‰¯ä½œç”¨å‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥åšä¸€äº›åŸºäº DOM çš„æ“ä½œã€‚</p>
</li>
</ul>
<pre><code class="hljs language-js"><span class="hljs-comment">/* ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºfunctionç±»å‹ */</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>(<span class="hljs-function">(<span class="hljs-params">state,props</span>)=></span>{
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">number</span>:<span class="hljs-number">1</span> } 
})
<span class="hljs-comment">/* ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºobjectç±»å‹ */</span>
<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>) <span class="hljs-comment">//è·å–æœ€æ–°çš„number</span>
})
</code></pre>
<p>å‡å¦‚ä¸€æ¬¡äº‹ä»¶ä¸­è§¦å‘ä¸€æ¬¡å¦‚ä¸Š setState ï¼Œåœ¨ React åº•å±‚ä¸»è¦åšäº†é‚£äº›äº‹å‘¢ï¼Ÿ</p>
<ul>
<li>é¦–å…ˆï¼ŒsetState ä¼šäº§ç”Ÿå½“å‰æ›´æ–°çš„ä¼˜å…ˆçº§ï¼ˆè€ç‰ˆæœ¬ç”¨ expirationTime ï¼Œæ–°ç‰ˆæœ¬ç”¨ lane ï¼‰ã€‚</li>
<li>æ¥ä¸‹æ¥ React ä¼šä» fiber Root æ ¹éƒ¨ fiber å‘ä¸‹è°ƒå’Œå­èŠ‚ç‚¹ï¼Œè°ƒå’Œé˜¶æ®µå°†å¯¹æ¯”å‘ç”Ÿæ›´æ–°çš„åœ°æ–¹ï¼Œæ›´æ–°å¯¹æ¯” expirationTime ï¼Œæ‰¾åˆ°å‘ç”Ÿæ›´æ–°çš„ç»„ä»¶ï¼Œåˆå¹¶ stateï¼Œç„¶åè§¦å‘ render å‡½æ•°ï¼Œå¾—åˆ°æ–°çš„ UI è§†å›¾å±‚ï¼Œå®Œæˆ render é˜¶æ®µã€‚</li>
<li>æ¥ä¸‹æ¥åˆ° commit é˜¶æ®µï¼Œcommit é˜¶æ®µï¼Œæ›¿æ¢çœŸå® DOM ï¼Œå®Œæˆæ­¤æ¬¡æ›´æ–°æµç¨‹ã€‚</li>
<li>æ­¤æ—¶ä»ç„¶åœ¨ commit é˜¶æ®µï¼Œä¼šæ‰§è¡Œ setState ä¸­ callback å‡½æ•°,å¦‚ä¸Šçš„<code>()=>{ console.log(this.state.number)  }</code>ï¼Œåˆ°æ­¤ä¸ºæ­¢å®Œæˆäº†ä¸€æ¬¡ setState å…¨è¿‡ç¨‹ã€‚</li>
</ul>
<p><strong>æ›´æ–°çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</strong></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d5e25a4ed464547bdd0e7c3a44d0ccc~tplv-k3u1fbpfcp-watermark.image" alt="02.jpg"></p>
<p>è¯·è®°ä½ä¸€ä¸ªä¸»è¦ä»»åŠ¡çš„å…ˆåé¡ºåºï¼Œè¿™å¯¹äºå¼„æ¸…æ¸²æŸ“è¿‡ç¨‹å¯èƒ½ä¼šæœ‰å¸®åŠ©ï¼š<br>
render é˜¶æ®µ render å‡½æ•°æ‰§è¡Œ ->  commit é˜¶æ®µçœŸå® DOM æ›¿æ¢ -> setState å›è°ƒå‡½æ•°æ‰§è¡Œ callback ã€‚</p>
<p><strong>ç±»ç»„ä»¶å¦‚ä½•é™åˆ¶ state æ›´æ–°è§†å›¾</strong></p>
<p>å¯¹äºç±»ç»„ä»¶å¦‚ä½•é™åˆ¶ state å¸¦æ¥çš„æ›´æ–°ä½œç”¨çš„å‘¢ï¼Ÿ</p>
<ul>
<li>â‘  pureComponent å¯ä»¥å¯¹ state å’Œ props è¿›è¡Œæµ…æ¯”è¾ƒï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆç»„ä»¶ä¸æ›´æ–°ã€‚</li>
<li>â‘¡ shouldComponentUpdate ç”Ÿå‘½å‘¨æœŸå¯ä»¥é€šè¿‡åˆ¤æ–­å‰å state å˜åŒ–æ¥å†³å®šç»„ä»¶éœ€ä¸éœ€è¦æ›´æ–°ï¼Œéœ€è¦æ›´æ–°è¿”å›trueï¼Œå¦åˆ™è¿”å›falseã€‚</li>
</ul>
<h3>setStateåŸç†æ­ç§˜</h3>
<p>çŸ¥å…¶ç„¶ï¼ŒçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œæƒ³è¦åƒé€ setStateï¼Œå°±éœ€è¦æŒæ¡ä¸€äº› setState çš„åº•å±‚é€»è¾‘ã€‚ ä¸Šä¸€ç« èŠ‚è®²åˆ°å¯¹äºç±»ç»„ä»¶ï¼Œç±»ç»„ä»¶åˆå§‹åŒ–è¿‡ç¨‹ä¸­ç»‘å®šäº†è´Ÿè´£æ›´æ–°çš„<code>Updater</code>å¯¹è±¡ï¼Œå¯¹äºå¦‚æœè°ƒç”¨ setState æ–¹æ³•ï¼Œå®é™…ä¸Šæ˜¯ React åº•å±‚è°ƒç”¨ Updater å¯¹è±¡ä¸Šçš„ enqueueSetState æ–¹æ³•ã€‚</p>
<p>å› ä¸ºè¦å¼„æ˜ç™½ state æ›´æ–°æœºåˆ¶ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥è¦ä»ä¸¤ä¸ªæ–¹å‘åˆ†æã€‚</p>
<ul>
<li>ä¸€æ˜¯æ­ç§˜ enqueueSetState åˆ°åº•åšäº†äº›ä»€ä¹ˆï¼Ÿ</li>
<li>äºŒæ˜¯ React åº•å±‚æ˜¯å¦‚ä½•è¿›è¡Œæ‰¹é‡æ›´æ–°çš„ï¼Ÿ</li>
</ul>
<p>é¦–å…ˆï¼Œè¿™é‡Œæè‡´ç²¾ç®€äº†ä¸€æ³¢ enqueueSetState ä»£ç ã€‚å¦‚ä¸‹</p>
<blockquote>
<p>react-reconciler/src/ReactFiberClassComponent.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-title function_">enqueueSetState</span>(<span class="hljs-params"></span>){
     <span class="hljs-comment">/* æ¯ä¸€æ¬¡è°ƒç”¨`setState`ï¼Œreact éƒ½ä¼šåˆ›å»ºä¸€ä¸ª update é‡Œé¢ä¿å­˜äº† */</span>
     <span class="hljs-keyword">const</span> update = <span class="hljs-title function_">createUpdate</span>(expirationTime, suspenseConfig);
     <span class="hljs-comment">/* callback å¯ä»¥ç†è§£ä¸º setState å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•° */</span>
     callback &#x26;&#x26; (update.<span class="hljs-property">callback</span> = callback) 
     <span class="hljs-comment">/* enqueueUpdate æŠŠå½“å‰çš„update ä¼ å…¥å½“å‰fiberï¼Œå¾…æ›´æ–°é˜Ÿåˆ—ä¸­ */</span>
     <span class="hljs-title function_">enqueueUpdate</span>(fiber, update); 
     <span class="hljs-comment">/* å¼€å§‹è°ƒåº¦æ›´æ–° */</span>
     <span class="hljs-title function_">scheduleUpdateOnFiber</span>(fiber, expirationTime);
}
</code></pre>
<p><strong>enqueueSetState</strong> ä½œç”¨å®é™…å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ›å»ºä¸€ä¸ª update ï¼Œç„¶åæ”¾å…¥å½“å‰ fiber å¯¹è±¡çš„å¾…æ›´æ–°é˜Ÿåˆ—ä¸­ï¼Œæœ€åå¼€å¯è°ƒåº¦æ›´æ–°ï¼Œè¿›å…¥ä¸Šè¿°è®²åˆ°çš„æ›´æ–°æµç¨‹ã€‚</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼ŒReact çš„ batchUpdate æ‰¹é‡æ›´æ–°æ˜¯ä»€ä¹ˆæ—¶å€™åŠ ä¸Šå»çš„å‘¢ï¼Ÿ</p>
<p>è¿™å°±è¦æå‰èŠä¸€ä¸‹äº‹ä»¶ç³»ç»Ÿäº†ã€‚æ­£å¸¸ <strong>state æ›´æ–°</strong>ã€<strong>UI äº¤äº’</strong>ï¼Œéƒ½ç¦»ä¸å¼€ç”¨æˆ·çš„äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»äº‹ä»¶ï¼Œè¡¨å•è¾“å…¥ç­‰ï¼ŒReact æ˜¯é‡‡ç”¨äº‹ä»¶åˆæˆçš„å½¢å¼ï¼Œæ¯ä¸€ä¸ªäº‹ä»¶éƒ½æ˜¯ç”± React äº‹ä»¶ç³»ç»Ÿç»Ÿä¸€è°ƒåº¦çš„ï¼Œé‚£ä¹ˆ State æ‰¹é‡æ›´æ–°æ­£æ˜¯å’Œäº‹ä»¶ç³»ç»Ÿæ¯æ¯ç›¸å…³çš„ã€‚</p>
<blockquote>
<p>react-dom/src/events/DOMLegacyEventPluginSystem.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-comment">/* åœ¨`legacy`æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„äº‹ä»¶éƒ½å°†ç»è¿‡æ­¤å‡½æ•°åŒä¸€å¤„ç† */</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">dispatchEventForLegacyPluginEventSystem</span>(<span class="hljs-params"></span>){
    <span class="hljs-comment">// handleTopLevel äº‹ä»¶å¤„ç†å‡½æ•°</span>
    <span class="hljs-title function_">batchedEventUpdates</span>(handleTopLevel, bookKeeping);
}
</code></pre>
<p>é‡ç‚¹æ¥äº†ï¼Œå°±æ˜¯ä¸‹é¢è¿™ä¸ª batchedEventUpdates æ–¹æ³•ã€‚</p>
<blockquote>
<p>react-dom/src/events/ReactDOMUpdateBatching.js</p>
</blockquote>
<pre><code class="hljs language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">batchedEventUpdates</span>(<span class="hljs-params">fn,a</span>){
    <span class="hljs-comment">/* å¼€å¯æ‰¹é‡æ›´æ–°  */</span>
   isBatchingEventUpdates = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">try</span> {
    <span class="hljs-comment">/* è¿™é‡Œæ‰§è¡Œäº†çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œ æ¯”å¦‚åœ¨ä¸€æ¬¡ç‚¹å‡»äº‹ä»¶ä¸­è§¦å‘setState,é‚£ä¹ˆå®ƒå°†åœ¨è¿™ä¸ªå‡½æ•°å†…æ‰§è¡Œ */</span>
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">batchedEventUpdatesImpl</span>(fn, a, b);
  } <span class="hljs-keyword">finally</span> {
    <span class="hljs-comment">/* try é‡Œé¢ return ä¸ä¼šå½±å“ finally æ‰§è¡Œ  */</span>
    <span class="hljs-comment">/* å®Œæˆä¸€æ¬¡äº‹ä»¶ï¼Œæ‰¹é‡æ›´æ–°  */</span>
    isBatchingEventUpdates = <span class="hljs-literal">false</span>;
  }
}
</code></pre>
<p>å¦‚ä¸Šå¯ä»¥åˆ†æå‡ºæµç¨‹ï¼Œåœ¨ React äº‹ä»¶æ‰§è¡Œä¹‹å‰é€šè¿‡ <code>isBatchingEventUpdates=true</code> æ‰“å¼€å¼€å…³ï¼Œå¼€å¯äº‹ä»¶æ‰¹é‡æ›´æ–°ï¼Œå½“è¯¥äº‹ä»¶ç»“æŸï¼Œå†é€šè¿‡ <code>isBatchingEventUpdates = false;</code> å…³é—­å¼€å…³ï¼Œç„¶ååœ¨ scheduleUpdateOnFiber ä¸­æ ¹æ®è¿™ä¸ªå¼€å…³æ¥ç¡®å®šæ˜¯å¦è¿›è¡Œæ‰¹é‡æ›´æ–°ã€‚</p>
<p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¦‚ä¸‹ç»„ä»¶ä¸­è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">index</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">React.Component</span>{
    state = { <span class="hljs-attr">number</span>:<span class="hljs-number">0</span> }
    handleClick= <span class="hljs-function">() =></span> {
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-string">'callback1'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)  })
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-string">'callback2'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)  })
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-string">'callback3'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)  })
          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
    }
    <span class="hljs-title function_">render</span>(<span class="hljs-params"></span>){
        <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>
            { this.state.number }
            <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{</span> <span class="hljs-attr">this.handleClick</span> }  ></span>number++<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
        <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
    }
} 
</code></pre>
<p>ç‚¹å‡»æ‰“å°ï¼š<strong>0, 0, 0, callback1 1 ,callback2 1 ,callback3 1</strong></p>
<p>å¦‚ä¸Šä»£ç ï¼Œåœ¨æ•´ä¸ª React ä¸Šä¸‹æ–‡æ‰§è¡Œæ ˆä¸­ä¼šå˜æˆè¿™æ ·ï¼š</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/478aef991b4146c898095b83fe3dc0e7~tplv-k3u1fbpfcp-watermark.image" alt="03.jpg"></p>
<p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå¼‚æ­¥æ“ä½œé‡Œé¢çš„æ‰¹é‡æ›´æ–°è§„åˆ™ä¼šè¢«æ‰“ç ´å‘¢ï¼Ÿæ¯”å¦‚ç”¨ promise æˆ–è€… setTimeout åœ¨ handleClick ä¸­è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=></span>{
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-string">'callback1'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)  })
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-string">'callback2'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)  })
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> },<span class="hljs-function">()=></span>{   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-string">'callback3'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)  })
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
})
</code></pre>
<p>æ‰“å° ï¼š <strong>callback1 1  ,  1, callback2 2 , 2,callback3 3  , 3</strong> <br></p>
<p>é‚£ä¹ˆåœ¨æ•´ä¸ª React ä¸Šä¸‹æ–‡æ‰§è¡Œæ ˆä¸­å°±ä¼šå˜æˆå¦‚ä¸‹å›¾è¿™æ ·:</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48e730fc687c4ce087e5c0eab2832273~tplv-k3u1fbpfcp-watermark.image" alt="04.jpg"></p>
<p><strong>æ‰€ä»¥æ‰¹é‡æ›´æ–°è§„åˆ™è¢«æ‰“ç ´</strong>ã€‚</p>
<p><strong>é‚£ä¹ˆï¼Œå¦‚ä½•åœ¨å¦‚ä¸Šå¼‚æ­¥ç¯å¢ƒä¸‹ï¼Œç»§ç»­å¼€å¯æ‰¹é‡æ›´æ–°æ¨¡å¼å‘¢ï¼Ÿ</strong></p>
<p>React-Dom ä¸­æä¾›äº†æ‰¹é‡æ›´æ–°æ–¹æ³• <code>unstable_batchedUpdates</code>ï¼Œå¯ä»¥å»æ‰‹åŠ¨æ‰¹é‡æ›´æ–°ï¼Œå¯ä»¥å°†ä¸Šè¿° setTimeout é‡Œé¢çš„å†…å®¹åšå¦‚ä¸‹ä¿®æ”¹:</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">ReactDOM</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'react-dom'</span>
<span class="hljs-keyword">const</span> { unstable_batchedUpdates } = <span class="hljs-title class_">ReactDOM</span>
</code></pre>
<pre><code class="hljs language-js">
<span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=></span>{
    <span class="hljs-title function_">unstable_batchedUpdates</span>(<span class="hljs-function">()=></span>{
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> })
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span>})
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span> + <span class="hljs-number">1</span> })
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>) 
    })
})
</code></pre>
<p>æ‰“å°ï¼š <strong>0 , 0 , 0 , callback1 1 , callback2 1 ,callback3 1</strong></p>
<p>åœ¨å®é™…å·¥ä½œä¸­ï¼Œunstable_batchedUpdates å¯ä»¥ç”¨äº Ajax æ•°æ®äº¤äº’ä¹‹åï¼Œåˆå¹¶å¤šæ¬¡ setStateï¼Œæˆ–è€…æ˜¯å¤šæ¬¡ useState ã€‚åŸå› å¾ˆç®€å•ï¼Œæ‰€æœ‰çš„æ•°æ®äº¤äº’éƒ½æ˜¯åœ¨å¼‚æ­¥ç¯å¢ƒä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ‰¹é‡æ›´æ–°å¤„ç†ï¼Œä¸€æ¬¡æ•°æ®äº¤äº’å¤šæ¬¡æ”¹å˜ state ä¼šä¿ƒä½¿è§†å›¾å¤šæ¬¡æ¸²æŸ“ã€‚</p>
<p><strong>é‚£ä¹ˆå¦‚ä½•æå‡æ›´æ–°ä¼˜å…ˆçº§å‘¢ï¼Ÿ</strong></p>
<p>React-dom æä¾›äº† flushSync ï¼ŒflushSync å¯ä»¥å°†å›è°ƒå‡½æ•°ä¸­çš„æ›´æ–°ä»»åŠ¡ï¼Œæ”¾åœ¨ä¸€ä¸ªè¾ƒé«˜çš„ä¼˜å…ˆçº§ä¸­ã€‚React è®¾å®šäº†å¾ˆå¤šä¸åŒä¼˜å…ˆçº§çš„æ›´æ–°ä»»åŠ¡ã€‚å¦‚æœä¸€æ¬¡æ›´æ–°ä»»åŠ¡åœ¨ flushSync å›è°ƒå‡½æ•°å†…éƒ¨ï¼Œé‚£ä¹ˆå°†è·å¾—ä¸€ä¸ªè¾ƒé«˜ä¼˜å…ˆçº§çš„æ›´æ–°ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå°†ä¸Šè¿° <code>handleClick</code> æ”¹ç‰ˆå¦‚ä¸‹æ ·å­ï¼š</p>
<pre><code class="hljs language-js">handerClick=<span class="hljs-function">()=></span>{
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=></span>{
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>: <span class="hljs-number">1</span>  })
    })
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>: <span class="hljs-number">2</span>  })
    <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">flushSync</span>(<span class="hljs-function">()=></span>{
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>: <span class="hljs-number">3</span>  })
    })
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setState</span>({ <span class="hljs-attr">number</span>: <span class="hljs-number">4</span>  })
}
<span class="hljs-title function_">render</span>(<span class="hljs-params"></span>){
   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">state</span>.<span class="hljs-property">number</span>)
   <span class="hljs-keyword">return</span> ...
}
</code></pre>
<p>æ‰“å° <strong>3 4 1</strong> ï¼Œç›¸ä¿¡ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆè¿™ä¹ˆæ‰“å°äº†ã€‚</p>
<ul>
<li>é¦–å…ˆ <code>flushSync</code> <code>this.setState({ number: 3  })</code>è®¾å®šäº†ä¸€ä¸ªé«˜ä¼˜å…ˆçº§çš„æ›´æ–°ï¼Œæ‰€ä»¥ 2 å’Œ 3 è¢«æ‰¹é‡æ›´æ–°åˆ° 3 ï¼Œæ‰€ä»¥ 3 å…ˆè¢«æ‰“å°ã€‚</li>
<li>æ›´æ–°ä¸º 4ã€‚</li>
<li>æœ€åæ›´æ–° setTimeout ä¸­çš„ number = 1ã€‚</li>
</ul>
<p><strong>flushSyncè¡¥å……è¯´æ˜</strong>ï¼šflushSync åœ¨åŒæ­¥æ¡ä»¶ä¸‹ï¼Œä¼šåˆå¹¶ä¹‹å‰çš„ setState | useStateï¼Œå¯ä»¥ç†è§£æˆï¼Œå¦‚æœå‘ç°äº† flushSync ï¼Œå°±ä¼šå…ˆæ‰§è¡Œæ›´æ–°ï¼Œå¦‚æœä¹‹å‰æœ‰æœªæ›´æ–°çš„ setState ï½œ useState ï¼Œå°±ä¼šä¸€èµ·åˆå¹¶äº†ï¼Œæ‰€ä»¥å°±è§£é‡Šäº†å¦‚ä¸Šï¼Œ2 å’Œ 3 è¢«æ‰¹é‡æ›´æ–°åˆ° 3 ï¼Œæ‰€ä»¥ 3 å…ˆè¢«æ‰“å°ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ React åŒä¸€çº§åˆ«<strong>æ›´æ–°ä¼˜å…ˆçº§</strong>å…³ç³»æ˜¯:</p>
<p>flushSync ä¸­çš„ setState <strong>></strong> æ­£å¸¸æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ setState <strong>></strong> setTimeout ï¼ŒPromise ä¸­çš„ setStateã€‚</p>
<h2>ä¸‰ å‡½æ•°ç»„ä»¶ä¸­çš„state</h2>
<p>React-hooks æ­£å¼å‘å¸ƒä»¥åï¼Œ useState å¯ä»¥ä½¿å‡½æ•°ç»„ä»¶åƒç±»ç»„ä»¶ä¸€æ ·æ‹¥æœ‰ stateï¼Œä¹Ÿå°±è¯´æ˜å‡½æ•°ç»„ä»¶å¯ä»¥é€šè¿‡ useState æ”¹å˜ UI è§†å›¾ã€‚é‚£ä¹ˆ useState åˆ°åº•åº”è¯¥å¦‚ä½•ä½¿ç”¨ï¼Œåº•å±‚åˆæ˜¯æ€ä¹ˆè¿ä½œçš„å‘¢ï¼Œé¦–å…ˆä¸€èµ·çœ‹ä¸€ä¸‹ useState ã€‚</p>
<h3>useStateç”¨æ³•</h3>
<p><strong>åŸºæœ¬ç”¨æ³•</strong></p>
<pre><code class="hljs language-js"> [ â‘ state , â‘¡dispatch ] = <span class="hljs-title function_">useState</span>(â‘¢initData)
</code></pre>
<ul>
<li>â‘  stateï¼Œç›®çš„æä¾›ç»™ UI ï¼Œä½œä¸ºæ¸²æŸ“è§†å›¾çš„æ•°æ®æºã€‚</li>
<li>â‘¡ dispatch æ”¹å˜ state çš„å‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºæ¨åŠ¨å‡½æ•°ç»„ä»¶æ¸²æŸ“çš„æ¸²æŸ“å‡½æ•°ã€‚</li>
<li>â‘¢ initData æœ‰ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æƒ…å†µæ˜¯éå‡½æ•°ï¼Œå°†ä½œä¸º state åˆå§‹åŒ–çš„å€¼ã€‚ ç¬¬äºŒç§æƒ…å†µæ˜¯å‡½æ•°ï¼Œå‡½æ•°çš„è¿”å›å€¼ä½œä¸º useState åˆå§‹åŒ–çš„å€¼ã€‚</li>
</ul>
<p>initData  ä¸ºéå‡½æ•°çš„æƒ…å†µ:</p>
<pre><code class="hljs language-js"><span class="hljs-comment">/* æ­¤æ—¶å°†æŠŠ 0 ä½œä¸ºåˆä½¿å€¼ */</span>
<span class="hljs-keyword">const</span> [ number , setNumber ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
</code></pre>
<p>initData ä¸ºå‡½æ•°çš„æƒ…å†µ:</p>
<pre><code class="hljs language-js"> <span class="hljs-keyword">const</span> [ number , setNumber ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-function">()=></span>{
       <span class="hljs-comment">/*  props ä¸­ a = 1 state ä¸º 0-1 éšæœºæ•° ï¼Œ a = 2 state ä¸º 1 -10éšæœºæ•° ï¼Œ å¦åˆ™ï¼Œstate ä¸º 1 - 100 éšæœºæ•°   */</span>
       <span class="hljs-keyword">if</span>(props.<span class="hljs-property">a</span> === <span class="hljs-number">1</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() 
       <span class="hljs-keyword">if</span>(props.<span class="hljs-property">a</span> === <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">10</span> )
       <span class="hljs-keyword">return</span> <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">ceil</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span> ) 
    })
</code></pre>
<p>å¯¹äº dispatchçš„å‚æ•°,ä¹Ÿæœ‰ä¸¤ç§æƒ…å†µï¼š</p>
<ul>
<li>
<p>ç¬¬ä¸€ç§éå‡½æ•°æƒ…å†µï¼Œæ­¤æ—¶å°†ä½œä¸ºæ–°çš„å€¼ï¼Œèµ‹äºˆç»™ stateï¼Œä½œä¸ºä¸‹ä¸€æ¬¡æ¸²æŸ“ä½¿ç”¨;</p>
</li>
<li>
<p>ç¬¬äºŒç§æ˜¯å‡½æ•°çš„æƒ…å†µï¼Œå¦‚æœ dispatch çš„å‚æ•°ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™é‡Œå¯ä»¥ç§°å®ƒä¸ºreducerï¼Œreducer å‚æ•°ï¼Œæ˜¯ä¸Šä¸€æ¬¡è¿”å›æœ€æ–°çš„ stateï¼Œè¿”å›å€¼ä½œä¸ºæ–°çš„ stateã€‚<br></p>
</li>
</ul>
<p><strong>dispatch å‚æ•°æ˜¯ä¸€ä¸ªéå‡½æ•°å€¼</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> [ number , setNumber ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
<span class="hljs-comment">/* ä¸€ä¸ªç‚¹å‡»äº‹ä»¶ */</span>
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span>=(<span class="hljs-params"></span>)=>{
   <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">1</span>)
   <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">2</span>)
   <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">3</span>)
}
</code></pre>
<p><strong>dispatch å‚æ•°æ˜¯ä¸€ä¸ªå‡½æ•°</strong></p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> [ number , setNumber ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span>=(<span class="hljs-params"></span>)=>{
   <span class="hljs-title function_">setNumber</span>(<span class="hljs-function">(<span class="hljs-params">state</span>)=></span> state + <span class="hljs-number">1</span>)  <span class="hljs-comment">// state - > 0 + 1 = 1</span>
   <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">8</span>)  <span class="hljs-comment">// state - > 8</span>
   <span class="hljs-title function_">setNumber</span>(<span class="hljs-function">(<span class="hljs-params">state</span>)=></span> state + <span class="hljs-number">1</span>)  <span class="hljs-comment">// state - > 8 + 1 = 9</span>
}
</code></pre>
<p><strong>å¦‚ä½•ç›‘å¬ state å˜åŒ–ï¼Ÿ</strong></p>
<p>ç±»ç»„ä»¶ setState ä¸­ï¼Œæœ‰ç¬¬äºŒä¸ªå‚æ•° callback æˆ–è€…æ˜¯ç”Ÿå‘½å‘¨æœŸcomponentDidUpdate å¯ä»¥æ£€æµ‹ç›‘å¬åˆ° state æ”¹å˜æˆ–æ˜¯ç»„ä»¶æ›´æ–°ã€‚</p>
<p>é‚£ä¹ˆåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå¦‚ä½•æ€ä¹ˆç›‘å¬ state å˜åŒ–å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦ useEffect å‡ºåœºäº†ï¼Œé€šå¸¸å¯ä»¥æŠŠ state ä½œä¸ºä¾èµ–é¡¹ä¼ å…¥ useEffect ç¬¬äºŒä¸ªå‚æ•° deps ï¼Œä½†æ˜¯æ³¨æ„ useEffect åˆå§‹åŒ–ä¼šé»˜è®¤æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p>å…·ä½“å¯ä»¥å‚è€ƒå¦‚ä¸‹ Demo :</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Index</span>(<span class="hljs-params">props</span>){
    <span class="hljs-keyword">const</span> [ number , setNumber ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
    <span class="hljs-comment">/* ç›‘å¬ number å˜åŒ– */</span>
    <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useEffect</span>(<span class="hljs-function">()=></span>{
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'ç›‘å¬numberå˜åŒ–ï¼Œæ­¤æ—¶çš„numberæ˜¯:  '</span> + number )
    },[ number ])
    <span class="hljs-keyword">const</span> <span class="hljs-title function_">handerClick</span> = (<span class="hljs-params"></span>)=>{
        <span class="hljs-comment">/** é«˜ä¼˜å…ˆçº§æ›´æ–° **/</span>
        <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">flushSync</span>(<span class="hljs-function">()=></span>{
            <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">2</span>) 
        })
        <span class="hljs-comment">/* æ‰¹é‡æ›´æ–° */</span>
        <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">1</span>) 
        <span class="hljs-comment">/* æ»åæ›´æ–° ï¼Œæ‰¹é‡æ›´æ–°è§„åˆ™è¢«æ‰“ç ´ */</span>
        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=></span>{
            <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">3</span>) 
        })
       
    }
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number)
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>
        <span class="hljs-tag">&#x3C;<span class="hljs-name">span</span>></span> { number }<span class="hljs-tag">&#x3C;/<span class="hljs-name">span</span>></span>
        <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{</span> <span class="hljs-attr">handerClick</span> }  ></span>number++<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
}
</code></pre>
<p>æ•ˆæœ:</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ac7c4b4be454d6b937b1da56eab8984~tplv-k3u1fbpfcp-watermark.image" alt="01.jpg"></p>
<p><strong><code>dispatch</code>æ›´æ–°ç‰¹ç‚¹</strong></p>
<p>ä¸Šè¿°è®²çš„æ‰¹é‡æ›´æ–°å’Œ flushSync ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œdispatch æ›´æ–°æ•ˆæœå’Œç±»ç»„ä»¶æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ useState æœ‰ä¸€ç‚¹å€¼å¾—æ³¨æ„ï¼Œå°±æ˜¯å½“è°ƒç”¨æ”¹å˜ state çš„å‡½æ•°dispatchï¼Œåœ¨æœ¬æ¬¡å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œæ˜¯è·å–ä¸åˆ°æœ€æ–°çš„ state å€¼çš„ï¼ŒæŠŠä¸Šè¿°demo å¦‚ä¸‹è¿™ä¹ˆæ”¹ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">const</span> [ number , setNumber ] = <span class="hljs-title class_">React</span>.<span class="hljs-title function_">useState</span>(<span class="hljs-number">0</span>)
<span class="hljs-keyword">const</span> <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>)=>{
    <span class="hljs-title class_">ReactDOM</span>.<span class="hljs-title function_">flushSync</span>(<span class="hljs-function">()=></span>{
        <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">2</span>) 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number) 
    })
    <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">1</span>) 
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number)
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">()=></span>{
        <span class="hljs-title function_">setNumber</span>(<span class="hljs-number">3</span>) 
        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(number)
    })   
}
</code></pre>
<p><strong>ç»“æœï¼š 0 0 0</strong></p>
<p>åŸå› å¾ˆç®€å•ï¼Œå‡½æ•°ç»„ä»¶æ›´æ–°å°±æ˜¯å‡½æ•°çš„æ‰§è¡Œï¼Œåœ¨å‡½æ•°ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå‡½æ•°å†…éƒ¨æ‰€æœ‰å˜é‡é‡æ–°å£°æ˜ï¼Œæ‰€ä»¥æ”¹å˜çš„ state ï¼Œåªæœ‰åœ¨ä¸‹ä¸€æ¬¡å‡½æ•°ç»„ä»¶æ‰§è¡Œæ—¶æ‰ä¼šè¢«æ›´æ–°ã€‚æ‰€ä»¥åœ¨å¦‚ä¸ŠåŒä¸€ä¸ªå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ï¼Œnumber ä¸€ç›´ä¸º0ï¼Œæ— è®ºæ€ä¹ˆæ‰“å°ï¼Œéƒ½æ‹¿ä¸åˆ°æœ€æ–°çš„ state ã€‚</p>
<p><strong>useStateæ³¨æ„äº‹é¡¹</strong></p>
<p>åœ¨ä½¿ç”¨ useState çš„ dispatchAction æ›´æ–° state çš„æ—¶å€™ï¼Œè®°å¾—ä¸è¦ä¼ å…¥ç›¸åŒçš„ stateï¼Œè¿™æ ·ä¼šä½¿è§†å›¾ä¸æ›´æ–°ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¹ˆå†™ï¼š</p>
<pre><code class="hljs language-js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Index</span>(<span class="hljs-params"></span>){
    <span class="hljs-keyword">const</span> [ state  , dispatchState ] = <span class="hljs-title function_">useState</span>({ <span class="hljs-attr">name</span>:<span class="hljs-string">'alien'</span> })
    <span class="hljs-keyword">const</span>  <span class="hljs-title function_">handleClick</span> = (<span class="hljs-params"></span>)=>{ <span class="hljs-comment">// ç‚¹å‡»æŒ‰é’®ï¼Œè§†å›¾æ²¡æœ‰æ›´æ–°ã€‚</span>
        state.<span class="hljs-property">name</span> = <span class="hljs-string">'Alien'</span>
        <span class="hljs-title function_">dispatchState</span>(state) <span class="hljs-comment">// ç›´æ¥æ”¹å˜ `state`ï¼Œåœ¨å†…å­˜ä¸­æŒ‡å‘çš„åœ°å€ç›¸åŒã€‚</span>
    }
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&#x3C;<span class="hljs-name">div</span>></span>
         <span class="hljs-tag">&#x3C;<span class="hljs-name">span</span>></span> { state.name }<span class="hljs-tag">&#x3C;/<span class="hljs-name">span</span>></span>
        <span class="hljs-tag">&#x3C;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{</span> <span class="hljs-attr">handleClick</span> }  ></span>changeName++<span class="hljs-tag">&#x3C;/<span class="hljs-name">button</span>></span>
    <span class="hljs-tag">&#x3C;/<span class="hljs-name">div</span>></span></span>
}
</code></pre>
<p>å¦‚ä¸Šä¾‹å­ğŸŒ°ä¸­ï¼Œå½“ç‚¹å‡»æŒ‰é’®åï¼Œå‘ç°è§†å›¾æ²¡æœ‰æ”¹å˜ï¼Œä¸ºä»€ä¹ˆä¼šé€ æˆè¿™ä¸ªåŸå› å‘¢ï¼Ÿ</p>
<p>åœ¨ useState çš„ dispatchAction å¤„ç†é€»è¾‘ä¸­ï¼Œä¼šæµ…æ¯”è¾ƒä¸¤æ¬¡ state ï¼Œå‘ç° state ç›¸åŒï¼Œä¸ä¼šå¼€å¯æ›´æ–°è°ƒåº¦ä»»åŠ¡ï¼› demo ä¸­ä¸¤æ¬¡   state æŒ‡å‘äº†ç›¸åŒçš„å†…å­˜ç©ºé—´ï¼Œæ‰€ä»¥é»˜è®¤ä¸º state ç›¸ç­‰ï¼Œå°±ä¸ä¼šå‘ç”Ÿè§†å›¾æ›´æ–°äº†ã€‚</p>
<p>è§£å†³é—®é¢˜ï¼š æŠŠä¸Šè¿°çš„ dispatchState æ”¹æˆ dispatchState({...state}) æ ¹æœ¬è§£å†³äº†é—®é¢˜ï¼Œæµ…æ‹·è´äº†å¯¹è±¡ï¼Œé‡æ–°ç”³è¯·äº†ä¸€ä¸ªå†…å­˜ç©ºé—´ã€‚</p>
<h3>useStateåŸç†æ­ç§˜</h3>
<p>å¯¹äº useState åŸç†ï¼Œåé¢ä¼šæœ‰ç‹¬ç«‹çš„ç¯‡ç« ä»‹ç»ï¼Œè¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p>
<p><strong>ï½œ--------é—®ä¸ç­”---------ï½œ</strong><br></p>
<p>ç±»ç»„ä»¶ä¸­çš„ <code>setState</code> å’Œå‡½æ•°ç»„ä»¶ä¸­çš„ <code>useState</code> æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ
<strong>ç›¸åŒç‚¹ï¼š</strong></p>
<ul>
<li>é¦–å…ˆä»åŸç†è§’åº¦å‡ºå‘ï¼ŒsetStateå’Œ useState æ›´æ–°è§†å›¾ï¼Œåº•å±‚éƒ½è°ƒç”¨äº† scheduleUpdateOnFiber æ–¹æ³•ï¼Œè€Œä¸”äº‹ä»¶é©±åŠ¨æƒ…å†µä¸‹éƒ½æœ‰æ‰¹é‡æ›´æ–°è§„åˆ™ã€‚</li>
</ul>
<p><strong>ä¸åŒç‚¹</strong></p>
<ul>
<li>
<p>åœ¨ä¸æ˜¯ pureComponent ç»„ä»¶æ¨¡å¼ä¸‹ï¼Œ setState ä¸ä¼šæµ…æ¯”è¾ƒä¸¤æ¬¡ state çš„å€¼ï¼Œåªè¦è°ƒç”¨ setStateï¼Œåœ¨æ²¡æœ‰å…¶ä»–ä¼˜åŒ–æ‰‹æ®µçš„å‰æä¸‹ï¼Œå°±ä¼šæ‰§è¡Œæ›´æ–°ã€‚ä½†æ˜¯ useState ä¸­çš„ dispatchAction ä¼šé»˜è®¤æ¯”è¾ƒä¸¤æ¬¡ state æ˜¯å¦ç›¸åŒï¼Œç„¶åå†³å®šæ˜¯å¦æ›´æ–°ç»„ä»¶ã€‚</p>
</li>
<li>
<p>setState æœ‰ä¸“é—¨ç›‘å¬ state å˜åŒ–çš„å›è°ƒå‡½æ•° callbackï¼Œå¯ä»¥è·å–æœ€æ–°stateï¼›ä½†æ˜¯åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œåªèƒ½é€šè¿‡ useEffect æ¥æ‰§è¡Œ state å˜åŒ–å¼•èµ·çš„å‰¯ä½œç”¨ã€‚</p>
</li>
<li>
<p>setState åœ¨åº•å±‚å¤„ç†é€»è¾‘ä¸Šä¸»è¦æ˜¯å’Œè€ state è¿›è¡Œåˆå¹¶å¤„ç†ï¼Œè€Œ useState æ›´å€¾å‘äºé‡æ–°èµ‹å€¼ã€‚</p>
</li>
</ul>
<p><strong>ï½œ--------end---------ï½œ</strong><br></p>
<h2>å›› æ€»ç»“</h2>
<p>ä»æœ¬ç« èŠ‚å­¦åˆ°äº†å“ªäº›çŸ¥è¯†ï¼š</p>
<ul>
<li>1 setStateç”¨æ³•è¯¦è§£ï¼Œåº•å±‚æ›´æ–°æµç¨‹ã€‚</li>
<li>2 useStateç”¨æ³•è¯¦è§£ï¼Œæ³¨æ„äº‹é¡¹ã€‚</li>
<li>3 å‡ ç§ä¸åŒä¼˜å…ˆçº§çš„æ›´æ–°ä»»åŠ¡ã€‚</li>
</ul></div>
</body></html>