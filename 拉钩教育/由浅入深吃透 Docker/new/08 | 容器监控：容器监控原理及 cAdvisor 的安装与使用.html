<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>08 | 容器监控：容器监控原理及 cAdvisor 的安装与使用</title>
<style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style><style type="text/css">/*
 * Copyright (C) 2018 Drake, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

:root {
    --monospace: "JetBrains Mono", HYZhengYuan, "Fira Code", Menlo, "Ubuntu Mono", Consolas; /*code font*/
    --text-font: var(--monospace); /*default font*/
    --title-font: var(--monospace); /*title font*/

    --text-color: #333333;
    --bg-color: #ffffff;
    --control-text-color: var(--text-color);
    --meta-content-color: var(--text-color);
    --active-file-border-color: var(--drake-accent);
    --rawblock-edit-panel-bd: var(--code-block-bg-color);
    --item-hover-bg-color: #E5E5E596;
    --active-file-bg-color: var(--item-hover-bg-color);

    --drake-accent: #e95f59;
    --drake-highlight: #d63200;
    --a-color: #036aca;
    --variable-color: var(--drake-highlight);
    --outline-active-color: var(--a-color);
    --code-block-bg-color: #2b2b2b;
    --code-block-color: #A9B7C6;
    --title-color: #135ce0;
    --blockquote-border-color: #b2aec5;
    --blockquote-color: #595959;
    --blockquote-bg-color: #fff9f9;
    --strong-color: var(--title-color);
    --h2-underline-color: var(--title-color);
    --horizontal-divider-color: var(--title-color);
    --height-light-color: var(--drake-highlight);
    --height-light-border-color: var(--drake-highlight);
    --yaml-color: #777777;
    --yaml-bg-color: #f7f7f7;
    --footnotes-bg-color: #3c3d3e;
    --footnotes-highlight: #FFD760;
    --table-border-color: #dfe2e5;
    --table-header-bg-color: #f6f8fa;
    --table-bg-color: var(--bg-color);
    --table-n2-bg-color: #f6f8fa;
    --input-bg-color: var(--item-hover-bg-color);
    --btn-hover-bg-color: var(--item-hover-bg-color);
    --checkbox-checked: url("data:image/svg+xml,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M425.984 726.016l384-384-59.99-61.995-324.01 324.011-152.021-152.021L213.973 512zm384-598.016q36.01 0 61.013 25.984T896 213.974v596.01q0 34.005-25.003 59.99t-61.013 25.983h-596.01q-36.011 0-61.014-25.984t-25.003-59.989v-596.01q0-34.006 25.003-59.99T213.973 128h596.011z' fill='%2365b73b'/%3E%3C/svg%3E");
    --checkbox-unchecked: url("data:image/svg+xml,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M810.667 213.333v597.334H213.333V213.333h597.334m0-85.333H213.333C166.4 128 128 166.4 128 213.333v597.334C128 857.6 166.4 896 213.333 896h597.334C857.6 896 896 857.6 896 810.667V213.333C896 166.4 857.6 128 810.667 128z' fill='%23333333'/%3E%3C/svg%3E");
}

html {
    font-size: 15px;
}

body {
    font-family: var(--text-font) !important;
    color: var(--text-color);
    -webkit-font-feature-settings: "liga" on, "calt" on;
    -webkit-font-smoothing: subpixel-antialiased;
    text-rendering: optimizeLegibility;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
    line-height: 1.8rem;
}

img {
    max-width: 100%;
}

#write {
    background-image: linear-gradient(
            90deg
            ,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(
            1turn
            ,rgba(60,10,30,.04) 3%,transparent 0);
    background-size: 20px 20px;
    background-position: 50%;
}

/*code block*/
#write .md-fences {
    font-size: 1rem;
    padding: 0.5rem !important;
    border-radius: 2px;
    word-wrap: normal;
    background-color: var(--code-block-bg-color);
    color: var(--code-block-color);
    border: none;
}

/*code snippet*/
#write code, tt {
    border-radius: 2px;
    color: var(--drake-highlight);
}

/*variable*/
var {
    color: var(--variable-color);
    font-weight: bold;
}

/*raw block*/
.md-rawblock-control:not(.md-rawblock-tooltip) {
    border-radius: 2px 0 2px 2px;
    padding: 0.2rem !important;
}
.md-rawblock:hover > .md-rawblock-container {
    background: none;
}
.md-rawblock-input {
    font-size: 1rem;
}
.md-rawblock-tooltip-btn:hover {
    background: none;
}
.md-rawblock:hover > .md-rawblock-tooltip {
    border-radius: 2px 2px 0 0;
    margin-bottom: 2px !important;
}
.md-rawblock-tooltip.md-rawblock-control {
    border-radius: 2px 2px 0 0;
    color: var(--code-block-color);
}
.md-rawblock-tooltip-name {
    color: var(--code-block-color);
    opacity: 1;
}

/*quote block*/
blockquote:before {
    display: block;
    position: absolute;
    content: '';
    width: 4px;
    left: 0;
    top: 0;
    height: 100%;
    background-color: var(--blockquote-border-color);
    border-radius: 2px;
}

blockquote {
    color: var(--blockquote-color);
    border-radius: 2px;
    padding: 10px 16px;
    background-color: var(--blockquote-bg-color);
    position: relative;
    border-left: none;
}

#write strong {
    color: var(--strong-color);
    font-weight: bold;
}
#write blockquote strong {
    color: var(--blockquote-color);
}

/*link*/
#write a {
    color: var(--a-color);
    text-decoration: none;
}
#write a .md-plain, .md-htmlblock-container a:hover {
    border-bottom: .1rem solid var(--a-color);
}
[md-inline=link] a {
    margin: 0 .2rem;
}
a:any-link {
    color: var(--a-color);
}

img {
    border-left: none;
    border-right: none;
    vertical-align: baseline;
    border-radius: 2px;
}

#write {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px 30px 100px;
}
#typora-source .CodeMirror-lines {
    max-width: 1200px;
}

#write p {
    word-spacing: .05rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: var(--title-font);
    position: relative;
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: bold;
    cursor: text;
    color: var(--title-color);
}

h3.md-focus:before, h4.md-focus:before, h5.md-focus:before, h6.md-focus:before {
    visibility: hidden;
}

h1 {
    font-size: 1.6rem;
    text-align: center;
    margin-top: 0;
}

h2.md-end-block.md-heading {
    font-size: 1.6rem;
    display: inline-block;
}

h2.md-end-block.md-heading:after {
    display: block;
    content: '';
    height: 2px;
    margin-top: 4px;
    background-color: var(--h2-underline-color);
    border-radius: 2px;
}

h3 {
    font-size: 1.4rem;
}

h4 {
    font-size: 1.2rem;
}

h5 {
    font-size: 1rem;
}

h6 {
    font-size: 1rem;
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}

h2 tt,
h2 code {
    font-size: inherit !important;
}

h3 tt,
h3 code {
    font-size: inherit !important;
}

h4 tt,
h4 code {
    font-size: inherit !important;
}

h5 tt,
h5 code {
    font-size: inherit !important;
}

h6 tt,
h6 code {
    font-size: inherit !important;
}

blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}
p {
    margin: 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: var(--horizontal-divider-color);
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul, ol {
    padding-inline-start: 2em;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

table {
    padding: 0;
    word-break: initial;
    background-color: var(--table-bg-color);
}
table tr {
    border-top: .1em solid var(--table-border-color);
    margin: 0;
    padding: 0;
}
table th {
    font-weight: bold;
    border: .1em solid var(--table-border-color);
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: .1em solid var(--table-border-color);
    margin: 0;
    padding: 6px 13px;
}
table thead {
    background-color: var(--table-header-bg-color);
}
table tr:nth-child(2n) {
    background-color: var(--table-n2-bg-color);
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

#write em {
    padding: 0 5px 0 2px;
}

/* height light */
#write mark {
    border: .1em solid var(--height-light-border-color);
    color: var(--height-light-color);
    background-color: transparent;
    padding: .1rem .5rem;
    border-radius: 2rem;
    margin: 0 .2rem;
    font-size: .95rem;
}

/*shortcut*/
kbd {
    border: .1em solid #5b5b5e;
    background: transparent;
    color: var(--text-color);
    margin: 0 .4rem;
    font-size: .95rem;
    padding: .3em .4em;
    border-radius: .4em;
    vertical-align: top;
    box-shadow: .1em .1em .2em rgba(0, 0, 0, 0.3);
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 12px;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

/*YAML*/
#write pre.md-meta-block {
    padding: 1rem;
    font-size: 1rem;
    background-color: var(--yaml-bg-color);
    border: 0;
    border-radius: 2px;
    color: var(--yaml-color);
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

#write > h3.md-focus:before {
    left: -1.5625rem;
    top: .375rem;
}

#write > h4.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write > h5.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write > h6.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

.md-image > .md-meta {
    border-radius: 2px;
    font-family: initial;
    padding: 2px 0 0 4px;
    color: inherit;
}

.md-tag {
    color: inherit;
}

.md-toc {
    margin-top: 20px;
    padding-bottom: 20px;
}

.typora-quick-open-item {
    font-size: 1rem !important;
    height: 50px;
    padding-left: 8px;
    padding-top: 4px;
    padding-bottom: 4px;
}

#typora-quick-open {
    box-shadow: 0 0 8px #00000045;
    padding: 0;
}

.ty-quick-open-category.ty-has-prev .ty-quick-open-category-title {
    border-top: none;
}

#typora-quick-open-input {
    margin: 8px;
    box-shadow: none;
    border-radius: 2px;
}

#typora-quick-open-input input {
    font-size: 1rem;
    box-shadow: none;
    padding-top: 2px;
    padding-left: 10px;
    padding-right: 10px;
    line-height: 32px;
    max-height: 32px;
    border: none;
}

.modal-dialog#typora-quick-open {
    border-radius: 8px;
}

.ty-quick-open-category-title {
    padding-left: 8px;
    color: #BEBEBE;
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.typora-quick-open-item-path {
    font-size: 0.8rem;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-top: 1px;
}

/*search input*/
.form-control {
    border: none;
    border-radius: 2px;
    box-shadow: none;
}

#md-searchpanel .btn {
    border-radius: 2px;
}

#search-panel-replaceall-btn {
    padding-right: 5px !important;
    text-align: center !important;
}

#search-panel-replace-btn {
    text-align: center !important;
}

#md-searchpanel input {
    background: var(--input-bg-color);
    border-radius: 2px;
}

.searchpanel-search-option-btn {
    border-radius: 2px;
    border: none;
    background: transparent;
    color: var(--text-color);
}

.searchpanel-search-option-btn.active {
    background: var(--text-color);
    color: var(--bg-color);
}

.form-control:focus {
    box-shadow: none;
}

#md-notification:before {
    top: 10px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: initial;
}

/*sidebar*/
.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

#typora-sidebar {
    font-size: 1.1rem;
}

.sidebar-tabs {
    border-bottom: none;
}

.file-list-item-summary, .file-list-item-parent-loc, .file-list-item-time, .file-list-item-summary {
    font-size: 0.9rem !important;
    font-family: var(--text-font);
}

.file-list-item-file-ext-part {
    display: none;
}

.outline-item {
    font-size: 1rem;
}

/*footnotes mark*/
#write .md-footnote {
    background-color: inherit;
    color: var(--drake-highlight);
    font-size: 0.9rem;
    border-radius: 0.9rem;
    padding-left: 0;
}

#write .md-footnote:before {
    content: "[";
}

#write .md-footnote:after {
    content: "]";
}

/*footnotes content*/
.md-hover-tip .code-tooltip-content {
    border-radius: 2px;
}

/*footnotes title*/
span.md-def-name {
    padding-right: 3ch;
    padding-left: 0;
    position: relative;
    font-weight: normal;
}

/*footnotes desc*/
.footnotes {
    font-size: 1rem;
    font-weight: normal;
    color: var(--text-color);
    position: relative;
}

/*footnotes tooltip text*/
.code-tooltip-content .md-plain {
    font-size: 0.9rem;
    font-family: inherit;
}

.code-tooltip-content code {
    padding: 0 2px;
    font-family: inherit;
    color: var(--footnotes-highlight);
    background-color: inherit;
}

.code-tooltip-content a {
    color: var(--footnotes-highlight);
}

div.code-tooltip-content {
    box-shadow: 0 0 8px #00000045;
    background: var(--footnotes-bg-color);
}

.footnotes {
    opacity: 1;
}

.md-def-name:after {
    content: ". ^";
    color: var(--text-color);
}

.md-def-footnote .md-def-name:before {
    content: "";
    color: var(--text-color);
    position: absolute;
}

.md-def-name:before {
    content: "";
    color: var(--text-color);
    position: absolute;
}

.md-content.md-url, .md-def-content.md-def-url.md-auto-disp {
    text-decoration: none;
    border-bottom: .1rem solid var(--text-color);
}

.CodeMirror-scroll::-webkit-scrollbar {
    display: none;
}

.file-list-item-summary {
    font-size: 1em;
}

.pin-outline #outline-content .outline-active strong, .pin-outline .outline-active {
    font-weight: 500;
    color: var(--outline-active-color);
}

.file-list-item.active {
    border-left: 4px solid var(--drake-accent);
}

#md-searchpanel .btn:not(.close-btn):hover {
    box-shadow: none;
    background: var(--btn-hover-bg-color);
}

/*checkbox*/
#write input[type=checkbox] {
    opacity: 0;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
    margin-top: 0;
    top: 0;
}

#write .ul-list li.md-task-list-item.task-list-done::before {
    content: "";
    background: var(--checkbox-checked) 0 0 no-repeat;
    background-size: 100%;
    display: inline-block;
    position: absolute;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
}

#write .ul-list li.md-task-list-item.task-list-not-done::before {
    content: "";
    background: var(--checkbox-unchecked) 0 0 no-repeat;
    background-size: 100%;
    display: inline-block;
    position: absolute;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
}

/*insert table*/
.btn {
    border-radius: 2px;
}

.modal-content {
    border-radius: 8px;
}

.btn-primary:hover, .btn-primary:active {
    background-color: var(--btn-hover-bg-color);
    color: var(--drake-highlight);
}

.btn-primary {
    background-color: transparent;
    color: var(--drake-highlight);
}

.btn-default {
    background-color: transparent;
}

.btn:active {
    box-shadow: none;
    border-color: transparent;
}

.modal-footer {
    border-top: none;
}

#table-insert-col, #table-insert-row {
    background: var(--input-bg-color);
    border-radius: 2px;
}

/*preference panel*/
#megamenu-content {
    background-image: none !important;
    background-color: var(--bg-color);
}
#top-titlebar {
    height: inherit;
    background-color: var(--bg-color);
}
#megamenu-menu-sidebar {
    background-color: var(--bg-color);
    color: var(--text-color);
}
.long-btn {
    width: inherit;
    min-width: 300px;
    border: 1px solid var(--text-color);
    border-radius: 6px;
}
.megamenu-menu-panel h1 {
    margin-bottom: 3rem;
    text-align: left;
}
.megamenu-menu-panel h1, .megamenu-menu-panel h2 {
    font-weight: normal;
}
#recent-file-panel-search-input {
    height: 45px;
    border: none;
    border-bottom: 1px solid var(--text-color);
    padding-left: 8px;
}
#recent-file-panel-search-input::placeholder {
    color: var(--text-color);
    opacity: .5;
}
.megamenu-menu-header {
    border-bottom: none;
}
#recent-file-panel-action-btn {
    background: none;
    border: none;
}
#recent-file-panel-action-btn-container {
    float: none;
    display: inline-block;
}
#top-titlebar .toolbar-icon.btn.hover, #top-titlebar .toolbar-icon.btn:hover {
    background-color: var(--btn-hover-bg-color);
    color: var(--text-color);
}
.megamenu-menu-panel .btn:hover {
    background-color: var(--btn-hover-bg-color) !important;
    color: var(--text-color);
}
#recent-file-panel tbody tr:nth-child(2n-1),
.megamenu-menu-panel table thead,
.megamenu-menu-panel table tr {
    background-color: transparent;
}
.megamenu-menu-panel table {
    font-weight: normal;
}
#megamenu-back-btn {
    color: var(--text-color);
    border: 1px solid var(--text-color);
}
.megamenu-menu-header #megamenu-menu-header-title {
    color: var(--text-color);
}
header, .context-menu, .megamenu-content, footer {
    font-family: var(--text-font);
}
.ty-preferences select {
    padding-left: 2px;
}
.preference-item-hint {
    font-size: 14px;
}
a.ty-link {
    color: var(--a-color);
    margin: 0 .2rem;
}

/**
    code render
    Name: IntelliJ IDEA darcula theme
    From IntelliJ IDEA by JetBrains
 */
.cm-s-inner.CodeMirror {
    background: var(--code-block-bg-color);
    color: var(--code-block-color);
}

.cm-s-inner span.cm-meta {
    color: #BBB529;
}

.cm-s-inner span.cm-number {
    color: #6897BB;
}

.cm-s-inner span.cm-keyword {
    color: #CC7832;
}

.cm-s-inner span.cm-def {
    color: #FFD760;
}

.cm-s-inner span.cm-variable {
    color: var(--code-block-color);
}

.cm-s-inner span.cm-variable-2 {
    color: var(--code-block-color);
}

.cm-s-inner span.cm-variable-3 {
    color: #9876AA;
}

.cm-s-inner span.cm-type {
    color: #AABBCC;
}

.cm-s-inner span.cm-property {
    color: #FFC66D;
}

.cm-s-inner span.cm-operator {
    color: var(--code-block-color);
}

.cm-s-inner span.cm-string {
    color: #6A8759;
}

.cm-s-inner span.cm-string-2 {
    color: #6A8759;
}

.cm-s-inner span.cm-comment {
    color: #787878;
}

.cm-s-inner span.cm-link {
    color: #CC7832;
}

.cm-s-inner span.cm-atom {
    color: #CC7832;
}

.cm-s-inner span.cm-error {
    color: #BC3F3C;
}

.cm-s-inner span.cm-tag {
    color: #E8BF6A;
}

.cm-s-inner span.cm-quote {
    color: #a6e22e;
}

.cm-s-inner span.cm-attribute {
    color: #9876AA;
}

.cm-s-inner span.cm-qualifier {
    color: #6A8759;
}

.cm-s-inner span.cm-bracket {
    color: #E8BF6A;
}

.cm-s-inner span.cm-builtin {
    color: #FF9E59;
}

.cm-s-inner span.cm-special {
    color: #FF9E59;
}

.cm-s-inner span.cm-matchhighlight {
    color: #FFFFFF;
    background-color: rgba(50, 89, 48, .7);
    font-weight: normal;
}

.cm-s-inner span.cm-searching {
    color: #FFFFFF;
    background-color: rgba(61, 115, 59, .7);
    font-weight: normal;
}

.cm-s-inner .CodeMirror-gutters {
    border-right: 1px solid rgba(120, 120, 120, 0.3);
}

.cm-s-inner .CodeMirror-linenumber {
    color: #585b5d;
}

.cm-s-inner .CodeMirror-matchingbracket {
    background-color: #3B514D;
    color: #FFEF28 !important;
}

.cm-s-inner .CodeMirror-selected {
    background: #214283 !important;
}

.cm-s-inner .CodeMirror-selectedtext {
    background: #214283 !important;
}

.cm-s-typora-default .CodeMirror-selectedtext {
    background: var(--select-text-bg-color) !important;
}

.cm-overlay.CodeMirror-selectedtext {
    background: var(--select-text-bg-color) !important;
}

.cm-s-inner div.CodeMirror-cursor {
    border-left: 1px solid var(--code-block-color);
}/*# sourceURL=/Users/didi/Documents/Codes/Fun/lagou/public/drake-juejin.css*/</style></head>
<body>
  <div id="write"><h1>08 | 容器监控：容器监控原理及 cAdvisor 的安装与使用</h1><p data-nodeid="873" class="">生产环境中监控容器的运行状况十分重要，通过监控我们可以随时掌握容器的运行状态，做到线上隐患和问题早发现，早解决。所以今天我就和你分享关于容器监控的知识（原理及工具 cAdvisor）。</p>
<p data-nodeid="874">虽然传统的物理机和虚拟机监控已经有了比较成熟的监控方案，但是容器的监控面临着更大的挑战，因为容器的行为和本质与传统的虚拟机是不一样的，总的来说，容器具有以下特性：</p>
<ul data-nodeid="875">
<li data-nodeid="876">
<p data-nodeid="877">容器是短期存活的，并且可以动态调度；</p>
</li>
<li data-nodeid="878">
<p data-nodeid="879">容器的本质是进程，而不是一个完整操作系统；</p>
</li>
<li data-nodeid="880">
<p data-nodeid="881">由于容器非常轻量，容器的创建和销毁也会比传统虚拟机更加频繁。</p>
</li>
</ul>
<p data-nodeid="882">Docker 容器的监控方案有很多，除了 Docker 自带的<code data-backticks="1" data-nodeid="965">docker stats</code>命令，还有很多开源的解决方案，例如 sysdig、cAdvisor、Prometheus 等，都是非常优秀的监控工具。</p>
<p data-nodeid="883">下面我们首先来看下，不借助任何外部工具，如何用 Docker 自带的<code data-backticks="1" data-nodeid="968">docker stats</code>命令实现容器的监控。</p>
<h3 data-nodeid="884">使用 docker stats 命令</h3>
<p data-nodeid="885">使用 Docker 自带的<code data-backticks="1" data-nodeid="972">docker stats</code>命令可以很方便地看到主机上所有容器的 CPU、内存、网络 IO、磁盘 IO、PID 等资源的使用情况。下面我们可以具体操作看看。</p>
<p data-nodeid="886">首先在主机上使用以下命令启动一个资源限制为 1 核 2G 的 nginx 容器：</p>
<pre class="lang-java hljs" data-nodeid="887"><code data-language="java">$ docker run --cpus=<span class="hljs-number">1</span> -m=<span class="hljs-number">2</span>g --name=nginx&nbsp; -d nginx
</code></pre>
<p data-nodeid="888">容器启动后，可以使用<code data-backticks="1" data-nodeid="976">docker stats</code>命令查看容器的资源使用状态:</p>
<pre class="lang-java hljs" data-nodeid="889"><code data-language="java">$ docker stats&nbsp;nginx
</code></pre>
<p data-nodeid="890">通过<code data-backticks="1" data-nodeid="979">docker stats</code>命令可以看到容器的运行状态如下：</p>
<pre class="lang-java hljs" data-nodeid="891"><code data-language="java">CONTAINER&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;CPU %&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;MEM USAGE / LIMIT&nbsp; &nbsp;MEM %&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NET I/O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;BLOCK I/O&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PIDS
f742a467b6d8&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0.00</span>%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">1.387</span> MiB / <span class="hljs-number">2</span> GiB&nbsp; &nbsp;<span class="hljs-number">0.07</span>%&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">656</span> B / <span class="hljs-number">656</span> B&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span> B / <span class="hljs-number">9.22</span> kB&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">2</span>
</code></pre>
<p data-nodeid="892">从容器的运行状态可以看出，<code data-backticks="1" data-nodeid="982">docker stats</code>命令确实可以获取并显示 Docker 容器运行状态。但是它的缺点也很明显，因为它只能获取本机数据，无法查看历史监控数据，没有可视化展示面板。</p>
<p data-nodeid="893">因此，生产环境中我们通常使用另一种容器监控解决方案 cAdvisor。</p>
<h3 data-nodeid="894">cAdvisor</h3>
<p data-nodeid="895">cAdvisor 是谷歌开源的一款通用的容器监控解决方案。cAdvisor 不仅可以采集机器上所有运行的容器信息，还提供了基础的查询界面和 HTTP 接口，更方便与外部系统结合。所以，cAdvisor很快成了容器指标监控最常用组件，并且 Kubernetes 也集成了 cAdvisor 作为容器监控指标的默认工具。</p>
<h4 data-nodeid="896">cAdvisor 的安装与使用</h4>
<p data-nodeid="897">下面我们以 cAdvisor 0.37.0 版本为例，演示一下 cAdvisor 的安装与使用。</p>
<p data-nodeid="898">cAdvisor 官方提供了 Docker 镜像，我们只需要拉取镜像并且启动镜像即可。</p>
<blockquote data-nodeid="899">
<p data-nodeid="900">由于 cAdvisor 镜像存放在谷歌的 gcr.io 镜像仓库中，国内无法访问到。这里我把打好的镜像放在了 Docker Hub。你可以使用 docker pull lagoudocker/cadvisor:v0.37.0 命令从 Docker Hub 拉取。</p>
</blockquote>
<p data-nodeid="901">首先使用以下命令启动 cAdvisor：</p>
<pre class="lang-java hljs" data-nodeid="902"><code data-language="java">$ docker run \
  --volume=/:/rootfs:ro \
  --volume=/<span class="hljs-keyword">var</span>/run:/<span class="hljs-keyword">var</span>/run:ro \
  --volume=/sys:/sys:ro \
  --volume=/<span class="hljs-keyword">var</span>/lib/docker/:/<span class="hljs-keyword">var</span>/lib/docker:ro \
  --volume=/dev/disk/:/dev/disk:ro \
  --publish=<span class="hljs-number">8080</span>:<span class="hljs-number">8080</span> \
  --detach=<span class="hljs-keyword">true</span> \
  --name=cadvisor \
  --privileged \
  --device=/dev/kmsg \
  lagoudocker/cadvisor:v0<span class="hljs-number">.37</span><span class="hljs-number">.0</span>
</code></pre>
<p data-nodeid="903">此时，cAdvisor 已经成功启动，我们可以通过访问 <a href="http://localhost:8080" data-nodeid="995">http://localhost:8080</a> 访问到 cAdvisor 的 Web 界面。</p>
<p data-nodeid="904"><img src="https://s0.lgstatic.com/i/image/M00/56/18/Ciqc1F9rCXSAQEwLAADKlh0at8o307.png" alt="Drawing 0.png" data-nodeid="999"></p>
<div data-nodeid="905"><p style="text-align:center">图1 cAdvisor 首页</p></div>
<p data-nodeid="906">cAdvisor 不仅可以监控容器的资源使用情况，还可以监控主机的资源使用情况。下面我们就先看下它是如何查看主机资源使用情况的。</p>
<h4 data-nodeid="907">使用 cAdvisor 查看主机监控</h4>
<p data-nodeid="908">访问 <a href="http://localhost:8080/containers/" data-nodeid="1005">http://localhost:8080/containers/</a> 地址，在首页可以看到主机的资源使用情况，包含 CPU、内存、文件系统、网络等资源，如下图所示。</p>
<p data-nodeid="909"><img src="https://s0.lgstatic.com/i/image/M00/56/23/CgqCHl9rCX2ANrtaAADIGkeKKPc100.png" alt="Drawing 1.png" data-nodeid="1009"></p>
<div data-nodeid="910"><p style="text-align:center">图2 主机 CPU 使用情况</p></div>
<h4 data-nodeid="911">使用 cAdvisor 查看容器监控</h4>
<p data-nodeid="912">如果你想要查看主机上运行的容器资源使用情况，可以访问 <a href="http://localhost:8080/docker/" data-nodeid="1014">http://localhost:8080/docker/</a>，这个页面会列出 Docker 的基本信息和运行的容器情况，如下图所示。</p>
<p data-nodeid="913"><img src="https://s0.lgstatic.com/i/image/M00/56/18/Ciqc1F9rCZyAN8hYAAGAOL1FGcg401.png" alt="Drawing 2.png" data-nodeid="1018"></p>
<div data-nodeid="914"><p style="text-align:center">图3 Docker 容器</p></div>
<p data-nodeid="915">在上图中的 Subcontainers 下会列出当前主机上运行的所有容器，点击其中一个容器即可查看该容器的详细运行状态，如下图所示。</p>
<p data-nodeid="916"><img src="https://s0.lgstatic.com/i/image/M00/56/23/CgqCHl9rCaWAVSLVAAGGy2lTMqY130.png" alt="Drawing 3.png" data-nodeid="1022"></p>
<div data-nodeid="917"><p style="text-align:center">图4 容器监控状态</p></div>
<p data-nodeid="918">总体来说，使用 cAdvisor 监控容器具有以下特点：</p>
<ul data-nodeid="919">
<li data-nodeid="920">
<p data-nodeid="921">可以同时采集物理机和容器的状态；</p>
</li>
<li data-nodeid="922">
<p data-nodeid="923">可以展示监控历史数据。</p>
</li>
</ul>
<p data-nodeid="924">了解 Docker 的监控工具，你是否想问，这些监控数据是怎么来的呢？下面我就带你了解一下容器监控的原理。</p>
<h3 data-nodeid="925">监控原理</h3>
<p data-nodeid="926">我们知道 Docker 是基于 Namespace、Cgroups 和联合文件系统实现的。其中 Cgroups 不仅可以用于容器资源的限制，还可以提供容器的资源使用率。无论何种监控方案的实现，底层数据都来源于 Cgroups。</p>
<p data-nodeid="927">Cgroups 的工作目录为<code data-backticks="1" data-nodeid="1030">/sys/fs/cgroup</code>，<code data-backticks="1" data-nodeid="1032">/sys/fs/cgroup</code>目录下包含了 Cgroups 的所有内容。Cgroups包含很多子系统，可以用来对不同的资源进行限制。例如对CPU、内存、PID、磁盘 IO等资源进行限制和监控。</p>
<p data-nodeid="928">为了更详细的了解 Cgroups 的子系统，我们通过 ls -l 命令查看<code data-backticks="1" data-nodeid="1035">/sys/fs/cgroup</code>文件夹，可以看到很多目录：</p>
<pre class="lang-java hljs" data-nodeid="929"><code data-language="java">$ sudo ls -l /sys/fs/cgroup/
total <span class="hljs-number">0</span>
dr-xr-xr-x <span class="hljs-number">5</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> blkio
lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">11</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> cpu -&gt; cpu,cpuacct
dr-xr-xr-x <span class="hljs-number">5</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> cpu,cpuacct
lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">11</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> cpuacct -&gt; cpu,cpuacct
dr-xr-xr-x <span class="hljs-number">3</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> cpuset
dr-xr-xr-x <span class="hljs-number">5</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> devices
dr-xr-xr-x <span class="hljs-number">3</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> freezer
dr-xr-xr-x <span class="hljs-number">3</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> hugetlb
dr-xr-xr-x <span class="hljs-number">5</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> memory
lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">16</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> net_cls -&gt; net_cls,net_prio
dr-xr-xr-x <span class="hljs-number">3</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> net_cls,net_prio
lrwxrwxrwx <span class="hljs-number">1</span> root root <span class="hljs-number">16</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> net_prio -&gt; net_cls,net_prio
dr-xr-xr-x <span class="hljs-number">3</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> perf_event
dr-xr-xr-x <span class="hljs-number">5</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> pids
dr-xr-xr-x <span class="hljs-number">5</span> root root&nbsp; <span class="hljs-number">0</span> Jul&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">19</span>:<span class="hljs-number">32</span> systemd
</code></pre>
<p data-nodeid="930">这些目录代表了 Cgroups 的子系统，Docker 会在每一个 Cgroups 子系统下创建 docker 文件夹。这里如果你对 Cgroups 子系统不了解的话，不要着急，后续我会在第 10 课时对 Cgroups 子系统做详细讲解，这里你只需要明白容器监控数据来源于 Cgroups 即可。</p>
<h4 data-nodeid="931">监控系统是如何获取容器的内存限制的？</h4>
<p data-nodeid="932">下面我们以 memory 子系统（memory 子系统是Cgroups 众多子系统的一个，主要用来限制内存使用，Cgroups 会在第十课时详细讲解）为例，讲解一下监控组件是如何获取到容器的资源限制和使用状态的（即容器的内存限制）。</p>
<p data-nodeid="933">我们首先在主机上使用以下命令启动一个资源限制为 1 核 2G 的 nginx 容器：</p>
<pre class="lang-shell hljs" data-nodeid="934"><code data-language="shell"><span class="hljs-meta">$</span><span class="bash"> docker run --name=nginx --cpus=1 -m=2g --name=nginx&nbsp; -d nginx</span>
<span class="hljs-meta">#</span><span class="bash"><span class="hljs-comment"># 这里输出的是容器 ID</span></span>
51041a74070e9260e82876974762b8c61c5ed0a51832d74fba6711175f89ede1
</code></pre>
<blockquote data-nodeid="935">
<p data-nodeid="936">注意：如果你已经创建过名称为 nginx 的容器，请先使用 docker&nbsp; rm -f nginx 命令删除已经存在的 nginx 容器。</p>
</blockquote>
<p data-nodeid="937">容器启动后，我们通过命令行的输出可以得到容器的 ID，同时 Docker 会在<code data-backticks="1" data-nodeid="1043">/sys/fs/cgroup/memory/docker</code>目录下以容器 ID 为名称创建对应的文件夹。</p>
<p data-nodeid="938">下面我们查看一下<code data-backticks="1" data-nodeid="1046">/sys/fs/cgroup/memory/docker</code>目录下的文件：</p>
<pre class="lang-java hljs" data-nodeid="939"><code data-language="java">$ sudo ls -l /sys/fs/cgroup/memory/docker
total <span class="hljs-number">0</span>
drwxr-xr-x <span class="hljs-number">2</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> <span class="hljs-number">51041</span>a74070e9260e82876974762b8c61c5ed0a51832d74fba6711175f89ede1
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> cgroup.clone_children
--w--w--w- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> cgroup.event_control
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> cgroup.procs
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.failcnt
--w------- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.force_empty
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.failcnt
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.max_usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.slabinfo
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.tcp.failcnt
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.tcp.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.tcp.max_usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.tcp.usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.kmem.usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.max_usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.memsw.failcnt
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.memsw.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.memsw.max_usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.memsw.usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.move_charge_at_immigrate
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.numa_stat
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.oom_control
---------- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.pressure_level
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.soft_limit_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.stat
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.swappiness
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> memory.use_hierarchy
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> notify_on_release
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">14</span>:<span class="hljs-number">57</span> tasks
</code></pre>
<p data-nodeid="940">可以看到 Docker 已经创建了以容器 ID 为名称的目录，我们再使用 ls 命令查看一下该目录的内容：</p>
<pre class="lang-java hljs" data-nodeid="941"><code data-language="java">$ sudo ls -l /sys/fs/cgroup/memory/docker/<span class="hljs-number">51041</span>a74070e9260e82876974762b8c61c5ed0a51832d74fba6711175f89ede1
total <span class="hljs-number">0</span>
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> cgroup.clone_children
--w--w--w- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">13</span> cgroup.event_control
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> cgroup.procs
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> memory.failcnt
--w------- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.force_empty
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.failcnt
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> memory.kmem.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.max_usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.slabinfo
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.tcp.failcnt
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.tcp.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.tcp.max_usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.tcp.usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.kmem.usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> memory.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> memory.max_usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.memsw.failcnt
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> memory.memsw.limit_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.memsw.max_usage_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.memsw.usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.move_charge_at_immigrate
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.numa_stat
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">13</span> memory.oom_control
---------- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.pressure_level
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.soft_limit_in_bytes
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.stat
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.swappiness
-r--r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">12</span> memory.usage_in_bytes
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> memory.use_hierarchy
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> notify_on_release
-rw-r--r-- <span class="hljs-number">1</span> root root <span class="hljs-number">0</span> Sep&nbsp; <span class="hljs-number">2</span> <span class="hljs-number">15</span>:<span class="hljs-number">21</span> tasks
</code></pre>
<p data-nodeid="942">由上可以看到，容器 ID 的目录下有很多文件，其中 memory.limit_in_bytes 文件代表该容器内存限制大小，单位为 byte，我们使用 cat 命令（cat 命令可以查看文件内容）查看一下文件内容：</p>
<pre class="lang-java hljs" data-nodeid="943"><code data-language="java">$ sudo cat /sys/fs/cgroup/memory/docker/<span class="hljs-number">51041</span>a74070e9260e82876974762b8c61c5ed0a51832d74fba6711175f89ede1/memory.limit_in_bytes
<span class="hljs-number">2147483648</span>
</code></pre>
<p data-nodeid="944">这里可以看到memory.limit_in_bytes 的值为2147483648，转换单位后正好为 2G，符合我们启动容器时的内存限制 2G。</p>
<p data-nodeid="945">通过 memory 子系统的例子，我们可以知道<strong data-nodeid="1068">监控组件通过读取 memory.limit_in_bytes 文件即可获取到容器内存的限制值</strong>。了解完容器的内存限制我们来了解一下容器的内存使用情况。</p>
<h4 data-nodeid="946">监控系统是如何获取容器的内存使用状态的？</h4>
<p data-nodeid="947">内存使用情况存放在 memory.usage_in_bytes 文件里，同样我们也使用 cat 命令查看一下文件内容:</p>
<pre class="lang-java te-preview-highlight hljs" data-nodeid="8380"><code data-language="java">$ sudo cat /sys/fs/cgroup/memory/docker/<span class="hljs-number">51041</span>a74070e9260e82876974762b8c61c5ed0a51832d74fba6711175f89ede1/memory.usage_in_bytes
<span class="hljs-number">4259840</span>
</code></pre>


















<p data-nodeid="949">可以看到当前内存的使用大小为 4259840 byte，约为 4 M。了解了内存的监控，下面我们来了解下网络的监控数据来源。</p>
<p data-nodeid="950">网络的监控数据来源是从 /proc/{PID}/net/dev 目录下读取的，其中 PID 为容器在主机上的进程 ID。下面我们首先使用 docker inspect 命令查看一下上面启动的 nginx 容器的 PID，命令如下：</p>
<pre class="lang-java hljs" data-nodeid="951"><code data-language="java">$ docker&nbsp;inspect nginx |grep Pid
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-string">"Pid"</span>: <span class="hljs-number">27348</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-string">"PidMode"</span>: <span class="hljs-string">""</span>,
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-string">"PidsLimit"</span>: <span class="hljs-number">0</span>,
</code></pre>
<p data-nodeid="952">可以看到容器的 PID 为 27348，使用 cat 命令查看一下 /proc/27348/net/dev 的内容：</p>
<pre class="lang-java hljs" data-nodeid="953"><code data-language="java">$ sudo cat /proc/<span class="hljs-number">27348</span>/net/dev
Inter-|&nbsp; &nbsp;Receive&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; Transmit
&nbsp;face |bytes&nbsp; &nbsp; packets errs drop fifo frame compressed multicast|bytes&nbsp; &nbsp; packets errs drop fifo colls carrier compressed
&nbsp; &nbsp; lo:&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span>
&nbsp; eth0:&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; <span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">0</span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span>
</code></pre>
<p data-nodeid="954">/proc/27348/net/dev 文件记录了该容器里每一个网卡的流量接收和发送情况，以及错误数、丢包数等信息。可见容器的网络监控数据都是定时从这里读取并展示的。</p>
<p data-nodeid="955">总结一下，<strong data-nodeid="1083">容器的监控原理其实就是定时读取 Linux 主机上相关的文件并展示给用户。</strong></p>
<h3 data-nodeid="956">结语</h3>
<p data-nodeid="957">到此，相信你已经可以使用 docker stats 和 cAdvisor 监控并查看容器的状态了；也可以自己启动一个 cAdvisor 容器来监控主机和主机上的容器，并对监控系统的原理有了较深的了解。</p>
<p data-nodeid="958" class="">试想下，cAdvisor 虽然可以临时存储一段历史监控数据，并且提供了一个简版的监控面板，在大规模的容器集群中，cAdvisor 有什么明显的不足吗？思考后，把你的想法写在留言区。</p></div>

</body></html>