<!DOCTYPE html><html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>17 | 原理实践：自己动手使用 Golang 开发 Docker（上）</title>
<style type="text/css">.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}.hljs-comment,.hljs-quote{color:#a0a1a7;font-style:italic}.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#e45649}.hljs-literal{color:#0184bb}.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#50a14f}.hljs-built_in,.hljs-class .hljs-title{color:#c18401}.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#4078f2}.hljs-emphasis{font-style:italic}.hljs-strong{font-weight:700}.hljs-link{text-decoration:underline}/*# sourceURL=/Users/young/Documents/Codes/Fun/lagou/public/atom-one-light.min.css*/</style><style type="text/css">/*
 * Copyright (C) 2018 Drake, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

:root {
    --monospace: "JetBrains Mono", HYZhengYuan, "Fira Code", Menlo, "Ubuntu Mono", Consolas; /*code font*/
    --text-font: var(--monospace); /*default font*/
    --title-font: var(--monospace); /*title font*/

    --text-color: #333333;
    --bg-color: #ffffff;
    --control-text-color: var(--text-color);
    --meta-content-color: var(--text-color);
    --active-file-border-color: var(--drake-accent);
    --rawblock-edit-panel-bd: var(--code-block-bg-color);
    --item-hover-bg-color: #E5E5E596;
    --active-file-bg-color: var(--item-hover-bg-color);

    --drake-accent: #e95f59;
    --drake-highlight: #d63200;
    --a-color: #036aca;
    --variable-color: var(--drake-highlight);
    --outline-active-color: var(--a-color);
    --code-block-bg-color: #2b2b2b;
    --code-block-color: #A9B7C6;
    --title-color: #135ce0;
    --blockquote-border-color: #b2aec5;
    --blockquote-color: #595959;
    --blockquote-bg-color: #fff9f9;
    --strong-color: var(--title-color);
    --h2-underline-color: var(--title-color);
    --horizontal-divider-color: var(--title-color);
    --height-light-color: var(--drake-highlight);
    --height-light-border-color: var(--drake-highlight);
    --yaml-color: #777777;
    --yaml-bg-color: #f7f7f7;
    --footnotes-bg-color: #3c3d3e;
    --footnotes-highlight: #FFD760;
    --table-border-color: #dfe2e5;
    --table-header-bg-color: #f6f8fa;
    --table-bg-color: var(--bg-color);
    --table-n2-bg-color: #f6f8fa;
    --input-bg-color: var(--item-hover-bg-color);
    --btn-hover-bg-color: var(--item-hover-bg-color);
    --checkbox-checked: url("data:image/svg+xml,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M425.984 726.016l384-384-59.99-61.995-324.01 324.011-152.021-152.021L213.973 512zm384-598.016q36.01 0 61.013 25.984T896 213.974v596.01q0 34.005-25.003 59.99t-61.013 25.983h-596.01q-36.011 0-61.014-25.984t-25.003-59.989v-596.01q0-34.006 25.003-59.99T213.973 128h596.011z' fill='%2365b73b'/%3E%3C/svg%3E");
    --checkbox-unchecked: url("data:image/svg+xml,%3Csvg class='icon' viewBox='0 0 1024 1024' xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cpath d='M810.667 213.333v597.334H213.333V213.333h597.334m0-85.333H213.333C166.4 128 128 166.4 128 213.333v597.334C128 857.6 166.4 896 213.333 896h597.334C857.6 896 896 857.6 896 810.667V213.333C896 166.4 857.6 128 810.667 128z' fill='%23333333'/%3E%3C/svg%3E");
}

html {
    font-size: 15px;
}

body {
    font-family: var(--text-font) !important;
    color: var(--text-color);
    -webkit-font-feature-settings: "liga" on, "calt" on;
    -webkit-font-smoothing: subpixel-antialiased;
    text-rendering: optimizeLegibility;
    letter-spacing: 0;
    margin: 0;
    overflow-x: hidden;
    line-height: 1.8rem;
}

img {
    max-width: 100%;
}

#write {
    background-image: linear-gradient(
            90deg
            ,rgba(60,10,30,.04) 3%,transparent 0),linear-gradient(
            1turn
            ,rgba(60,10,30,.04) 3%,transparent 0);
    background-size: 20px 20px;
    background-position: 50%;
}

/*code block*/
#write .md-fences {
    font-size: 1rem;
    padding: 0.5rem !important;
    border-radius: 2px;
    word-wrap: normal;
    background-color: var(--code-block-bg-color);
    color: var(--code-block-color);
    border: none;
}

/*code snippet*/
#write code, tt {
    border-radius: 2px;
    color: var(--drake-highlight);
}

/*variable*/
var {
    color: var(--variable-color);
    font-weight: bold;
}

/*raw block*/
.md-rawblock-control:not(.md-rawblock-tooltip) {
    border-radius: 2px 0 2px 2px;
    padding: 0.2rem !important;
}
.md-rawblock:hover > .md-rawblock-container {
    background: none;
}
.md-rawblock-input {
    font-size: 1rem;
}
.md-rawblock-tooltip-btn:hover {
    background: none;
}
.md-rawblock:hover > .md-rawblock-tooltip {
    border-radius: 2px 2px 0 0;
    margin-bottom: 2px !important;
}
.md-rawblock-tooltip.md-rawblock-control {
    border-radius: 2px 2px 0 0;
    color: var(--code-block-color);
}
.md-rawblock-tooltip-name {
    color: var(--code-block-color);
    opacity: 1;
}

/*quote block*/
blockquote:before {
    display: block;
    position: absolute;
    content: '';
    width: 4px;
    left: 0;
    top: 0;
    height: 100%;
    background-color: var(--blockquote-border-color);
    border-radius: 2px;
}

blockquote {
    color: var(--blockquote-color);
    border-radius: 2px;
    padding: 10px 16px;
    background-color: var(--blockquote-bg-color);
    position: relative;
    border-left: none;
}

#write strong {
    color: var(--strong-color);
    font-weight: bold;
}
#write blockquote strong {
    color: var(--blockquote-color);
}

/*link*/
#write a {
    color: var(--a-color);
    text-decoration: none;
}
#write a .md-plain, .md-htmlblock-container a:hover {
    border-bottom: .1rem solid var(--a-color);
}
[md-inline=link] a {
    margin: 0 .2rem;
}
a:any-link {
    color: var(--a-color);
}

img {
    border-left: none;
    border-right: none;
    vertical-align: baseline;
    border-radius: 2px;
}

#write {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px 30px 100px;
}
#typora-source .CodeMirror-lines {
    max-width: 1200px;
}

#write p {
    word-spacing: .05rem;
}

#write > ul:first-child,
#write > ol:first-child {
    margin-top: 30px;
}

body > *:first-child {
    margin-top: 0 !important;
}

body > *:last-child {
    margin-bottom: 0 !important;
}

h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: var(--title-font);
    position: relative;
    margin-top: 2rem;
    margin-bottom: 1rem;
    font-weight: bold;
    cursor: text;
    color: var(--title-color);
}

h3.md-focus:before, h4.md-focus:before, h5.md-focus:before, h6.md-focus:before {
    visibility: hidden;
}

h1 {
    font-size: 1.6rem;
    text-align: center;
    margin-top: 0;
}

h2.md-end-block.md-heading {
    font-size: 1.6rem;
    display: inline-block;
}

h2.md-end-block.md-heading:after {
    display: block;
    content: '';
    height: 2px;
    margin-top: 4px;
    background-color: var(--h2-underline-color);
    border-radius: 2px;
}

h3 {
    font-size: 1.4rem;
}

h4 {
    font-size: 1.2rem;
}

h5 {
    font-size: 1rem;
}

h6 {
    font-size: 1rem;
}

h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}

h1 tt,
h1 code {
    font-size: inherit !important;
}

h2 tt,
h2 code {
    font-size: inherit !important;
}

h3 tt,
h3 code {
    font-size: inherit !important;
}

h4 tt,
h4 code {
    font-size: inherit !important;
}

h5 tt,
h5 code {
    font-size: inherit !important;
}

h6 tt,
h6 code {
    font-size: inherit !important;
}

blockquote,
ul,
ol,
dl,
table {
    margin: 0.8em 0;
}
p {
    margin: 0;
}

li > ol,
li > ul {
    margin: 0 0;
}

hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: var(--horizontal-divider-color);
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

body > h2:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child {
    margin-top: 0;
    padding-top: 0;
}

body > h1:first-child + h2 {
    margin-top: 0;
    padding-top: 0;
}

body > h3:first-child,
body > h4:first-child,
body > h5:first-child,
body > h6:first-child {
    margin-top: 0;
    padding-top: 0;
}

a:first-child h1,
a:first-child h2,
a:first-child h3,
a:first-child h4,
a:first-child h5,
a:first-child h6 {
    margin-top: 0;
    padding-top: 0;
}

h1 p,
h2 p,
h3 p,
h4 p,
h5 p,
h6 p {
    margin-top: 0;
}

li p.first {
    display: inline-block;
}

ul, ol {
    padding-inline-start: 2em;
}

ul:first-child,
ol:first-child {
    margin-top: 0;
}

ul:last-child,
ol:last-child {
    margin-bottom: 0;
}

table {
    padding: 0;
    word-break: initial;
    background-color: var(--table-bg-color);
}
table tr {
    border-top: .1em solid var(--table-border-color);
    margin: 0;
    padding: 0;
}
table th {
    font-weight: bold;
    border: .1em solid var(--table-border-color);
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: .1em solid var(--table-border-color);
    margin: 0;
    padding: 6px 13px;
}
table thead {
    background-color: var(--table-header-bg-color);
}
table tr:nth-child(2n) {
    background-color: var(--table-n2-bg-color);
}
table tr th:first-child,
table tr td:first-child {
    margin-top: 0;
}
table tr th:last-child,
table tr td:last-child {
    margin-bottom: 0;
}

#write em {
    padding: 0 5px 0 2px;
}

/* height light */
#write mark {
    border: .1em solid var(--height-light-border-color);
    color: var(--height-light-color);
    background-color: transparent;
    padding: .1rem .5rem;
    border-radius: 2rem;
    margin: 0 .2rem;
    font-size: .95rem;
}

/*shortcut*/
kbd {
    border: .1em solid #5b5b5e;
    background: transparent;
    color: var(--text-color);
    margin: 0 .4rem;
    font-size: .95rem;
    padding: .3em .4em;
    border-radius: .4em;
    vertical-align: top;
    box-shadow: .1em .1em .2em rgba(0, 0, 0, 0.3);
}

#write del {
    padding: 1px 2px;
}

.md-task-list-item > input {
    margin-left: -1.3em;
}

@media print {
    html {
        font-size: 12px;
    }

    table,
    pre {
        page-break-inside: avoid;
    }

    pre {
        word-wrap: break-word;
    }
}

/*YAML*/
#write pre.md-meta-block {
    padding: 1rem;
    font-size: 1rem;
    background-color: var(--yaml-bg-color);
    border: 0;
    border-radius: 2px;
    color: var(--yaml-color);
    margin-top: 0 !important;
}

.mathjax-block > .code-tooltip {
    bottom: .375rem;
}

#write > h3.md-focus:before {
    left: -1.5625rem;
    top: .375rem;
}

#write > h4.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write > h5.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

#write > h6.md-focus:before {
    left: -1.5625rem;
    top: .285714286rem;
}

.md-image > .md-meta {
    border-radius: 2px;
    font-family: initial;
    padding: 2px 0 0 4px;
    color: inherit;
}

.md-tag {
    color: inherit;
}

.md-toc {
    margin-top: 20px;
    padding-bottom: 20px;
}

.typora-quick-open-item {
    font-size: 1rem !important;
    height: 50px;
    padding-left: 8px;
    padding-top: 4px;
    padding-bottom: 4px;
}

#typora-quick-open {
    box-shadow: 0 0 8px #00000045;
    padding: 0;
}

.ty-quick-open-category.ty-has-prev .ty-quick-open-category-title {
    border-top: none;
}

#typora-quick-open-input {
    margin: 8px;
    box-shadow: none;
    border-radius: 2px;
}

#typora-quick-open-input input {
    font-size: 1rem;
    box-shadow: none;
    padding-top: 2px;
    padding-left: 10px;
    padding-right: 10px;
    line-height: 32px;
    max-height: 32px;
    border: none;
}

.modal-dialog#typora-quick-open {
    border-radius: 8px;
}

.ty-quick-open-category-title {
    padding-left: 8px;
    color: #BEBEBE;
    font-size: 0.8rem;
    margin-bottom: 4px;
}

.typora-quick-open-item-path {
    font-size: 0.8rem;
    text-overflow: ellipsis;
    white-space: nowrap;
    margin-top: 1px;
}

/*search input*/
.form-control {
    border: none;
    border-radius: 2px;
    box-shadow: none;
}

#md-searchpanel .btn {
    border-radius: 2px;
}

#search-panel-replaceall-btn {
    padding-right: 5px !important;
    text-align: center !important;
}

#search-panel-replace-btn {
    text-align: center !important;
}

#md-searchpanel input {
    background: var(--input-bg-color);
    border-radius: 2px;
}

.searchpanel-search-option-btn {
    border-radius: 2px;
    border: none;
    background: transparent;
    color: var(--text-color);
}

.searchpanel-search-option-btn.active {
    background: var(--text-color);
    color: var(--bg-color);
}

.form-control:focus {
    box-shadow: none;
}

#md-notification:before {
    top: 10px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header,
.context-menu,
.megamenu-content,
footer {
    font-family: initial;
}

/*sidebar*/
.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state {
    visibility: visible;
}

#typora-sidebar {
    font-size: 1.1rem;
}

.sidebar-tabs {
    border-bottom: none;
}

.file-list-item-summary, .file-list-item-parent-loc, .file-list-item-time, .file-list-item-summary {
    font-size: 0.9rem !important;
    font-family: var(--text-font);
}

.file-list-item-file-ext-part {
    display: none;
}

.outline-item {
    font-size: 1rem;
}

/*footnotes mark*/
#write .md-footnote {
    background-color: inherit;
    color: var(--drake-highlight);
    font-size: 0.9rem;
    border-radius: 0.9rem;
    padding-left: 0;
}

#write .md-footnote:before {
    content: "[";
}

#write .md-footnote:after {
    content: "]";
}

/*footnotes content*/
.md-hover-tip .code-tooltip-content {
    border-radius: 2px;
}

/*footnotes title*/
span.md-def-name {
    padding-right: 3ch;
    padding-left: 0;
    position: relative;
    font-weight: normal;
}

/*footnotes desc*/
.footnotes {
    font-size: 1rem;
    font-weight: normal;
    color: var(--text-color);
    position: relative;
}

/*footnotes tooltip text*/
.code-tooltip-content .md-plain {
    font-size: 0.9rem;
    font-family: inherit;
}

.code-tooltip-content code {
    padding: 0 2px;
    font-family: inherit;
    color: var(--footnotes-highlight);
    background-color: inherit;
}

.code-tooltip-content a {
    color: var(--footnotes-highlight);
}

div.code-tooltip-content {
    box-shadow: 0 0 8px #00000045;
    background: var(--footnotes-bg-color);
}

.footnotes {
    opacity: 1;
}

.md-def-name:after {
    content: ". ^";
    color: var(--text-color);
}

.md-def-footnote .md-def-name:before {
    content: "";
    color: var(--text-color);
    position: absolute;
}

.md-def-name:before {
    content: "";
    color: var(--text-color);
    position: absolute;
}

.md-content.md-url, .md-def-content.md-def-url.md-auto-disp {
    text-decoration: none;
    border-bottom: .1rem solid var(--text-color);
}

.CodeMirror-scroll::-webkit-scrollbar {
    display: none;
}

.file-list-item-summary {
    font-size: 1em;
}

.pin-outline #outline-content .outline-active strong, .pin-outline .outline-active {
    font-weight: 500;
    color: var(--outline-active-color);
}

.file-list-item.active {
    border-left: 4px solid var(--drake-accent);
}

#md-searchpanel .btn:not(.close-btn):hover {
    box-shadow: none;
    background: var(--btn-hover-bg-color);
}

/*checkbox*/
#write input[type=checkbox] {
    opacity: 0;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
    margin-top: 0;
    top: 0;
}

#write .ul-list li.md-task-list-item.task-list-done::before {
    content: "";
    background: var(--checkbox-checked) 0 0 no-repeat;
    background-size: 100%;
    display: inline-block;
    position: absolute;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
}

#write .ul-list li.md-task-list-item.task-list-not-done::before {
    content: "";
    background: var(--checkbox-unchecked) 0 0 no-repeat;
    background-size: 100%;
    display: inline-block;
    position: absolute;
    height: 1.6rem;
    width: 1.6rem;
    margin-left: -2em;
}

/*insert table*/
.btn {
    border-radius: 2px;
}

.modal-content {
    border-radius: 8px;
}

.btn-primary:hover, .btn-primary:active {
    background-color: var(--btn-hover-bg-color);
    color: var(--drake-highlight);
}

.btn-primary {
    background-color: transparent;
    color: var(--drake-highlight);
}

.btn-default {
    background-color: transparent;
}

.btn:active {
    box-shadow: none;
    border-color: transparent;
}

.modal-footer {
    border-top: none;
}

#table-insert-col, #table-insert-row {
    background: var(--input-bg-color);
    border-radius: 2px;
}

/*preference panel*/
#megamenu-content {
    background-image: none !important;
    background-color: var(--bg-color);
}
#top-titlebar {
    height: inherit;
    background-color: var(--bg-color);
}
#megamenu-menu-sidebar {
    background-color: var(--bg-color);
    color: var(--text-color);
}
.long-btn {
    width: inherit;
    min-width: 300px;
    border: 1px solid var(--text-color);
    border-radius: 6px;
}
.megamenu-menu-panel h1 {
    margin-bottom: 3rem;
    text-align: left;
}
.megamenu-menu-panel h1, .megamenu-menu-panel h2 {
    font-weight: normal;
}
#recent-file-panel-search-input {
    height: 45px;
    border: none;
    border-bottom: 1px solid var(--text-color);
    padding-left: 8px;
}
#recent-file-panel-search-input::placeholder {
    color: var(--text-color);
    opacity: .5;
}
.megamenu-menu-header {
    border-bottom: none;
}
#recent-file-panel-action-btn {
    background: none;
    border: none;
}
#recent-file-panel-action-btn-container {
    float: none;
    display: inline-block;
}
#top-titlebar .toolbar-icon.btn.hover, #top-titlebar .toolbar-icon.btn:hover {
    background-color: var(--btn-hover-bg-color);
    color: var(--text-color);
}
.megamenu-menu-panel .btn:hover {
    background-color: var(--btn-hover-bg-color) !important;
    color: var(--text-color);
}
#recent-file-panel tbody tr:nth-child(2n-1),
.megamenu-menu-panel table thead,
.megamenu-menu-panel table tr {
    background-color: transparent;
}
.megamenu-menu-panel table {
    font-weight: normal;
}
#megamenu-back-btn {
    color: var(--text-color);
    border: 1px solid var(--text-color);
}
.megamenu-menu-header #megamenu-menu-header-title {
    color: var(--text-color);
}
header, .context-menu, .megamenu-content, footer {
    font-family: var(--text-font);
}
.ty-preferences select {
    padding-left: 2px;
}
.preference-item-hint {
    font-size: 14px;
}
a.ty-link {
    color: var(--a-color);
    margin: 0 .2rem;
}

/**
    code render
    Name: IntelliJ IDEA darcula theme
    From IntelliJ IDEA by JetBrains
 */
.cm-s-inner.CodeMirror {
    background: var(--code-block-bg-color);
    color: var(--code-block-color);
}

.cm-s-inner span.cm-meta {
    color: #BBB529;
}

.cm-s-inner span.cm-number {
    color: #6897BB;
}

.cm-s-inner span.cm-keyword {
    color: #CC7832;
}

.cm-s-inner span.cm-def {
    color: #FFD760;
}

.cm-s-inner span.cm-variable {
    color: var(--code-block-color);
}

.cm-s-inner span.cm-variable-2 {
    color: var(--code-block-color);
}

.cm-s-inner span.cm-variable-3 {
    color: #9876AA;
}

.cm-s-inner span.cm-type {
    color: #AABBCC;
}

.cm-s-inner span.cm-property {
    color: #FFC66D;
}

.cm-s-inner span.cm-operator {
    color: var(--code-block-color);
}

.cm-s-inner span.cm-string {
    color: #6A8759;
}

.cm-s-inner span.cm-string-2 {
    color: #6A8759;
}

.cm-s-inner span.cm-comment {
    color: #787878;
}

.cm-s-inner span.cm-link {
    color: #CC7832;
}

.cm-s-inner span.cm-atom {
    color: #CC7832;
}

.cm-s-inner span.cm-error {
    color: #BC3F3C;
}

.cm-s-inner span.cm-tag {
    color: #E8BF6A;
}

.cm-s-inner span.cm-quote {
    color: #a6e22e;
}

.cm-s-inner span.cm-attribute {
    color: #9876AA;
}

.cm-s-inner span.cm-qualifier {
    color: #6A8759;
}

.cm-s-inner span.cm-bracket {
    color: #E8BF6A;
}

.cm-s-inner span.cm-builtin {
    color: #FF9E59;
}

.cm-s-inner span.cm-special {
    color: #FF9E59;
}

.cm-s-inner span.cm-matchhighlight {
    color: #FFFFFF;
    background-color: rgba(50, 89, 48, .7);
    font-weight: normal;
}

.cm-s-inner span.cm-searching {
    color: #FFFFFF;
    background-color: rgba(61, 115, 59, .7);
    font-weight: normal;
}

.cm-s-inner .CodeMirror-gutters {
    border-right: 1px solid rgba(120, 120, 120, 0.3);
}

.cm-s-inner .CodeMirror-linenumber {
    color: #585b5d;
}

.cm-s-inner .CodeMirror-matchingbracket {
    background-color: #3B514D;
    color: #FFEF28 !important;
}

.cm-s-inner .CodeMirror-selected {
    background: #214283 !important;
}

.cm-s-inner .CodeMirror-selectedtext {
    background: #214283 !important;
}

.cm-s-typora-default .CodeMirror-selectedtext {
    background: var(--select-text-bg-color) !important;
}

.cm-overlay.CodeMirror-selectedtext {
    background: var(--select-text-bg-color) !important;
}

.cm-s-inner div.CodeMirror-cursor {
    border-left: 1px solid var(--code-block-color);
}/*# sourceURL=/Users/didi/Documents/Codes/Fun/lagou/public/drake-juejin.css*/</style></head>
<body>
  <div id="write"><h1>17 | 原理实践：自己动手使用 Golang 开发 Docker（上）</h1><p data-nodeid="761" class="">第一模块，我们从 Docker 基础概念讲到 Docker 的基本操作。第二模块，我们详细剖析了 Docker 的三大关键技术（ Namespace、cgroups 和联合文件系统）的实现原理，并且讲解了 Docker 的网络模型等关键性技术。相信此时的你已经对 Docker 有了一个新的认识。</p>
<p data-nodeid="762">接下来的两课时，我就趁热打铁，带你动手使用 Golang 编写一个 Docker。学习这两节的内容需要你能够熟练使用 Golang 语言，如果你没有 Golang 编程基础，建议先学习一下 Golang 的基本语法。那么 Golang 究竟是什么呢? Golang 应该如何安装使用？下面我带你一一学习。</p>
<h3 data-nodeid="763">Golang 是什么?</h3>
<p data-nodeid="764">Golang 又称为 Go，是 Google 开源的一种静态编译型语言，Golang 自带内存管理机制，相比于 C 和 C++ 语言，我们不需要关心内存的分配和回收。</p>
<p data-nodeid="765">Golang 是新一代的互联网编程语言，在 Golang 诞生前，C 或 C++ 作为服务端高性能编程语言，使用 C 或 C++ 开发的业务具有非常高的执行效率，但是编译和开发效率却不尽人意，Java、.NET 等语言的诞生大大提高了软件开发速度，但是运行效率和资源占用却不如 C 和 C++。</p>
<p data-nodeid="766">这时 Golang 横空出世，由于 Golang 较高的开发效率和执行效率，很快便从众多编程语言中脱颖而出，成为众多互联网公司的新宠儿。滴滴、知乎、阿里等众多大型互联网公司都在大量使用 Golang。 同时，Docker 和 Kubernetes 等众多明星项目也都是使用 Golang 开发的。因此，熟练掌握 Golang 将会为你加分很多。</p>
<p data-nodeid="767">这么好的编程语言，你是不是已经迫不及待地想要安装体验一下了？别着急，下面我带你来安装一个 Golang 环境。</p>
<h3 data-nodeid="768">Golang 安装</h3>
<p data-nodeid="769">安装信息如下：</p>
<ul data-nodeid="770">
<li data-nodeid="771">
<p data-nodeid="772">CentOS 7系统</p>
</li>
<li data-nodeid="773">
<p data-nodeid="774">Golang 版本 1.15.2</p>
</li>
</ul>
<p data-nodeid="775">首先我们到<a href="https://golang.org/" data-nodeid="865">Golang 官网</a>（由于国内无法访问 Golang 官网，推荐到<a href="https://studygolang.com/dl" data-nodeid="869">Golang 中文网</a>下载安装包）下载一个对应操作系统的安装包。</p>
<pre class="lang-java hljs" data-nodeid="776"><code data-language="java">$ cd /tmp &amp;&amp; wget https:<span class="hljs-comment">//studygolang.com/dl/golang/go1.15.2.linux-amd64.tar.gz</span>
</code></pre>
<p data-nodeid="777">解压缩安装包：</p>
<pre class="lang-java hljs" data-nodeid="778"><code data-language="java">$ sudo tar -C /usr/local -xzf&nbsp;go1.<span class="hljs-number">15.2</span>.linux-amd64.tar.gz
</code></pre>
<p data-nodeid="779">在 $HOME/.bashrc 文件末尾添加以下内容，将 Golang 可执行文件目录添加到系统 PATH 中：</p>
<pre class="lang-java hljs" data-nodeid="780"><code data-language="java">export PATH=$PATH:/usr/local/go/bin
</code></pre>
<p data-nodeid="781">将 go 的安装路径添加到系统 PATH 中后，就可以在命令行直接使用 go 命令了。配置好 go 命令后，我们还需要配置 GOPATH 才能正确存放和编译我们的 go 代码。</p>
<h4 data-nodeid="782">配置 GOPATH</h4>
<p data-nodeid="783">GOPATH 是 Golang 的源码和相关编译文件的存放路径，GOPATH 路径下有三个文件夹 src、pkg 和 bin，它们的用途分别是：</p>
<table data-nodeid="785">
<thead data-nodeid="786">
<tr data-nodeid="787">
<th data-org-content="**目录**" data-nodeid="789"><strong data-nodeid="879">目录</strong></th>
<th data-org-content="**用途**" data-nodeid="790"><strong data-nodeid="883">用途</strong></th>
</tr>
</thead>
<tbody data-nodeid="793">
<tr data-nodeid="794">
<td data-org-content="src" data-nodeid="795">src</td>
<td data-org-content="源代码存放路径或者引用的外部库" data-nodeid="796">源代码存放路径或者引用的外部库</td>
</tr>
<tr data-nodeid="797">
<td data-org-content="pkg" data-nodeid="798">pkg</td>
<td data-org-content="编译时生成的对象文件" data-nodeid="799">编译时生成的对象文件</td>
</tr>
<tr data-nodeid="800">
<td data-org-content="bin" data-nodeid="801">bin</td>
<td data-org-content="编译后的可执行二进制" data-nodeid="802">编译后的可执行二进制</td>
</tr>
</tbody>
</table>
<p data-nodeid="803">这里我们开始配置 GOPATH 路径为 /go。首先准备相关的目录：</p>
<pre class="lang-java hljs" data-nodeid="804"><code data-language="java">$ sudo mkdir /go
$ sudo mkdir /go/src
$ sudo mkdir /go/pkg
$ sudo mkdir /go/bin
</code></pre>
<p data-nodeid="805">然后将 GOPATH 添加到 $HOME/.bashrc 文件末尾，并且把 GOPATH 下的 bin 目录也添加到系统的 PATH 中，这样方便程序编译后直接使用。添加的内容如下：</p>
<pre class="lang-java hljs" data-nodeid="806"><code data-language="java">export GOPATH=/go
export PATH=$PATH:$GOPATH/bin
# 设置 Golang 的代理，方便我们顺利下载依赖包
export GOPROXY="https://goproxy.io,direct"
</code></pre>
<p data-nodeid="807">接下来，使用 source $HOME/.bashrc 命令生效一下我们的配置，然后我们再使用 go env 命令查看一下我们的配置结果：</p>
<pre class="lang-java hljs" data-nodeid="808"><code data-language="java">$ go env
GO111MODULE=<span class="hljs-string">""</span>
GOARCH=<span class="hljs-string">"amd64"</span>
GOBIN=<span class="hljs-string">""</span>
GOCACHE=<span class="hljs-string">"/root/.cache/go-build"</span>
GOENV=<span class="hljs-string">"/root/.config/go/env"</span>
GOEXE=<span class="hljs-string">""</span>
GOFLAGS=<span class="hljs-string">""</span>
GOHOSTARCH=<span class="hljs-string">"amd64"</span>
GOHOSTOS=<span class="hljs-string">"linux"</span>
GOINSECURE=<span class="hljs-string">""</span>
GOMODCACHE=<span class="hljs-string">"/go/pkg/mod"</span>
GONOPROXY=<span class="hljs-string">""</span>
GONOSUMDB=<span class="hljs-string">""</span>
GOOS=<span class="hljs-string">"linux"</span>
GOPATH=<span class="hljs-string">"/go"</span>
GOPRIVATE=<span class="hljs-string">""</span>
GOPROXY=<span class="hljs-string">"https://goproxy.io,direct"</span>
GOROOT=<span class="hljs-string">"/usr/local/go"</span>
GOSUMDB=<span class="hljs-string">"sum.golang.org"</span>
GOTMPDIR=<span class="hljs-string">""</span>
GOTOOLDIR=<span class="hljs-string">"/usr/local/go/pkg/tool/linux_amd64"</span>
GCCGO=<span class="hljs-string">"gccgo"</span>
AR=<span class="hljs-string">"ar"</span>
CC=<span class="hljs-string">"gcc"</span>
CXX=<span class="hljs-string">"g++"</span>
CGO_ENABLED=<span class="hljs-string">"1"</span>
GOMOD=<span class="hljs-string">""</span>
CGO_CFLAGS=<span class="hljs-string">"-g -O2"</span>
CGO_CPPFLAGS=<span class="hljs-string">""</span>
CGO_CXXFLAGS=<span class="hljs-string">"-g -O2"</span>
CGO_FFLAGS=<span class="hljs-string">"-g -O2"</span>
CGO_LDFLAGS=<span class="hljs-string">"-g -O2"</span>
PKG_CONFIG=<span class="hljs-string">"pkg-config"</span>
GOGCCFLAGS=<span class="hljs-string">"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build352828668=/tmp/go-build -gno-record-gcc-switches"</span>
</code></pre>
<p data-nodeid="809">从 GOPATH 和 GOPROXY 两个变量的结果，可以看到 GOPATH 和 GOPROXY 均已经生效。到此，我们的 Golang 已经安装完毕。下面，我们就开始真正的 Docker 编写之旅吧。</p>
<h3 data-nodeid="810">编写 Docker</h3>
<p data-nodeid="811">在开始编写 Docker 之前，我先介绍几个基础知识，如果你对这些基础知识已经很熟悉了，可以直接跳过这块的基础知识。</p>
<h4 data-nodeid="812">Linux Proc 文件系统</h4>
<p data-nodeid="813">Linux 系统中，/proc 目录是一种“文件系统”，这里我用了引号，其实 /proc 目录并不是一个真正的文件系统。<strong data-nodeid="901">/proc 目录存放于内存中，是一个虚拟的文件系统，该目录存放了当前内核运行状态的一系列特殊的文件，你可以通过这些文件查看当前的进程信息。</strong></p>
<p data-nodeid="814">下面，我们通过 ls 命令查看一下 /proc 目录下的内容：</p>
<pre class="lang-java hljs" data-nodeid="815"><code data-language="java">$ sudo ls -l /proc
total <span class="hljs-number">0</span>
dr-xr-xr-x&nbsp; <span class="hljs-number">9</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> <span class="hljs-number">1</span>
dr-xr-xr-x&nbsp; <span class="hljs-number">9</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> <span class="hljs-number">30097</span>
...省略部分输出
dr-xr-xr-x&nbsp; <span class="hljs-number">9</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> <span class="hljs-number">8</span>
dr-xr-xr-x&nbsp; <span class="hljs-number">9</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> <span class="hljs-number">9</span>
dr-xr-xr-x&nbsp; <span class="hljs-number">9</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> <span class="hljs-number">97</span>
dr-xr-xr-x&nbsp; <span class="hljs-number">2</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> acpi
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> buddyinfo
dr-xr-xr-x&nbsp; <span class="hljs-number">4</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> bus
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> cgroups
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> cmdline
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> consoles
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> cpuinfo
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> crypto
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> devices
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> diskstats
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> dma
dr-xr-xr-x&nbsp; <span class="hljs-number">2</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> driver
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> execdomains
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> fb
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> filesystems
dr-xr-xr-x&nbsp; <span class="hljs-number">5</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> fs
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> interrupts
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> iomem
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> ioports
dr-xr-xr-x <span class="hljs-number">27</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> irq
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> kallsyms
-r--------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; <span class="hljs-number">140737486266368</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> kcore
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> key-users
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> keys
-r--------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> kmsg
-r--------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> kpagecount
-r--------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> kpageflags
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> loadavg
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> locks
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> mdstat
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> meminfo
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> misc
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> modules
lrwxrwxrwx&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">11</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> mounts -&gt; self/mounts
-rw-r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> mtrr
lrwxrwxrwx&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">8</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> net -&gt; self/net
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> pagetypeinfo
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> partitions
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> sched_debug
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> schedstat
dr-xr-xr-x&nbsp; <span class="hljs-number">2</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> scsi
lrwxrwxrwx&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> self -&gt; <span class="hljs-number">30097</span>
-r--------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> slabinfo
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> softirqs
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> stat
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> swaps
dr-xr-xr-x&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">34</span> sys
--w-------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> sysrq-trigger
dr-xr-xr-x&nbsp; <span class="hljs-number">2</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> sysvipc
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> timer_list
-rw-r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> timer_stats
dr-xr-xr-x&nbsp; <span class="hljs-number">4</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> tty
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> uptime
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> version
-r--------&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> vmallocinfo
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> vmstat
-r--r--r--&nbsp; <span class="hljs-number">1</span> root&nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">0</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">27</span> zoneinfo
</code></pre>
<p data-nodeid="816">可以看到，这个目录下有很多数字，这些数字目录实际上是以进程 ID 命名的。除了这些以进程 ID 命名的目录，还有一些特殊的目录，这里我讲解一下与我们编写 Docker 有关的文件和目录。</p>
<ul data-nodeid="817">
<li data-nodeid="818">
<p data-nodeid="819"><strong data-nodeid="908">self 目录</strong>：它是连接到当前正在运行的进程目录，比如我当前的进程 ID 为 30097，则 self 目录实际连接到 /proc/30097 这个目录。</p>
</li>
<li data-nodeid="820">
<p data-nodeid="821"><strong data-nodeid="913">/proc/{PID}/exe 文件</strong>：exe 连接到进程执行的命令文件，例如 30097 这个进程的运行命令为 docker，则执行 /proc/30097/exe ps 等同于执行 docker ps。</p>
</li>
</ul>
<p data-nodeid="822">好了，了解完这些基础知识后，我们就开始行动吧！因为我们的精简版 Docker 是使用 Golang 编写，这里就给我们编写的 Docker 命名为 gocker 吧。</p>
<h4 data-nodeid="823">实现 gocker 的 run 命令</h4>
<p data-nodeid="824">通过前面的章节，我们学习了要运行一个容器，必须先有镜像。这里我们首先准备一个 busybox 镜像，以便我们运行 gocker 容器。</p>
<pre class="lang-java hljs" data-nodeid="825"><code data-language="java">$ mkdir /tmp/busybox &amp;&amp; cd /tmp/busybox
$ docker export $(docker create busybox) -o busybox.tar
$ tar -xf busybox.tar
</code></pre>
<p data-nodeid="826">以上是我们在 /tmp/busybox 目录，使用 docker export 命令导出的一个 busybox 镜像文件，然后对镜像文件包进行解压，解压后 /tmp/busybox 目录内容如下：</p>
<pre class="lang-java hljs" data-nodeid="827"><code data-language="java">$ ls -l /tmp/busybox/
total <span class="hljs-number">1472</span>
drwxr-xr-x <span class="hljs-number">2</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; <span class="hljs-number">12288</span> Sep&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span> bin
-rw------- <span class="hljs-number">1</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; <span class="hljs-number">1455104</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">22</span>:<span class="hljs-number">47</span> busybox.tar
drwxr-xr-x <span class="hljs-number">4</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span> dev
drwxr-xr-x <span class="hljs-number">3</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span> etc
drwxr-xr-x <span class="hljs-number">2</span> nfsnobody nfsnobody&nbsp; &nbsp; <span class="hljs-number">4096</span> Sep&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span> home
drwxr-xr-x <span class="hljs-number">2</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span> proc
drwx------ <span class="hljs-number">2</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">21</span>:<span class="hljs-number">07</span> root
drwxr-xr-x <span class="hljs-number">2</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep <span class="hljs-number">19</span> <span class="hljs-number">16</span>:<span class="hljs-number">41</span> sys
drwxrwxrwt <span class="hljs-number">2</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span> tmp
drwxr-xr-x <span class="hljs-number">3</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span> usr
drwxr-xr-x <span class="hljs-number">4</span> root&nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<span class="hljs-number">4096</span> Sep&nbsp; <span class="hljs-number">9</span> <span class="hljs-number">02</span>:<span class="hljs-number">09</span> <span class="hljs-keyword">var</span>
</code></pre>
<p data-nodeid="828">准备好镜像文件后，把我为你准备好的 gocker 代码下载下来吧，这里我使用手动下载源码的方式克隆代码：</p>
<pre class="lang-java hljs" data-nodeid="829"><code data-language="java">$ mkdir -p /go/src/github.com/wilhelmguo
$ cd /go/src/github.com/wilhelmguo &amp;&amp; git clone https:<span class="hljs-comment">//github.com/wilhelmguo/gocker.git</span>
$ cd gocker
$ git checkout lesson-<span class="hljs-number">17</span>
</code></pre>
<blockquote data-nodeid="830">
<p data-nodeid="831">我的 GOPATH 在 /go 目录下，如果你的 GOPATH 跟我不一致，请根据 GOPATH 存放和编译源码。本课时的源码存放在<a href="https://github.com/wilhelmguo/gocker/tree/lesson-17" data-nodeid="922">这里</a>，你也可以在线阅读。</p>
</blockquote>
<p data-nodeid="832">代码下载完后，我们进入 gocker 的目录，查看下源码文件：</p>
<pre class="lang-java hljs" data-nodeid="833"><code data-language="java">$ tree .
.
|-- go.mod
|-- go.sum
|-- main.go
|-- README.md
|-- runc
|&nbsp; &nbsp;\`-- run.go
\`-- vendor
... 省略 vendor 目录结构
<span class="hljs-number">15</span> directories, <span class="hljs-number">59</span> files
</code></pre>
<blockquote data-nodeid="834">
<p data-nodeid="835">本项目使用 go mod 管理包依赖，go mod 是在 golang 1.11 版本加入的新的特性，是用来管理包的依赖的，也是目前官方的包依赖管理工具。如果你想学习更多个 go mod 使用方法，可以参考<a href="https://golang.org/ref/mod" data-nodeid="928">官网</a>。</p>
</blockquote>
<p data-nodeid="836">可以看到该源码下有两个主要文件：一个是 main.go 文件，这是 gocker 的主入口函数；另外一个是 run.go ，这个文件是 gocker run 命令的具体实现。</p>
<p data-nodeid="837">下面我们使用 go install 命令来编译一下我们的 gocker 项目：</p>
<pre class="lang-java hljs" data-nodeid="838"><code data-language="java">$ go install
</code></pre>
<p data-nodeid="839">执行完 go install 后， Golang 会自动帮助我们编译当前项目下的代码，编译后的二进制文件存放在 $GOPATH/bin 目录下。由于我们之前在 $HOME/.bashrc 文件下把 $GOPATH/bin 放入了系统 PATH 中，所以此时你可以直接使用 gocker 命令了。<br>
接下来我们使用 gocker 来启动一个容器：</p>
<pre class="lang-java hljs" data-nodeid="951"><code data-language="java"># gocker run -it -rootfs=/tmp/busybox /bin/sh
2020/09/19 23:46:27 Current path is&nbsp; /tmp/busybox
2020/09/19 23:46:27 CmdArray is&nbsp; [/bin/sh]
/ #
</code></pre>
<blockquote data-nodeid="2551" class="">
<p data-nodeid="2552">如果出现 pivotRoot error pivot_root invalid argument 的报错，可以先执行 unshare -m 命令，然后使用 rm -rf /tmp/busybox/.pivot_root 命令删除临时文件，再次重试即可。</p>
</blockquote>
<p data-nodeid="2553">这里我们使用 it 参数指定以命令行交互的模式启动容器，rootfs 指定准备好的镜像目录。执行完上面的命令后 busybox 容器就成功启动了。<br>
这时候，我们使用 ps 命令查看一下当前进程信息：</p>






<pre class="lang-java hljs" data-nodeid="842"><code data-language="java">/ # /bin/ps -ef
PID&nbsp; &nbsp;USER&nbsp; &nbsp; &nbsp;TIME&nbsp; COMMAND
&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp; 0:00 /bin/sh
&nbsp; &nbsp; 5 root&nbsp; &nbsp; &nbsp; 0:00 /bin/ps -ef
</code></pre>
<p data-nodeid="843">此时，容器内的进程已经与主机完全隔离。<br>
我们再查看一下当前目录下的内容：</p>
<pre class="lang-java hljs" data-nodeid="844"><code data-language="java">/ # pwd
/
/ # /bin/ls -l
total 1468
drwxr-xr-x&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12288 Sep&nbsp; 8 18:09 bin
-rw-------&nbsp; &nbsp; 1 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp;1455104 Sep 19 14:47 busybox.tar
drwxr-xr-x&nbsp; &nbsp; 4 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep 19 08:41 dev
drwxr-xr-x&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep 19 08:41 etc
drwxr-xr-x&nbsp; &nbsp; 2 nobody&nbsp; &nbsp;nobody&nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep&nbsp; 8 18:09 home
dr-xr-xr-x&nbsp; 122 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0 Sep 19 15:46 proc
drwx------&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep 19 13:07 root
drwxr-xr-x&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep 19 08:41 sys
drwxrwxrwt&nbsp; &nbsp; 2 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep&nbsp; 8 18:09 tmp
drwxr-xr-x&nbsp; &nbsp; 3 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep&nbsp; 8 18:09 usr
drwxr-xr-x&nbsp; &nbsp; 4 root&nbsp; &nbsp; &nbsp;root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4096 Sep&nbsp; 8 18:09 var
</code></pre>
<p data-nodeid="845">可以看到当前目录已经为根目录，并且根目录下的文件就是我们上面准备的 busybox 镜像文件。<br>
到此，一个完全由我们自己编写的 gocker 已经可以启动容器了。</p>
<h3 data-nodeid="846">结语</h3>
<p data-nodeid="847">本课时我们讲解了 Golang 是什么, 并且配置好了 Golang 环境，编译了 gocker，也了解了 Linux /proc 文件系统的一些重要功能，最后使用 gocker 成功启动了一个 busybox 容器。</p>
<p data-nodeid="848">那么你知道，为什么 Docker 会选择使用 Golang 来开发吗？思考后，把你的想法写在留言区。</p>
<p data-nodeid="849">下一课时我将为你全面剖析 gocker 的源码以及它的实现原理，让你能够自己动手把它写出来，到时见。</p>
<p data-nodeid="850" class=""><a href="https://github.com/wilhelmguo/gocker/tree/lesson-17" data-nodeid="950">点击链接，即可查看本课时的源码。</a></p></div>

</body></html>